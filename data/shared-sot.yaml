metadata:
  last_updated: '2026-01-31'
  go_version: 1.25.6
  nodejs_version: 20.x (LTS)
  python_version: '3.12'
  postgresql_version: '18.1'
  build_command: GOEXPERIMENT=greenteagc,jsonv2 go build ./...
content_modules:
  - name: Movie
    schema: '`public`'
    status: âœ… Complete
    primary_metadata: TMDb
    arr_integration: Radarr
    design_doc: features/video/MOVIE_MODULE.md
  - name: TV Show
    schema: '`public`'
    status: âœ… Complete
    primary_metadata: TMDb, TheTVDB
    arr_integration: Sonarr
    design_doc: features/video/TVSHOW_MODULE.md
  - name: Music
    schema: '`public`'
    status: ðŸŸ¡ Scaffold
    primary_metadata: MusicBrainz, Last.fm
    arr_integration: Lidarr
    design_doc: features/music/MUSIC_MODULE.md
  - name: Audiobook
    schema: '`public`'
    status: ðŸŸ¡ Scaffold
    primary_metadata: Audnexus, OpenLibrary
    arr_integration: Chaptarr
    design_doc: features/audiobook/AUDIOBOOK_MODULE.md
  - name: Book
    schema: '`public`'
    status: ðŸŸ¡ Scaffold
    primary_metadata: OpenLibrary, Goodreads
    arr_integration: Chaptarr
    design_doc: features/book/BOOK_MODULE.md
  - name: Podcast
    schema: '`public`'
    status: ðŸŸ¡ Scaffold
    primary_metadata: RSS/iTunes
    arr_integration: Native
    design_doc: features/podcasts/PODCASTS.md
  - name: Photo
    schema: '`public`'
    status: ðŸ”´ Planned
    primary_metadata: EXIF, Immich
    arr_integration: '-'
    design_doc: features/photos/PHOTOS_LIBRARY.md
  - name: Comics
    schema: '`public`'
    status: ðŸ”´ Planned
    primary_metadata: ComicVine
    arr_integration: '-'
    design_doc: features/comics/COMICS_MODULE.md
  - name: LiveTV
    schema: '`public`'
    status: ðŸ”´ Planned
    primary_metadata: XMLTV
    arr_integration: TVHeadend
    design_doc: features/livetv/LIVE_TV_DVR.md
  - name: QAR Voyages
    schema: '`qar`'
    status: ðŸŸ¡ Scaffold
    primary_metadata: StashDB, ThePornDB
    arr_integration: Whisparr
    design_doc: features/adult/ADULT_CONTENT_SYSTEM.md
  - name: QAR Expeditions
    schema: '`qar`'
    status: ðŸŸ¡ Scaffold
    primary_metadata: StashDB, ThePornDB
    arr_integration: Whisparr
    design_doc: features/adult/ADULT_CONTENT_SYSTEM.md
  - name: QAR Treasures
    schema: '`qar`'
    status: ðŸŸ¡ Scaffold
    primary_metadata: StashDB
    arr_integration: Prowlarr
    design_doc: features/adult/GALLERY_MODULE.md
backend_services:
  - name: Auth
    package: '`internal/service/auth`'
    fx_module: '`auth.Module`'
    status: âœ… Complete
    design_doc: services/AUTH.md
  - name: User
    package: '`internal/service/user`'
    fx_module: '`user.Module`'
    status: âœ… Complete
    design_doc: services/USER.md
  - name: Session
    package: '`internal/service/session`'
    fx_module: '`session.Module`'
    status: âœ… Complete
    design_doc: services/SESSION.md
  - name: RBAC
    package: '`internal/service/rbac`'
    fx_module: '`rbac.Module`'
    status: âœ… Complete
    design_doc: services/RBAC.md
  - name: Activity
    package: '`internal/service/activity`'
    fx_module: '`activity.Module`'
    status: âœ… Complete
    design_doc: services/ACTIVITY.md
  - name: Settings
    package: '`internal/service/settings`'
    fx_module: '`settings.Module`'
    status: âœ… Complete
    design_doc: services/SETTINGS.md
  - name: API Keys
    package: '`internal/service/apikeys`'
    fx_module: '`apikeys.Module`'
    status: âœ… Complete
    design_doc: services/APIKEYS.md
  - name: OIDC
    package: '`internal/service/oidc`'
    fx_module: '`oidc.Module`'
    status: âœ… Complete
    design_doc: services/OIDC.md
  - name: Grants
    package: '`internal/service/grants`'
    fx_module: '`grants.Module`'
    status: ðŸ”µ Planned
    design_doc: services/GRANTS.md
  - name: Fingerprint
    package: '`internal/service/fingerprint`'
    fx_module: '`fingerprint.Module`'
    status: ðŸ”µ Planned
    design_doc: services/FINGERPRINT.md
  - name: Library
    package: '`internal/service/library`'
    fx_module: '`library.Module`'
    status: âœ… Complete
    design_doc: services/LIBRARY.md
  - name: Playback
    package: '`internal/service/playback`'
    fx_module: '`playback.Module`'
    status: ðŸŸ¡ Partial
    design_doc: technical/
  - name: Metadata
    package: '`internal/service/metadata`'
    fx_module: '`metadata.Module`'
    status: ðŸŸ¡ Partial
    design_doc: services/METADATA.md
  - name: Search
    package: '`internal/service/search`'
    fx_module: '`search.Module`'
    status: ðŸŸ¡ Partial
    design_doc: services/SEARCH.md
  - name: Health
    package: '`internal/infra/health`'
    fx_module: '`health.Module`'
    status: âœ… Complete
    design_doc: '-'
  - name: Scrobbling
    package: '`internal/service/scrobbling`'
    fx_module: '`scrobbling.Module`'
    status: ðŸ”´ Planned
    design_doc: features/shared/
  - name: Analytics
    package: '`internal/service/analytics`'
    fx_module: '`analytics.Module`'
    status: ðŸ”´ Planned
    design_doc: services/ANALYTICS.md
  - name: Notification
    package: '`internal/service/notification`'
    fx_module: '`notification.Module`'
    status: ðŸ”´ Planned
    design_doc: services/NOTIFICATION.md
infrastructure:
  - name: PostgreSQL
    package: '`pgx/v5`'
    version: v5.7.5
    purpose: Primary database
    design_doc: integrations/infrastructure/
  - name: Dragonfly
    package: '`rueidis`'
    version: v1.0.49
    purpose: Cache/sessions
    design_doc: integrations/infrastructure/
  - name: Typesense
    package: '`typesense-go/v2`'
    version: v2.0.0
    purpose: Full-text search
    design_doc: integrations/infrastructure/
  - name: River
    package: '`riverqueue/river`'
    version: v0.26.0
    purpose: Job queue
    design_doc: integrations/infrastructure/
go_dependencies:
  core:
    - package: go.uber.org/fx
      version: v1.24.0
      purpose: Dependency injection
      notes: Lifecycle hooks, graceful shutdown
    - package: github.com/jackc/pgx/v5
      version: v5.8.0
      purpose: PostgreSQL driver
      notes: Self-healing pool via pgxpool
    - package: github.com/riverqueue/river
      version: v0.26.0
      purpose: Job queue
      notes: PostgreSQL-backed, transactional
    - package: github.com/redis/rueidis
      version: v1.0.49
      purpose: Redis/Dragonfly client
      notes: Pipelining, client-side cache
    - package: github.com/maypok86/otter
      version: v1.2.4
      purpose: In-memory cache
      notes: W-TinyLFU, faster than Ristretto
    - package: github.com/knadh/koanf/v2
      version: v2.3.0
      purpose: Configuration
      notes: Hot reload via Watch()
    - package: github.com/ogen-go/ogen
      version: v1.18.0
      purpose: OpenAPI codegen
      notes: Type-safe handlers
    - package: github.com/golang-migrate/migrate/v4
      version: v4.19.1
      purpose: DB migrations
      notes: Embedded SQL support
    - package: github.com/gobwas/ws
      version: latest
      purpose: WebSocket
      notes: Zero-alloc, maximum performance
    - package: github.com/go-resty/resty/v2
      version: v2.17.1
      purpose: HTTP client
      notes: Retry, backoff, middleware
    - package: github.com/google/uuid
      version: v1.6.0
      purpose: UUIDs
      notes: V7 time-ordered support
    - package: github.com/stretchr/testify
      version: v1.11.1
      purpose: Testing
      notes: Assertions, mocks
  security:
    - package: github.com/casbin/casbin/v2
      version: v2.135.0
      purpose: RBAC framework
      notes: Role-based policies
    - package: github.com/pckhoi/casbin-pgx-adapter/v3
      version: v3.2.0
      purpose: Casbin PostgreSQL
      notes: Async policy sync
    - package: github.com/open-policy-agent/opa
      version: v1.5.0
      purpose: Policy engine
      notes: Complex ABAC/data-driven policies
    - package: golang.org/x/crypto
      version: v0.47.0
      purpose: Cryptography
      notes: Argon2, bcrypt, etc.
  observability:
    - package: github.com/lmittmann/tint
      version: v1.1.2
      purpose: Structured logging (dev)
      notes: Colorized slog handler
    - package: go.uber.org/zap
      version: v1.27.1
      purpose: Structured logging (prod)
      notes: High-performance JSON logs
    - package: go.opentelemetry.io/otel
      version: v1.39.0
      purpose: Telemetry
      notes: Traces, metrics
    - package: github.com/heptiolabs/healthcheck
      version: latest
      purpose: Health probes
      notes: K8s liveness/readiness
    - package: github.com/go-faster/errors
      version: v0.7.1
      purpose: Error handling
      notes: Stack traces, wrapping
  resilience:
    - package: github.com/viccon/sturdyc
      version: v1.1.5
      purpose: Circuit breaker
      notes: Bulkhead pattern
    - package: github.com/sony/gobreaker
      version: v1.0.0
      purpose: Circuit breaker
      notes: Simple, fast
  distributed:
    - package: github.com/hashicorp/raft
      version: v1.7.x
      purpose: Consensus
      notes: Leader election, state sync
    - package: github.com/hashicorp/raft-boltdb/v2
      version: v2.3.x
      purpose: Raft storage
      notes: BoltDB log store
design_principles:
  database_strategy: No SQLite support. Simplifies codebase, pgx is the best driver.
  package_update_policy: Use newest STABLE version, never alphas/RCs. Monitor via Dependabot.
  test_coverage: Required for all packages.
  design_patterns:
    - pattern: Error Handling
      decision: Sentinels (internal) + Custom APIError (external)
      notes: Type-safe errors + API responses
    - pattern: Testing
      decision: Table-driven + testify + mockery
      notes: mockery for auto-generated mocks
    - pattern: Logging
      decision: Text (Dev, tint) + JSON (Prod, zap)
      notes: slog/tint dev, zap prod
    - pattern: Metrics
      decision: Prometheus + OpenTelemetry
      notes: Both - Prometheus for K8s, OTel for traces
    - pattern: Validation
      decision: ogen (API) + go-playground/validator (Business)
      notes: Separate layers
    - pattern: Pagination
      decision: Cursor (default) + Offset (option)
      notes: Cursor for performance, Offset for compatibility
    - pattern: Integration Tests
      decision: testcontainers-go
      notes: Coder-compatible, real containers
    - pattern: Unit Tests
      decision: embedded-postgres-go
      notes: Fast, no containers needed
    - pattern: Parallel DB Tests
      decision: Template Database Pattern
      notes: PostgreSQL CREATE DATABASE ... TEMPLATE for 60-500x speedup

# External Research & Sources
# Documentation of research findings and external references
research_sources:
  parallel_database_testing:
    title: "Parallel Database Testing with Template Pattern"
    research_doc: ".workingdir/RESEARCH_parallel_db_testing.md"
    summary: |
      PostgreSQL template database pattern enables instant database cloning (~10ms vs 3-5s).
      One shared PostgreSQL instance with pre-migrated template. Each test clones template.
      60-500x speedup compared to per-test database initialization.
    sources:
      - name: PostgreSQL Template Databases
        url: https://www.postgresql.org/docs/current/manage-ag-templatedbs.html
        notes: Official docs on CREATE DATABASE ... TEMPLATE syntax
      - name: embedded-postgres-go
        url: https://github.com/fergusstrange/embedded-postgres
        notes: RuntimePath config for parallel processes, version selection
      - name: testcontainers-go
        url: https://github.com/testcontainers/testcontainers-go
        notes: Docker-based testing, parallel.go for concurrent containers
      - name: pgx Testing Patterns
        url: https://github.com/jackc/pgx
        notes: t.Parallel() usage, PGX_TEST_DATABASE env var, connection pool testing
      - name: Golang Testing Best Practices
        url: https://go.dev/doc/tutorial/add-a-test
        notes: t.Cleanup(), t.Parallel(), subtests
    implementation:
      location: "internal/testutil/testdb.go"
      pattern: |
        - sync.Once for shared PostgreSQL instance
        - Template database with all migrations applied
        - NewTestDB(t) clones template instantly
        - t.Cleanup() drops test database after test
