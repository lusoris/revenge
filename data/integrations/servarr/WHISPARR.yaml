doc_title: Whisparr v3 Integration
doc_category: integration
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: ðŸŸ¡
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> Adult content management automation (eros branch)'
wiki_tagline: '> Automatic adult content downloads with Whisparr'
wiki_overview: Whisparr (eros branch) automates adult content downloads. Request scenes and Whisparr handles acquisition.
  Integrates with StashDB for metadata. Webhooks notify Revenge when content is imported. Part of the QAR adult content system.
  Configure with Whisparr URL and API key in settings.
sources:
- name: Uber fx
  url: https://pkg.go.dev/go.uber.org/fx
  note: Auto-resolved from fx
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: Typesense API
  url: https://typesense.org/docs/latest/api/
  note: Auto-resolved from typesense
- name: Typesense Go Client
  url: https://github.com/typesense/typesense-go
  note: Auto-resolved from typesense-go
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
integration_name: Whisparr v3
integration_id: whisparr_v3
external_service: Whisparr v3
auth_method: api_key
api_base_url: http://localhost:6969/api/v3
dual_role_metadata_and_downloads: |
  **CRITICAL: Whisparr serves DUAL purposes in the Revenge architecture**:

  **1. PRIMARY Metadata Aggregator**:
  - Whisparr is the PRIMARY source for adult content metadata in Revenge (QAR system)
  - It aggregates metadata from StashDB (adult content database)
  - Maintains local cache of performer/scene information (StashDB IDs, performer details, scene metadata)
  - Revenge queries Whisparr API for adult metadata BEFORE falling back to direct StashDB/Stash APIs
  - Provides unified, consistent metadata interface
  - Reduces direct API calls to external services (rate limiting, availability, privacy)

  **2. Download Automation Manager**:
  - Handles adult scene acquisition through configured indexers and download clients
  - Monitors performers/studios for new releases and automatically downloads
  - Manages file organization within QAR schema (adult content isolation)
  - Webhooks notify Revenge when scenes are ready

  **Metadata Flow**:
  ```
  External (StashDB) â†’ Whisparr (local aggregation) â†’ Revenge QAR System
                            â†“
                  (optional direct StashDB/Stash for enrichment)
  ```

  **Why This Matters**:
  - Whisparr is NOT just a download tool - it's the metadata backbone for adult content
  - Direct StashDB/Stash integrations are SUPPLEMENTARY for enrichment
  - This dual-role pattern is consistent across ALL Arr services
  - Privacy benefit: Local metadata cache reduces external calls to adult content databases
architecture_diagram: |-
  ```mermaid
  flowchart TD
      node1["Revenge<br/>QAR Module"]
      node2["Whisparr<br/>Integration"]
      node3["Whisparr<br/>(eros)"]
      node4(["Webhook<br/>Handler"])
      node1 --> node2
      node2 --> node3
      node3 --> node4
  ```
api_details: |
  **API Version**: v3
  **Base URL**: `http://localhost:6969/api/v3` (configurable)
  **Authentication**: X-Api-Key header
  **Branch**: eros (adult content optimized)

  **Key Endpoints**:
  - `/site` - List/add/delete sites (performers)
  - `/site/{id}` - Get/update site details
  - `/movie` - Scene/movie management
  - `/command` - Trigger searches
  - `/calendar` - Upcoming releases
database_schema: |
  **Schema**: `qar` (adult content isolation)

  ```sql
  CREATE TABLE qar.whisparr_instances (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    base_url TEXT NOT NULL,
    api_key TEXT NOT NULL,
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now()
  );

  CREATE TABLE qar.whisparr_performers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    performer_id UUID NOT NULL REFERENCES qar.performers(id) ON DELETE CASCADE,
    whisparr_instance_id UUID NOT NULL REFERENCES qar.whisparr_instances(id) ON DELETE CASCADE,
    whisparr_site_id INTEGER NOT NULL,
    monitored BOOLEAN DEFAULT true,
    UNIQUE(performer_id, whisparr_instance_id)
  );

  CREATE TABLE qar.whisparr_scenes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    scene_id UUID NOT NULL REFERENCES qar.scenes(id) ON DELETE CASCADE,
    whisparr_movie_id INTEGER NOT NULL,
    has_file BOOLEAN DEFAULT false,
    file_path TEXT,
    UNIQUE(scene_id)
  );
  ```
api_request_examples: |
  **Add Site (Performer)**:
  ```
  POST http://localhost:6969/api/v3/site
  X-Api-Key: your_api_key

  {
    "foreignId": "stashdb-performer-uuid",
    "name": "Performer Name",
    "qualityProfileId": 1,
    "rootFolderPath": "/adult",
    "monitored": true
  }
  ```
webhook_handling: |
  **Webhook Payload** (MovieDownload):
  ```json
  {
    "eventType": "Download",
    "movie": {
      "id": 123,
      "title": "Scene Title",
      "stashId": "uuid-from-stashdb"
    },
    "movieFile": {
      "path": "/adult/scene.mp4",
      "quality": "Bluray-1080p",
      "size": 5368709120
    }
  }
  ```
pirate_terminology: |
  **QAR Obfuscation** (pirate theme):
  - "Site" â†’ Performer/Studio
  - "Movie" â†’ Scene
  - "Root Folder" â†’ "Cargo Hold"
  - Integrated with QAR schema (`qar.*` tables)
