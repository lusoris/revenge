doc_title: Sonarr Integration
doc_category: integration
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: ðŸŸ¡
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> TV show management automation'
wiki_tagline: '> Automatic TV show downloads with Sonarr'
wiki_overview: Sonarr integration automates TV show downloads. Add series to Sonarr and new episodes download automatically.
  Webhooks notify Revenge when episodes are ready. See which shows are monitored and upcoming episodes. Calendar integration
  shows air dates. Connect with your Sonarr URL and API key.
sources:
- name: Uber fx
  url: https://pkg.go.dev/go.uber.org/fx
  note: Auto-resolved from fx
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: Servarr Wiki
  url: https://wiki.servarr.com/
  note: Auto-resolved from servarr-wiki
- name: Sonarr API Docs
  url: https://sonarr.tv/docs/api/
  note: Auto-resolved from sonarr-docs
- name: Typesense API
  url: https://typesense.org/docs/latest/api/
  note: Auto-resolved from typesense
- name: Typesense Go Client
  url: https://github.com/typesense/typesense-go
  note: Auto-resolved from typesense-go
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
integration_name: Sonarr
integration_id: sonarr
external_service: Sonarr
auth_method: api_key
api_base_url: http://localhost:8989/api/v3
dual_role_metadata_and_downloads: |
  **Sonarr serves DUAL purposes in the Revenge architecture**:

  1. **PRIMARY Metadata Aggregator**: Aggregates TheTVDB metadata locally, provides unified interface
  2. **Download Automation Manager**: Handles episode acquisition, season/episode organization, webhooks

  Revenge queries Sonarr API for TV metadata BEFORE falling back to direct TheTVDB API.

  See data/architecture/03_METADATA_SYSTEM.yaml#arr_services_dual_role for complete
  explanation of why ALL Arr services follow this dual-role pattern.
architecture_diagram: |-
  ```mermaid
  flowchart LR
      subgraph Layer1["Layer 1"]
          node1["Revenge<br/>Request<br/>System"]
          node2["Sonarr<br/>Integration"]
          node3["Sonarr<br/>Server"]
      end

      subgraph Layer2["Layer 2"]
          node4(["Webhook<br/>Handler"])
      end

      %% Connections
      node3 --> node4

      %% Styling
      style Layer1 fill:#1976D2,stroke:#1976D2,color:#fff
      style Layer2 fill:#388E3C,stroke:#388E3C,color:#fff
  ```
api_details: |
  **API Version**: v3
  **Base URL**: `http://localhost:8989/api/v3` (configurable)
  **Authentication**: X-Api-Key header
  **Rate Limit**: None (local service)

  **Key Endpoints**:
  - `/series` - List/add/delete TV series
  - `/series/{id}` - Get/update series details
  - `/series/lookup` - Search for series (TheTVDB)
  - `/episode` - Get episodes
  - `/calendar` - Get upcoming episodes
  - `/command` - Trigger commands (search, refresh)
  - `/history` - Get download history
database_schema: |
  **Schema**: `public`

  ```sql
  -- Sonarr instance configuration
  CREATE TABLE sonarr_instances (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    name VARCHAR(255) NOT NULL,
    base_url TEXT NOT NULL,
    api_key TEXT NOT NULL,

    enabled BOOLEAN DEFAULT true,
    auto_sync BOOLEAN DEFAULT true,
    sync_interval INTEGER DEFAULT 300,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
  );

  -- TV show to Sonarr mapping
  CREATE TABLE sonarr_series (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    tvshow_id UUID NOT NULL REFERENCES tvshows(id) ON DELETE CASCADE,
    sonarr_instance_id UUID NOT NULL REFERENCES sonarr_instances(id) ON DELETE CASCADE,

    sonarr_series_id INTEGER NOT NULL,
    monitored BOOLEAN DEFAULT true,
    quality_profile_id INTEGER,
    season_folder BOOLEAN DEFAULT true,

    last_synced_at TIMESTAMPTZ,
    UNIQUE(tvshow_id, sonarr_instance_id)
  );

  -- Episode file tracking
  CREATE TABLE sonarr_episodes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    episode_id UUID NOT NULL REFERENCES episodes(id) ON DELETE CASCADE,
    sonarr_series_id UUID NOT NULL REFERENCES sonarr_series(id) ON DELETE CASCADE,

    sonarr_episode_id INTEGER NOT NULL,
    has_file BOOLEAN DEFAULT false,
    file_path TEXT,

    UNIQUE(episode_id)
  );
  ```
key_interfaces: |
  ```go
  type SonarrService interface {
    // Series management
    AddSeries(ctx context.Context, tvdbID int, qualityProfileID int, rootFolder string) (*SonarrSeries, error)
    DeleteSeries(ctx context.Context, sonarrID int, deleteFiles bool) error
    SearchSeason(ctx context.Context, seriesID int, seasonNumber int) error

    // Episode management
    GetEpisodes(ctx context.Context, seriesID int) ([]SonarrEpisode, error)
    GetCalendar(ctx context.Context, start, end time.Time) ([]CalendarEpisode, error)

    // Sync
    SyncLibrary(ctx context.Context, instanceID uuid.UUID) error
  }

  type SonarrSeries struct {
    ID              int      `json:"id"`
    Title           string   `json:"title"`
    Year            int      `json:"year"`
    TVDbID          int      `json:"tvdbId"`
    TVRageID        int      `json:"tvRageId"`
    IMDbID          string   `json:"imdbId"`
    Monitored       bool     `json:"monitored"`
    QualityProfile  int      `json:"qualityProfileId"`
    SeasonFolder    bool     `json:"seasonFolder"`
    Path            string   `json:"path"`
    Seasons         []Season `json:"seasons"`
  }

  type SonarrEpisode struct {
    ID              int      `json:"id"`
    SeriesID        int      `json:"seriesId"`
    SeasonNumber    int      `json:"seasonNumber"`
    EpisodeNumber   int      `json:"episodeNumber"`
    Title           string   `json:"title"`
    AirDate         string   `json:"airDate"`
    HasFile         bool     `json:"hasFile"`
    Monitored       bool     `json:"monitored"`
  }
  ```
api_request_examples: |
  **Add Series**:
  ```
  POST http://localhost:8989/api/v3/series
  X-Api-Key: your_api_key

  {
    "tvdbId": 81189,
    "title": "Breaking Bad",
    "qualityProfileId": 1,
    "rootFolderPath": "/tv",
    "monitored": true,
    "seasonFolder": true,
    "addOptions": {
      "searchForMissingEpisodes": true
    }
  }
  ```

  **Get Calendar** (upcoming episodes):
  ```
  GET http://localhost:8989/api/v3/calendar?start=2026-02-01&end=2026-02-07
  X-Api-Key: your_api_key
  ```
webhook_handling: |
  **Supported Events**:
  - **Download**: Episode downloaded
  - **EpisodeFileDelete**: Episode file deleted
  - **SeriesDelete**: Series deleted
  - **Rename**: Files renamed

  **Webhook Payload** (Download):
  ```json
  {
    "eventType": "Download",
    "series": {
      "id": 1,
      "title": "Breaking Bad",
      "tvdbId": 81189
    },
    "episodes": [
      {
        "id": 123,
        "seasonNumber": 1,
        "episodeNumber": 1,
        "title": "Pilot"
      }
    ],
    "episodeFile": {
      "path": "/tv/Breaking Bad/Season 01/Breaking.Bad.S01E01.720p.mkv",
      "quality": "HDTV-720p",
      "size": 1073741824
    }
  }
  ```
season_monitoring: |
  **Per-Season Monitoring**:
  - Monitor all seasons
  - Monitor latest season only (for ongoing shows)
  - Monitor specific seasons

  **Sonarr API**:
  ```json
  {
    "seasons": [
      {
        "seasonNumber": 1,
        "monitored": true
      },
      {
        "seasonNumber": 2,
        "monitored": false
      }
    ]
  }
  ```
unit_tests: |
  ```go
  func TestSonarrService_AddSeries(t *testing.T) {
    // Test adding series to Sonarr
  }

  func TestSonarrWebhook_EpisodeDownload(t *testing.T) {
    // Test episode download webhook
  }
  ```
