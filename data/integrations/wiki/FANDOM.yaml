doc_title: FANDOM Integration
doc_category: integration
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> ENRICHMENT link provider to fan-curated wikis for franchises'
wiki_tagline: '> FANDOM - Links to fan wikis for movies, TV, games'
wiki_overview: ENRICHMENT metadata source providing links to fan-curated wikis. Deep links to character pages, episode guides,
  and universe lore. Covers major franchises (Star Wars, Marvel, Game of Thrones, etc.). **No API key required** - uses MediaWiki
  API. Links appear on item detail pages for "Learn More" functionality.
sources:
- name: FANDOM API
  url: https://community.fandom.com/wiki/Community_Central:API
  note: MediaWiki-based API
- name: MediaWiki API
  url: https://www.mediawiki.org/wiki/API:Main_page
  note: Underlying API
- name: golang.org/x/time
  url: https://pkg.go.dev/golang.org/x/time
  note: Rate limiting
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
design_refs:
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
- title: WIKI_SYSTEM
  path: ../../features/shared/WIKI_SYSTEM.md
- title: WIKIPEDIA (similar MediaWiki integration)
  path: ./WIKIPEDIA.md
- title: MOVIE_MODULE
  path: ../../features/video/MOVIE_MODULE.md
- title: TVSHOW_MODULE
  path: ../../features/video/TVSHOW_MODULE.md
integration_name: FANDOM
integration_id: fandom
external_service: FANDOM (Wikia)
api_base_url: https://{wiki}.fandom.com/api.php
auth_method: none
architecture_diagram: |-
  ```mermaid
  flowchart TD
      node1["Revenge<br/>Detail Page<br/>[Movie/TV]"]
      node2[[FANDOM<br/>MediaWiki<br/>API]]
      node3["Fan Wiki Links<br/>- Character pages<br/>- Episode guides"]
      node4["Rate Limiter<br/>[polite]"]
      node2 --> node3
      node1 --> node2
      node3 --> node4
  ```
api_details: |
  **API**: MediaWiki API (same as Wikipedia)
  **Base URL**: `https://{wiki}.fandom.com/api.php`
  **Authentication**: None required
  **Rate Limit**: Be polite (~1 req/sec per wiki)

  **Key Parameters**:
  - `action=query` - Main query action
  - `action=opensearch` - Search suggestions
  - `titles={page}` - Get specific page
  - `prop=info|extracts` - Page info and content
  - `exintro=true` - Intro section only

  **Wiki Discovery**:
  - Map franchise to wiki subdomain
  - e.g., "Star Wars" â†’ "starwars.fandom.com"
database_schema: |
  ```sql
  -- FANDOM wiki mappings
  CREATE TABLE fandom_wikis (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    wiki_subdomain VARCHAR(100) NOT NULL UNIQUE,  -- 'starwars', 'marvel'
    wiki_name VARCHAR(255) NOT NULL,               -- 'Wookieepedia'
    franchise_keywords TEXT[],                     -- {'Star Wars', 'Mandalorian'}
    enabled BOOLEAN DEFAULT true,
    last_checked TIMESTAMPTZ
  );

  -- Content to FANDOM page links
  CREATE TABLE fandom_links (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    content_type VARCHAR(50) NOT NULL,    -- 'movie', 'tvshow', 'episode'
    content_id UUID NOT NULL,
    wiki_subdomain VARCHAR(100) NOT NULL,
    page_title VARCHAR(500) NOT NULL,
    page_url TEXT NOT NULL,
    link_type VARCHAR(50),                -- 'main', 'character', 'episode'
    verified BOOLEAN DEFAULT false,
    created_at TIMESTAMPTZ DEFAULT now(),
    UNIQUE(content_type, content_id, wiki_subdomain, page_title)
  );
  CREATE INDEX idx_fandom_links_content ON fandom_links(content_type, content_id);
  ```
module_structure: |
  ```
  internal/metadata/providers/fandom/
  â”œâ”€â”€ module.go                    # fx module
  â”œâ”€â”€ client.go                    # MediaWiki API client
  â”œâ”€â”€ provider.go                  # Link provider
  â”œâ”€â”€ wikis.go                     # Wiki registry (franchise mapping)
  â”œâ”€â”€ search.go                    # Page search
  â””â”€â”€ fandom_test.go
  ```
key_interfaces: |
  ```go
  // FANDOM link provider
  type FANDOMProvider struct {
    client      *http.Client
    rateLimiter *rate.Limiter
    wikiRegistry *WikiRegistry
    cache       Cache
  }

  // Wiki link provider interface
  type WikiLinkProvider interface {
    FindWikiForContent(ctx context.Context, content *Content) (*Wiki, error)
    SearchPage(ctx context.Context, wiki string, query string) ([]PageResult, error)
    GetPageInfo(ctx context.Context, wiki string, title string) (*PageInfo, error)
    GenerateLink(ctx context.Context, content *Content) (*WikiLink, error)
  }

  // Wiki registry
  type WikiRegistry struct {
    wikis map[string]*Wiki
  }

  type Wiki struct {
    Subdomain string   `json:"subdomain"`
    Name      string   `json:"name"`
    Keywords  []string `json:"keywords"`
  }

  // Wiki page info
  type PageInfo struct {
    Title    string `json:"title"`
    PageID   int    `json:"pageid"`
    URL      string `json:"fullurl"`
    Extract  string `json:"extract,omitempty"`
    Exists   bool   `json:"exists"`
  }

  // Link to display in UI
  type WikiLink struct {
    WikiName string `json:"wiki_name"`
    PageTitle string `json:"page_title"`
    URL       string `json:"url"`
    LinkType  string `json:"type"`  // 'main', 'character', 'episode'
  }
  ```
dependencies: |
  **Go Packages**:
  - `net/http` - HTTP client
  - `golang.org/x/time/rate` - Polite rate limiting
  - `github.com/jackc/pgx/v5` - PostgreSQL
  - `github.com/riverqueue/river` - Background jobs
  - `go.uber.org/fx` - DI

  **External**:
  - FANDOM MediaWiki API (free, no key)
env_vars: |
  ```bash
  FANDOM_ENABLED=true
  FANDOM_RATE_LIMIT=1
  FANDOM_CACHE_TTL=168h
  ```
config_keys: |
  ```yaml
  metadata:
    providers:
      fandom:
        enabled: true
        rate_limit: 1
        rate_window: 1s
        cache_ttl: 168h
        role: enrichment

        # Pre-configured wikis
        wikis:
          - subdomain: starwars
            name: Wookieepedia
            keywords: [Star Wars, Mandalorian, Ahsoka, Andor]
          - subdomain: marvel
            name: Marvel Database
            keywords: [Marvel, Avengers, X-Men, Spider-Man]
          - subdomain: gameofthrones
            name: Wiki of Westeros
            keywords: [Game of Thrones, House of the Dragon]
          - subdomain: memory-alpha
            name: Memory Alpha
            keywords: [Star Trek, Discovery, Strange New Worlds]
          - subdomain: lotr
            name: Tolkien Gateway
            keywords: [Lord of the Rings, Hobbit, Rings of Power]
  ```
component_interaction: |
  **Link Generation Flow**:
  1. User views movie/show detail page
  2. FANDOMProvider.FindWikiForContent() matches franchise
  3. Search wiki for page: `action=opensearch&search={title}`
  4. Verify page exists: `action=query&titles={title}`
  5. Store link in fandom_links table
  6. Display "View on {WikiName}" link in UI

  **Franchise Matching**:
  ```go
  func (r *WikiRegistry) FindWiki(content *Content) *Wiki {
    for _, wiki := range r.wikis {
      for _, keyword := range wiki.Keywords {
        if strings.Contains(content.Title, keyword) ||
           strings.Contains(content.Franchise, keyword) {
          return wiki
        }
      }
    }
    return nil
  }
  ```

  **UI Display**:
  ```
  Learn More:
  [ðŸ“– Wookieepedia] â†’ View "The Mandalorian" on starwars.fandom.com
  ```
api_request_examples: |
  **Search for Page**:
  ```bash
  curl "https://starwars.fandom.com/api.php?action=opensearch&search=The%20Mandalorian&limit=5&format=json"
  ```

  **Response**:
  ```json
  [
    "The Mandalorian",
    ["The Mandalorian", "The Mandalorian (TV series)", "The Mandalorian Chapter 1"],
    ["", "", ""],
    ["https://starwars.fandom.com/wiki/The_Mandalorian", "...", "..."]
  ]
  ```

  **Get Page Info**:
  ```bash
  curl "https://starwars.fandom.com/api.php?action=query&titles=The_Mandalorian&prop=info|extracts&exintro=true&format=json"
  ```
enrichment_role: |
  **ENRICHMENT-Only Provider**

  FANDOM provides supplementary fan-curated information:
  - Character backstories and lore
  - Episode guides and recaps
  - Universe timelines
  - Behind-the-scenes info
  - Fan theories and trivia

  **Not used for primary metadata**:
  - TMDb/TVDB for movie/TV core metadata
  - ComicVine for comics

  **Use Cases**:
  - "Learn More" links on detail pages
  - Deep dive into franchise lore
  - Episode-specific wiki pages
  - Character relationship info
error_handling: |
  **Common Scenarios**:
  - Page not found â†’ No link displayed
  - Wiki subdomain invalid â†’ Skip wiki
  - Rate limited â†’ Back off and retry
unit_tests: |
  ```go
  func TestFANDOM_FindWiki(t *testing.T) {
    registry := NewWikiRegistry(testWikis)

    content := &Content{Title: "The Mandalorian", Franchise: "Star Wars"}
    wiki := registry.FindWiki(content)

    require.NotNil(t, wiki)
    assert.Equal(t, "starwars", wiki.Subdomain)
  }

  func TestFANDOM_SearchPage(t *testing.T) {
    mockResp := `["The Mandalorian",["The Mandalorian"],[""],["https://..."]]`
    provider := NewFANDOMProvider(mockClient(mockResp))

    results, err := provider.SearchPage(ctx, "starwars", "The Mandalorian")
    require.NoError(t, err)
    assert.Len(t, results, 1)
  }
  ```
best_practices: |
  **API Usage**:
  - Be polite (1 req/sec per wiki)
  - Cache page existence for 7+ days
  - Verify links periodically

  **Wiki Mapping**:
  - Maintain keyword list for popular franchises
  - Allow user configuration for custom wikis
  - Fall back to no link if no wiki matches

  **Link Quality**:
  - Prefer main article over disambiguation
  - Link to specific episode pages when available
  - Verify page exists before displaying link
