doc_title: ComicVine API Integration
doc_category: integration
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> PRIMARY comics metadata provider - comprehensive database from GameSpot'
wiki_tagline: '> ComicVine - Primary comic book metadata'
wiki_overview: PRIMARY metadata source for comics libraries. Comprehensive database covering Marvel, DC, indie publishers,
  and manga. Issue details, story arcs, characters, and creators. Community wiki with detailed information. Free API key required.
  200 req/hour rate limit.
sources:
- name: ComicVine API
  url: https://comicvine.gamespot.com/api/documentation
  note: Auto-resolved from comicvine
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: golang.org/x/time
  url: https://pkg.go.dev/golang.org/x/time
  note: Rate limiting
design_refs:
- title: 03_METADATA_SYSTEM
  path: ../../../architecture/03_METADATA_SYSTEM.md
- title: COMICS_MODULE
  path: ../../../features/comics/COMICS_MODULE.md
- title: HTTP_CLIENT
  path: ../../../services/HTTP_CLIENT.md
integration_name: ComicVine API
integration_id: comicvine
external_service: ComicVine API
api_base_url: https://comicvine.gamespot.com/api
auth_method: api_key
architecture_diagram: |-
  ```mermaid
  flowchart TD
      node1["Revenge<br/>Comics<br/>Library"]
      node2["ComicVine<br/>API"]
      node3["Metadata<br/>- Series"]
      node4["Rate Limiter"]
      node2 --> node3
      node1 --> node2
      node3 --> node4
  ```
api_details: |
  **API Version**: v1.0
  **Base URL**: `https://comicvine.gamespot.com/api`
  **Authentication**: API key via `api_key` query parameter
  **Rate Limit**: 200 requests per hour

  **Key Endpoints**:
  - `/search` - Search across all resources
  - `/volume/{id}` - Comic series details
  - `/issue/{id}` - Single issue details
  - `/issues` - List/filter issues
  - `/character/{id}` - Character information
  - `/person/{id}` - Creator information
  - `/story_arc/{id}` - Story arc details
  - `/publisher/{id}` - Publisher info

  **Response Format**: JSON (add `format=json` to requests)
  **Field Filtering**: Use `field_list` parameter to limit response
database_schema: |
  ```sql
  -- Comic volumes (series)
  CREATE TABLE comic_volumes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    comicvine_id INT UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    start_year INT,
    publisher VARCHAR(255),
    description TEXT,
    issue_count INT,
    image_url TEXT,
    api_url TEXT,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_comic_volumes_cv ON comic_volumes(comicvine_id);

  -- Comic issues
  CREATE TABLE comic_issues (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    volume_id UUID REFERENCES comic_volumes(id),
    comicvine_id INT UNIQUE NOT NULL,
    issue_number VARCHAR(20),
    name VARCHAR(255),
    description TEXT,
    cover_date DATE,
    store_date DATE,
    image_url TEXT,
    page_count INT,
    file_path TEXT,
    created_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_comic_issues_volume ON comic_issues(volume_id);

  -- Characters in issues
  CREATE TABLE comic_issue_characters (
    issue_id UUID REFERENCES comic_issues(id),
    comicvine_character_id INT NOT NULL,
    character_name VARCHAR(255),
    PRIMARY KEY (issue_id, comicvine_character_id)
  );

  -- Creators (writers, artists, etc.)
  CREATE TABLE comic_issue_creators (
    issue_id UUID REFERENCES comic_issues(id),
    comicvine_person_id INT NOT NULL,
    person_name VARCHAR(255),
    role VARCHAR(100),
    PRIMARY KEY (issue_id, comicvine_person_id, role)
  );
  ```
module_structure: |
  ```
  internal/metadata/providers/comicvine/
  â”œâ”€â”€ module.go                    # fx module
  â”œâ”€â”€ client.go                    # API client
  â”œâ”€â”€ provider.go                  # Metadata provider
  â”œâ”€â”€ search.go                    # Search implementation
  â”œâ”€â”€ volumes.go                   # Series/volume methods
  â”œâ”€â”€ issues.go                    # Issue methods
  â”œâ”€â”€ characters.go                # Character methods
  â”œâ”€â”€ ratelimit.go                 # 200/hour rate limiter
  â””â”€â”€ comicvine_test.go
  ```
key_interfaces: |
  ```go
  // ComicVine provider
  type ComicVineProvider struct {
    apiKey      string
    client      *http.Client
    rateLimiter *rate.Limiter
    cache       Cache
  }

  // Comics metadata provider interface
  type ComicsMetadataProvider interface {
    Search(ctx context.Context, query string, resourceType string) ([]SearchResult, error)
    GetVolume(ctx context.Context, id int) (*Volume, error)
    GetIssue(ctx context.Context, id int) (*Issue, error)
    GetVolumeIssues(ctx context.Context, volumeID int) ([]*Issue, error)
    GetCharacter(ctx context.Context, id int) (*Character, error)
    GetCreator(ctx context.Context, id int) (*Person, error)
  }

  // Volume (comic series)
  type Volume struct {
    ID          int       `json:"id"`
    Name        string    `json:"name"`
    StartYear   int       `json:"start_year"`
    Publisher   *Publisher `json:"publisher"`
    Description string    `json:"description"`
    IssueCount  int       `json:"count_of_issues"`
    ImageURL    string    `json:"image.original_url"`
  }

  // Single issue
  type Issue struct {
    ID           int       `json:"id"`
    IssueNumber  string    `json:"issue_number"`
    Name         string    `json:"name"`
    Description  string    `json:"description"`
    CoverDate    string    `json:"cover_date"`
    StoreDate    string    `json:"store_date"`
    ImageURL     string    `json:"image.original_url"`
    Volume       *Volume   `json:"volume"`
    Characters   []*Character `json:"character_credits"`
    Creators     []*Person `json:"person_credits"`
    StoryArcs    []*StoryArc `json:"story_arc_credits"`
  }
  ```
dependencies: |
  **Go Packages**:
  - `net/http` - HTTP client
  - `golang.org/x/time/rate` - Rate limiting (200/hour = ~3.3/min)
  - `github.com/jackc/pgx/v5` - PostgreSQL
  - `github.com/riverqueue/river` - Background jobs
  - `go.uber.org/fx` - DI

  **External**:
  - ComicVine API (free API key required)
env_vars: |
  ```bash
  COMICVINE_API_KEY=your_api_key
  COMICVINE_ENABLED=true
  COMICVINE_CACHE_TTL=168h    # 7 days
  ```
config_keys: |
  ```yaml
  metadata:
    providers:
      comicvine:
        enabled: true
        api_key: ${COMICVINE_API_KEY}
        rate_limit: 200
        rate_window: 1h
        cache_ttl: 168h
        role: primary
        priority: 10
  ```
component_interaction: |
  **Comic File Import**:
  1. CBZ/CBR file added to library
  2. Parse filename for series/issue (e.g., "Batman (2016) #50")
  3. Search ComicVine: `GET /search?query=Batman 2016&resources=volume`
  4. Match volume by name and start year
  5. Fetch volume issues: `GET /issues?filter=volume:{id}`
  6. Match issue by number
  7. Fetch full issue details: `GET /issue/{id}`
  8. Store metadata and link to file

  **Metadata Refresh**:
  1. Background job runs periodically
  2. For recently added series, fetch new issues
  3. Update changed metadata
  4. Download updated cover images
api_request_examples: |
  **Search for Volume**:
  ```bash
  curl "https://comicvine.gamespot.com/api/search?api_key=KEY&format=json&resources=volume&query=Batman%202016"
  ```

  **Get Volume Details**:
  ```bash
  curl "https://comicvine.gamespot.com/api/volume/4050-100016?api_key=KEY&format=json&field_list=name,start_year,publisher,description,count_of_issues,image"
  ```

  **Get Issue**:
  ```bash
  curl "https://comicvine.gamespot.com/api/issue/4000-700001?api_key=KEY&format=json"
  ```

  **Response (Issue)**:
  ```json
  {
    "results": {
      "id": 700001,
      "issue_number": "50",
      "name": "The Wedding",
      "cover_date": "2018-07-04",
      "image": {"original_url": "https://..."},
      "character_credits": [
        {"id": 1699, "name": "Batman"},
        {"id": 4370, "name": "Catwoman"}
      ],
      "person_credits": [
        {"id": 40439, "name": "Tom King", "role": "writer"}
      ]
    }
  }
  ```
rate_limiting: |
  **ComicVine Rate Limits**:
  - 200 requests per hour (per API key)
  - ~3.3 requests per minute

  **Implementation**:
  ```go
  // Rate limiter: 200 req/hour = 1 request per 18 seconds
  rateLimiter := rate.NewLimiter(rate.Every(18*time.Second), 1)

  func (c *ComicVineClient) request(ctx context.Context, url string) (*http.Response, error) {
    if err := c.rateLimiter.Wait(ctx); err != nil {
      return nil, err
    }
    return c.client.Get(url)
  }
  ```

  **Caching Strategy**:
  - Cache volume/issue data for 7 days
  - Cache search results for 1 hour
  - Aggressive caching reduces API calls
error_handling: |
  **HTTP Errors**:
  - 401 Unauthorized â†’ Invalid API key
  - 420 Rate Limit â†’ Wait before retry
  - 404 Not Found â†’ Resource doesn't exist
unit_tests: |
  ```go
  func TestComicVine_SearchVolume(t *testing.T) {
    mockResp := `{"results":[{"id":100016,"name":"Batman"}]}`
    provider := NewComicVineProvider("test-key", mockClient(mockResp))

    results, err := provider.Search(ctx, "Batman", "volume")
    require.NoError(t, err)
    assert.Len(t, results, 1)
  }
  ```
best_practices: |
  **API Usage**:
  - Always include `format=json`
  - Use `field_list` to minimize response size
  - Cache aggressively (7+ days for stable data)

  **Matching**:
  - Parse filename carefully (series, year, issue#)
  - Use year to disambiguate series
  - Fall back to fuzzy matching

  **Rate Limits**:
  - Implement proper rate limiting
  - Queue bulk imports as background jobs
  - Use cache before making API calls
