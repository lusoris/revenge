doc_title: ThePosterDB Integration
doc_category: integration
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> Curated high-quality posters for movies and TV shows'
wiki_tagline: '> Premium curated poster artwork'
wiki_overview: ThePosterDB offers designer-quality posters and artwork for your library. Community-curated collection with
  consistent styling options. Browse by collection sets for matching artwork across related titles. Higher quality than standard
  metadata sources. Connect your ThePosterDB account to access the full library.
sources:
- name: go-blurhash
  url: https://pkg.go.dev/github.com/bbrks/go-blurhash
  note: Auto-resolved from go-blurhash
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: ThePosterDB API
  url: https://theposterdb.com/api
  note: Auto-resolved from theposterdb
design_refs:
- title: 01_ARCHITECTURE
  path: ../../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../../architecture/03_METADATA_SYSTEM.md
integration_name: ThePosterDB
integration_id: theposterdb
external_service: ThePosterDB
auth_method: api_key
architecture_diagram: |-
  ```mermaid
  flowchart TD
      node1["Metadata<br/>Service"]
      node2["ThePosterDB<br/>Provider"]
      node3["PosterDB API<br/>(External)"]
      node4["Image Download<br/>& Storage"]
      node1 --> node2
      node2 --> node3
      node3 --> node4
  ```
api_details: |
  **API Version**: v4
  **Base URL**: `https://theposterdb.com/api`
  **Authentication**: API Key via X-API-Key header
  **Rate Limit**: No official limit, respect fair use

  **Key Endpoints**:
  - `/search` - Search for posters by title
  - `/poster/{id}` - Get poster details
  - `/set/{id}` - Get poster set (matching collection)
  - `/movie/{tmdb_id}` - Get posters for TMDb movie
  - `/tv/{tvdb_id}` - Get posters for TheTVDB show

  **Poster Types**:
  - Movie posters
  - TV show posters
  - Season posters
  - Collection sets (matching style)
database_schema: |
  **Schema**: `public`

  ```sql
  -- Custom poster selections
  CREATE TABLE custom_posters (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    content_type VARCHAR(50) NOT NULL,     -- 'movie', 'tvshow', 'season'
    content_id UUID NOT NULL,

    -- ThePosterDB reference
    posterdb_id INTEGER NOT NULL,
    poster_url TEXT NOT NULL,
    thumbnail_url TEXT,

    -- Local storage
    local_path TEXT,
    blurhash TEXT,

    -- User preference
    is_active BOOLEAN DEFAULT true,
    selected_by UUID REFERENCES users(id) ON DELETE SET NULL,
    selected_at TIMESTAMPTZ DEFAULT now(),

    created_at TIMESTAMPTZ DEFAULT now(),
    UNIQUE(content_type, content_id)
  );
  CREATE INDEX idx_custom_posters_content ON custom_posters(content_type, content_id);
  ```
module_structure: |
  ```
  internal/metadata/providers/posterdb/
  â”œâ”€â”€ module.go                    # fx module
  â”œâ”€â”€ client.go                    # ThePosterDB API client
  â”œâ”€â”€ provider.go                  # Poster provider interface impl
  â”œâ”€â”€ search.go                    # Search methods
  â”œâ”€â”€ download.go                  # Image download and storage
  â””â”€â”€ posterdb_test.go
  ```
key_interfaces: |
  ```go
  // ThePosterDB provider implementation
  type PosterDBProvider struct {
    client      *PosterDBClient
    storage     ImageStorage
    cache       Cache
  }

  // Poster provider interface
  type PosterProvider interface {
    // Search
    SearchPosters(ctx context.Context, query string, contentType string) ([]Poster, error)

    // Get by TMDb/TVDB ID
    GetMoviePosters(ctx context.Context, tmdbID int) ([]Poster, error)
    GetTVPosters(ctx context.Context, tvdbID int) ([]Poster, error)

    // Get poster sets (matching collections)
    GetPosterSet(ctx context.Context, setID int) (*PosterSet, error)

    // Download and apply
    DownloadPoster(ctx context.Context, posterID int) (string, error)
    ApplyPoster(ctx context.Context, contentID uuid.UUID, posterID int) error
  }

  // Poster metadata structure
  type Poster struct {
    ID            int    `json:"id"`
    Title         string `json:"title"`
    OriginalURL   string `json:"url"`
    ThumbnailURL  string `json:"thumbnail"`
    Width         int    `json:"width"`
    Height        int    `json:"height"`
    Language      string `json:"language"`
    Uploader      string `json:"uploader"`
    Likes         int    `json:"likes"`
    SetID         *int   `json:"set_id,omitempty"`
  }

  // Poster set (matching collection)
  type PosterSet struct {
    ID      int      `json:"id"`
    Name    string   `json:"name"`
    Posters []Poster `json:"posters"`
  }
  ```
dependencies: |
  **Go Packages**:
  - `net/http` - HTTP client
  - `github.com/google/uuid` - UUID support
  - `github.com/jackc/pgx/v5` - PostgreSQL driver
  - `github.com/bbrks/go-blurhash` - Blurhash generation
  - `github.com/riverqueue/river` - Background download jobs
  - `go.uber.org/fx` - Dependency injection

  **External APIs**:
  - ThePosterDB API (free with registration)
env_vars: |
  ```bash
  # ThePosterDB API
  POSTERDB_API_KEY=your_api_key_here

  # Image storage
  POSTERDB_STORAGE_PATH=/data/posters
  POSTERDB_GENERATE_BLURHASH=true

  # Caching
  POSTERDB_CACHE_TTL=168h  # 7 days
  ```
config_keys: |
  ```yaml
  metadata:
    providers:
      posterdb:
        enabled: true
        api_key: ${POSTERDB_API_KEY}
        storage_path: /data/posters
        generate_blurhash: true
        cache_ttl: 168h
  ```
component_interaction: |
  **Manual Poster Selection Workflow**:
  1. User views movie detail page
  2. Clicks "Change Poster" button
  3. Frontend calls: GET /api/v1/posters/search?q=Inception&type=movie
  4. Service calls PosterDBProvider.SearchPosters("Inception", "movie")
  5. API request to ThePosterDB: /search?term=Inception
  6. Return list of available posters with thumbnails
  7. User selects preferred poster
  8. Frontend calls: POST /api/v1/movies/{id}/poster with posterdb_id
  9. Service enqueues DownloadPosterJob via River
  10. Background worker downloads full-size poster
  11. Generate blurhash for lazy loading
  12. Store poster in local file system
  13. Update custom_posters table
  14. Invalidate cache for movie metadata
  15. Next request returns new poster URL

  **Automatic Poster Enhancement**:
  1. Library scan finds new movie
  2. TMDb metadata fetched (includes default poster)
  3. Optionally fetch enhanced poster from ThePosterDB
  4. Compare quality (resolution, likes)
  5. If ThePosterDB poster is higher quality, use it
  6. Otherwise keep TMDb poster

  **Poster Sets** (matching collections):
  1. User has "The Lord of the Rings" trilogy
  2. Wants matching poster style for all 3 movies
  3. Search for poster set: /set/123
  4. ThePosterDB returns set with 3 matching posters
  5. Apply all 3 posters to respective movies
  6. Visually cohesive library
api_request_examples: |
  **Search Posters**:
  ```
  GET https://theposterdb.com/api/search?term=Inception&type=movie
  X-API-Key: your_api_key_here
  ```

  **Response**:
  ```json
  {
    "results": [
      {
        "id": 12345,
        "title": "Inception",
        "url": "https://theposterdb.com/api/assets/12345",
        "thumbnail": "https://theposterdb.com/api/assets/12345/thumb",
        "width": 2000,
        "height": 3000,
        "language": "en",
        "uploader": "designer123",
        "likes": 452,
        "set_id": 789
      }
    ]
  }
  ```

  **Get Movie Posters by TMDb ID**:
  ```
  GET https://theposterdb.com/api/movie/27205
  X-API-Key: your_api_key_here
  ```

  **Download Poster**:
  ```
  GET https://theposterdb.com/api/assets/12345
  ```
  Returns: Binary image data (JPEG or PNG)
poster_storage: |
  **Storage Strategy**:
  - Store downloaded posters in file system: `/data/posters/{type}/{content_id}.jpg`
  - Generate multiple sizes: original, large (1080p), medium (720p), small (480p)
  - Generate blurhash for lazy loading placeholders
  - Store metadata in custom_posters table

  **Directory Structure**:
  ```
  /data/posters/
  â”œâ”€â”€ movies/
  â”‚   â”œâ”€â”€ {movie_uuid}.jpg
  â”‚   â”œâ”€â”€ {movie_uuid}_large.jpg
  â”‚   â”œâ”€â”€ {movie_uuid}_medium.jpg
  â”‚   â””â”€â”€ {movie_uuid}_small.jpg
  â”œâ”€â”€ tvshows/
  â”‚   â””â”€â”€ ...
  â””â”€â”€ seasons/
      â””â”€â”€ ...
  ```

  **Image Processing**:
  1. Download original high-res poster
  2. Resize to multiple sizes using imaging library
  3. Optimize with quality setting (85% JPEG)
  4. Generate blurhash (4x6 components for portraits)
  5. Store all versions
poster_quality_comparison: |
  **Quality Metrics**:
  - **Resolution**: Width x Height (higher is better)
  - **Aspect Ratio**: Should match standard poster ratio (2:3)
  - **Community Votes**: Likes/upvotes on ThePosterDB
  - **Language**: Match user's preferred language

  **Selection Algorithm**:
  ```go
  func selectBestPoster(tmdbPoster, posterdbPosters []Poster) Poster {
    // Start with TMDb default
    best := tmdbPoster

    for _, poster := range posterdbPosters {
      // Check resolution
      if poster.Width > best.Width && poster.Height > best.Height {
        best = poster
        continue
      }

      // Check community preference
      if poster.Likes > 100 {
        best = poster
        continue
      }

      // Prefer English posters (or user's language)
      if poster.Language == userLanguage && best.Language != userLanguage {
        best = poster
      }
    }

    return best
  }
  ```
poster_sets: |
  **Collection Matching**:
  - ThePosterDB organizes posters into "sets"
  - Sets contain matching posters for related content
  - Example: Star Wars trilogy with consistent style

  **Applying Poster Set**:
  1. User selects "Apply Set" on collection page
  2. Backend fetches set: GET /set/{id}
  3. Response includes posters for all items in set
  4. Map each poster to correct movie by TMDb ID
  5. Enqueue download jobs for all posters
  6. Apply to entire collection at once

  **Benefits**:
  - Visual cohesion in library
  - Professional curated collections
  - Popular sets: MCU, DC, Criterion Collection styles
unit_tests: |
  ```go
  func TestPosterDBProvider_SearchPosters(t *testing.T) {
    // Test poster search with mock HTTP client
  }

  func TestPosterDBProvider_DownloadAndResize(t *testing.T) {
    // Test image download and resizing
  }
  ```
integration_tests: |
  ```go
  func TestPosterDB_FullWorkflow(t *testing.T) {
    // Use real ThePosterDB API (with test key)
    // Test search, download, apply poster
  }
  ```
user_experience: |
  **Frontend Integration**:
  - "Change Poster" button on movie/show detail pages
  - Modal popup with poster thumbnails
  - Grid view of available posters
  - Sort by: Newest, Most Liked, Resolution
  - Filter by: Language, Set membership
  - Preview before applying

  **Admin Features**:
  - Bulk poster replacement for entire library
  - Apply themed sets (e.g., "Minimal", "Vintage")
  - Revert to original TMDb poster
  - Queue poster downloads during off-peak hours
caching_strategy: |
  **Cache Layers**:
  - **Search Results**: 7 day TTL (posters don't change often)
  - **Downloaded Images**: Permanent until manually changed
  - **Thumbnails**: Served via CDN or reverse proxy cache

  **Cache Invalidation**:
  - Manual refresh when user changes poster
  - Automatic refresh if poster deleted from ThePosterDB
error_handling: |
  **API Error Responses**:
  - 401 Unauthorized â†’ Invalid API key
  - 404 Not Found â†’ Poster doesn't exist
  - 429 Too Many Requests â†’ Rate limit (wait and retry)

  **Download Failures**:
  - Network timeout â†’ Retry 3 times with backoff
  - Invalid image data â†’ Log error, keep existing poster
  - Disk full â†’ Alert admin, pause downloads
performance_optimization: |
  **Lazy Loading**:
  - Serve blurhash placeholders initially
  - Load actual images on demand
  - Progressive image loading (small â†’ large)

  **CDN Integration**:
  - Store posters in object storage (S3, Backblaze B2)
  - Serve via CDN for fast global delivery
  - Set long cache headers (1 year)
monitoring: |
  **Metrics Exposed**:
  - `posterdb_searches_total` - Total searches
  - `posterdb_downloads_total` - Posters downloaded
  - `posterdb_storage_bytes` - Disk usage
  - `posterdb_active_custom_posters` - Custom posters in use
