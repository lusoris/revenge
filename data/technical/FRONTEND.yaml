doc_title: Frontend Architecture
doc_category: technical
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: Complete frontend architecture
status_sources: âœ…
status_sources_notes: All frontend tools documented
status_instructions: âœ…
status_instructions_notes: Generated from design
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'

technical_summary: |
  > Frontend architecture with SvelteKit 2, Svelte 5, Tailwind CSS 4, and shadcn-svelte

  Modern reactive frontend for Revenge:
  - **SvelteKit 2**: Full-stack meta-framework with SSR
  - **Svelte 5**: Component framework with runes reactivity
  - **Tailwind CSS 4**: Utility-first CSS with Rust engine
  - **shadcn-svelte**: Accessible component library
  - **TanStack Query**: Server state management
  - **Vidstack**: Video player with HLS support

wiki_tagline: |
  > Beautiful, fast UI built with modern web technologies

wiki_overview: |
  The Revenge web interface is built with SvelteKit and Svelte 5 for a fast, reactive experience. Tailwind CSS provides consistent styling with dark mode support. The video player (Vidstack) handles HLS adaptive streaming, subtitles, and Chromecast. TanStack Query manages data fetching with automatic caching and background updates. Forms use Superforms with Zod validation for a smooth user experience.

sources:
  - name: Svelte 5 Documentation
    url: https://svelte.dev/docs/svelte/overview
    note: Component framework
  - name: Svelte 5 Runes
    url: https://svelte.dev/docs/svelte/$state
    note: Reactivity system
  - name: SvelteKit Documentation
    url: https://svelte.dev/docs/kit/introduction
    note: Full-stack framework
  - name: shadcn-svelte
    url: https://www.shadcn-svelte.com/docs
    note: Component library
  - name: Bits UI
    url: https://www.bits-ui.com/docs/introduction
    note: Headless UI primitives
  - name: TanStack Query
    url: https://tanstack.com/query/latest/docs/framework/svelte/overview
    note: Server state management
  - name: Vidstack Player
    url: https://www.vidstack.io/docs/player/getting-started/installation
    note: Video player
  - name: Vite Documentation
    url: https://vite.dev/guide/
    note: Build tool
  - name: TailwindCSS Documentation
    url: https://tailwindcss.com/docs
    note: Styling framework
  - name: Zod Documentation
    url: https://zod.dev/
    note: Schema validation
  - name: SvelteKit Superforms
    url: https://superforms.rocks/
    note: Form handling

design_refs:
  - title: technical
    path: technical/INDEX.md
  - title: TECH_STACK
    path: technical/TECH_STACK.md
  - title: 04_PLAYER_ARCHITECTURE
    path: architecture/04_PLAYER_ARCHITECTURE.md

framework: SvelteKit 2
ui_library: Svelte 5 (runes)
styling: Tailwind CSS 4
components: shadcn-svelte + Bits UI

project_structure: |
  ```
  frontend/
  â”œâ”€â”€ src/
  â”‚   â”œâ”€â”€ routes/               # SvelteKit file-based routing
  â”‚   â”‚   â”œâ”€â”€ +layout.svelte    # Root layout
  â”‚   â”‚   â”œâ”€â”€ +layout.ts        # Root layout data loading
  â”‚   â”‚   â”œâ”€â”€ +page.svelte      # Home page
  â”‚   â”‚   â”œâ”€â”€ movies/
  â”‚   â”‚   â”‚   â”œâ”€â”€ +page.svelte  # Movies list
  â”‚   â”‚   â”‚   â””â”€â”€ [id]/         # Movie detail
  â”‚   â”‚   â”‚       â””â”€â”€ +page.svelte
  â”‚   â”‚   â”œâ”€â”€ tv/
  â”‚   â”‚   â”œâ”€â”€ music/
  â”‚   â”‚   â””â”€â”€ settings/
  â”‚   â”œâ”€â”€ lib/
  â”‚   â”‚   â”œâ”€â”€ components/       # Reusable components
  â”‚   â”‚   â”‚   â”œâ”€â”€ ui/           # shadcn-svelte components
  â”‚   â”‚   â”‚   â”œâ”€â”€ layout/       # Layout components
  â”‚   â”‚   â”‚   â””â”€â”€ features/     # Feature-specific components
  â”‚   â”‚   â”œâ”€â”€ stores/           # Svelte stores
  â”‚   â”‚   â”œâ”€â”€ api/              # API client
  â”‚   â”‚   â”œâ”€â”€ utils/            # Utilities
  â”‚   â”‚   â””â”€â”€ types/            # TypeScript types
  â”‚   â”œâ”€â”€ app.html              # HTML template
  â”‚   â””â”€â”€ app.css               # Global styles
  â”œâ”€â”€ static/                   # Static assets
  â”œâ”€â”€ package.json
  â”œâ”€â”€ vite.config.ts
  â”œâ”€â”€ svelte.config.js
  â”œâ”€â”€ tailwind.config.js
  â””â”€â”€ tsconfig.json
  ```

component_organization: |
  **Component Categories**:

  1. **UI Components** (`lib/components/ui/`):
     - shadcn-svelte primitives (Button, Card, Dialog, etc.)
     - Reusable, accessible, themeable

  2. **Layout Components** (`lib/components/layout/`):
     - Header, Sidebar, Footer
     - Navigation, Breadcrumbs

  3. **Feature Components** (`lib/components/features/`):
     - MovieCard, TVShowCard, AlbumCard
     - VideoPlayer, AudioPlayer
     - LibraryGrid, ItemDetail

  **Component Naming**:
  - PascalCase for components: `MovieCard.svelte`
  - kebab-case for files: `movie-card.svelte` (SvelteKit convention)

state_management: |
  **Svelte Runes** (local state):
  ```svelte
  <script lang="ts">
    import { $state, $derived, $effect } from 'svelte';

    let count = $state(0);
    let doubled = $derived(count * 2);

    $effect(() => {
      console.log(`Count is now ${count}`);
    });
  </script>
  ```

  **Svelte Stores** (shared state):
  ```typescript
  // lib/stores/auth.ts
  import { writable } from 'svelte/store';

  export const user = writable<User | null>(null);
  export const isAuthenticated = writable(false);
  ```

  **TanStack Query** (server state):
  ```svelte
  <script lang="ts">
    import { createQuery } from '@tanstack/svelte-query';

    const moviesQuery = createQuery({
      queryKey: ['movies'],
      queryFn: () => api.movies.list()
    });
  </script>

  {#if $moviesQuery.isLoading}
    <Spinner />
  {:else if $moviesQuery.error}
    <Error message={$moviesQuery.error.message} />
  {:else}
    <MovieGrid movies={$moviesQuery.data} />
  {/if}
  ```

styling_system: |
  **Tailwind CSS 4** (Rust engine, CSS-first config):

  ```css
  /* app.css */
  @import "tailwindcss";

  @theme {
    --color-revenge-primary: #6366f1;
    --color-revenge-secondary: #ec4899;
    --radius: 0.5rem;
  }
  ```

  **Component Styling**:
  ```svelte
  <div class="rounded-lg bg-background p-4 shadow-md">
    <h2 class="text-2xl font-bold text-foreground">Title</h2>
  </div>
  ```

  **Dark Mode**:
  - Class-based: `dark:bg-gray-900`
  - Theme toggle in root layout
  - Persisted to localStorage

api_client: |
  **Generated from OpenAPI**:
  ```typescript
  // lib/api/client.ts
  import { createClient } from '@hey-api/openapi-ts';

  export const api = createClient({
    baseUrl: '/api/v1',
    headers: {
      'Authorization': `Bearer ${getToken()}`
    }
  });
  ```

  **Usage in Components**:
  ```svelte
  <script lang="ts">
    import { api } from '$lib/api/client';
    import { createQuery } from '@tanstack/svelte-query';

    const moviesQuery = createQuery({
      queryKey: ['movies'],
      queryFn: () => api.movies.getMovies({ limit: 20 })
    });
  </script>
  ```

forms_and_validation: |
  **Superforms + Zod**:

  ```typescript
  // lib/schemas/movie.ts
  import { z } from 'zod';

  export const movieSchema = z.object({
    title: z.string().min(1, 'Title is required'),
    year: z.number().min(1900).max(2100),
    rating: z.number().min(0).max(10).optional()
  });
  ```

  ```svelte
  <script lang="ts">
    import { superForm } from 'sveltekit-superforms/client';
    import { movieSchema } from '$lib/schemas/movie';

    export let data;

    const { form, errors, enhance } = superForm(data.form, {
      validators: movieSchema
    });
  </script>

  <form method="POST" use:enhance>
    <input bind:value={$form.title} />
    {#if $errors.title}
      <span class="text-red-500">{$errors.title}</span>
    {/if}

    <button type="submit">Save</button>
  </form>
  ```

authentication: |
  **JWT Storage**:
  - Access token: Memory (not localStorage, XSS protection)
  - Refresh token: HttpOnly cookie

  **Auth Flow**:
  1. Login â†’ Server sets refresh token cookie
  2. Client receives access token in response
  3. Store access token in memory
  4. Use access token for API calls
  5. On 401, refresh access token using refresh cookie

  **Auth Store**:
  ```typescript
  // lib/stores/auth.ts
  import { writable } from 'svelte/store';

  let accessToken: string | null = null;

  export const user = writable<User | null>(null);

  export async function login(email: string, password: string) {
    const res = await api.auth.login({ email, password });
    accessToken = res.access_token;
    user.set(res.user);
  }

  export function getAccessToken() {
    return accessToken;
  }
  ```

routing: |
  **File-Based Routing** (SvelteKit):

  | Route File | URL | Description |
  |------------|-----|-------------|
  | `routes/+page.svelte` | `/` | Home page |
  | `routes/movies/+page.svelte` | `/movies` | Movies list |
  | `routes/movies/[id]/+page.svelte` | `/movies/123` | Movie detail |
  | `routes/settings/+layout.svelte` | `/settings/*` | Settings layout |

  **Data Loading** (`+page.ts`):
  ```typescript
  // routes/movies/[id]/+page.ts
  export async function load({ params, fetch }) {
    const movie = await fetch(`/api/v1/movies/${params.id}`).then(r => r.json());
    return { movie };
  }
  ```

video_player: |
  **Vidstack Player** (HLS, DASH, MP4):

  ```svelte
  <script lang="ts">
    import { MediaPlayer, MediaProvider } from '@vidstack/svelte';
    import '@vidstack/styles/defaults.css';

    export let src: string;
    export let poster: string;
  </script>

  <MediaPlayer title="Movie Title" {src} {poster}>
    <MediaProvider />
    <!-- Custom controls -->
  </MediaPlayer>
  ```

  **Features**:
  - HLS adaptive streaming
  - Subtitle tracks
  - Chapter markers
  - Keyboard shortcuts
  - Picture-in-Picture
  - Chromecast support

build_and_dev: |
  **Development**:
  ```bash
  cd frontend
  npm run dev  # Vite dev server at http://localhost:5173
  ```

  **Build**:
  ```bash
  npm run build  # SvelteKit build
  ```

  **Preview**:
  ```bash
  npm run preview  # Preview production build
  ```

  **Vite Config** (`vite.config.ts`):
  ```typescript
  import { sveltekit } from '@sveltejs/kit/vite';
  import { defineConfig } from 'vite';

  export default defineConfig({
    plugins: [sveltekit()],
    server: {
      port: 5173,
      proxy: {
        '/api': 'http://localhost:8080'
      }
    }
  });
  ```

testing: |
  **Unit Tests** (Vitest):
  ```bash
  npm run test
  ```

  **E2E Tests** (Playwright):
  ```bash
  npm run test:e2e
  ```

performance_optimization: |
  **Code Splitting**:
  - Automatic route-based splitting (SvelteKit)
  - Dynamic imports for large components

  **Image Optimization**:
  - `@sveltejs/enhanced-img` for responsive images
  - Lazy loading with `loading="lazy"`

  **Caching**:
  - TanStack Query cache
  - Service Worker for offline support

  **Bundle Size**:
  - Tree-shaking (Vite)
  - Svelte compile-time optimization
  - Target: < 200KB initial JS bundle
