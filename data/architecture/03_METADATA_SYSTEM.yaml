doc_title: Revenge - Metadata System
doc_category: architecture
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: ðŸŸ¡
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: Generated from design
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: |
  > Multi-source metadata system with caching and priority chain

  Metadata handling:
  - **Priority Chain**: Local cache â†’ Arr services â†’ Internal (Stash) â†’ External APIs
  - **Providers**: TMDb, TheTVDB, MusicBrainz, StashDB, and many more
  - **Caching**: Two-tier with otter (L1 memory) and rueidis (L2 distributed)
  - **Enrichment**: Background jobs for additional metadata, thumbnails, blurhash
  - **Matching**: Fingerprinting for audio, hash matching for media

wiki_tagline: '> How Revenge finds and stores information about your media'

wiki_overview: 'The metadata system gathers information about your media from multiple sources. It always checks local cache first for instant display, then queries Arr services (Radarr, Sonarr) which already have metadata, then external APIs like TMDb or MusicBrainz. Background jobs enrich media with additional data like cast info, thumbnails, and blurhash previews. Two-tier caching (memory + distributed) ensures fast lookups even for large libraries.'
sources:
- name: Dragonfly Documentation
  url: https://www.dragonflydb.io/docs
  note: Auto-resolved from dragonfly
- name: go-blurhash
  url: https://pkg.go.dev/github.com/bbrks/go-blurhash
  note: Auto-resolved from go-blurhash
- name: Last.fm API
  url: https://www.last.fm/api/intro
  note: Auto-resolved from lastfm-api
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: rueidis
  url: https://pkg.go.dev/github.com/redis/rueidis
  note: Auto-resolved from rueidis
- name: rueidis GitHub README
  url: https://github.com/redis/rueidis
  note: Auto-resolved from rueidis-docs
design_refs:
- title: architecture
  path: architecture/INDEX.md
- title: ADULT_CONTENT_SYSTEM
  path: ADULT_CONTENT_SYSTEM.md
- title: ADULT_METADATA
  path: ADULT_METADATA.md
- title: DATA_RECONCILIATION
  path: DATA_RECONCILIATION.md
