doc_title: Internal Wiki System
doc_category: feature
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> Modern, integrated knowledge base for users, mods, admins, and devs'
wiki_tagline: '> Built-in documentation and help system'
wiki_overview: Self-hosted wiki for server documentation and guides. Create articles for users explaining how to use features,
  for moderators on content policies, and for admins on server management. Markdown editor with live preview. Search across
  all articles. Permission-controlled sections keep sensitive docs private. Versioned content tracks changes over time.
sources:
- name: Casbin
  url: https://pkg.go.dev/github.com/casbin/casbin/v2
  note: Auto-resolved from casbin
- name: Uber fx
  url: https://pkg.go.dev/go.uber.org/fx
  note: Auto-resolved from fx
- name: Go io
  url: https://pkg.go.dev/io
  note: Auto-resolved from go-io
- name: ogen OpenAPI Generator
  url: https://pkg.go.dev/github.com/ogen-go/ogen
  note: Auto-resolved from ogen
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: sqlc
  url: https://docs.sqlc.dev/en/stable/
  note: Auto-resolved from sqlc
- name: sqlc Configuration
  url: https://docs.sqlc.dev/en/stable/reference/config.html
  note: Auto-resolved from sqlc-config
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
feature_name: Internal Wiki System
module_name: internal_wiki_system
schema_name: public
architecture_diagram: |-
  ```mermaid
  flowchart TD
      node1([Client<br/>(Web/App)])
      node2[[API Handler<br/>(ogen)]]
      node3[[Service<br/>(Logic)]]
      node4["Repository<br/>(sqlc)"]
      node5[[Metadata<br/>Service]]
      node6[(Cache<br/>(otter))]
      node7[(PostgreSQL<br/>(pgx))]
      node8([External<br/>APIs])
      node1 --> node2
      node2 --> node3
      node4 --> node5
      node5 --> node6
      node7 --> node8
      node3 --> node4
      node6 --> node7
  ```
database_schema: |
  **Schema**: `public`

  ```sql
  -- Wiki pages
  CREATE TABLE wiki_pages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    -- Page identification
    slug VARCHAR(255) NOT NULL UNIQUE,             -- URL-friendly identifier
    title TEXT NOT NULL,

    -- Content (Markdown)
    content TEXT NOT NULL,
    content_html TEXT,                             -- Rendered HTML (cached)

    -- Organization
    category VARCHAR(100),                         -- 'users', 'moderators', 'admins', 'developers'
    tags TEXT[] DEFAULT '{}',
    parent_page_id UUID REFERENCES wiki_pages(id) ON DELETE SET NULL,

    -- Access control
    visibility VARCHAR(20) DEFAULT 'public',       -- 'public', 'authenticated', 'admin'

    -- Authorship
    created_by_user_id UUID REFERENCES users(id),
    last_edited_by_user_id UUID REFERENCES users(id),

    -- Status
    is_published BOOLEAN DEFAULT true,

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_wiki_pages_slug ON wiki_pages(slug);
  CREATE INDEX idx_wiki_pages_category ON wiki_pages(category);
  CREATE INDEX idx_wiki_pages_parent ON wiki_pages(parent_page_id);
  CREATE INDEX idx_wiki_pages_visibility ON wiki_pages(visibility);

  -- Wiki page versions (revision history)
  CREATE TABLE wiki_page_versions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    page_id UUID NOT NULL REFERENCES wiki_pages(id) ON DELETE CASCADE,

    version_number INTEGER NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,

    -- Change tracking
    edited_by_user_id UUID REFERENCES users(id),
    change_summary TEXT,                           -- Description of changes

    created_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_wiki_page_versions_page ON wiki_page_versions(page_id, version_number DESC);
  CREATE UNIQUE INDEX idx_wiki_page_versions_unique ON wiki_page_versions(page_id, version_number);

  -- Wiki attachments
  CREATE TABLE wiki_attachments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    page_id UUID NOT NULL REFERENCES wiki_pages(id) ON DELETE CASCADE,

    filename TEXT NOT NULL,
    file_path TEXT NOT NULL,
    file_size_bytes BIGINT NOT NULL,
    mime_type VARCHAR(100),

    uploaded_by_user_id UUID REFERENCES users(id),
    created_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_wiki_attachments_page ON wiki_attachments(page_id);
  ```
module_structure: |
  ```
  internal/wiki/
  â”œâ”€â”€ module.go                    # fx module
  â”œâ”€â”€ types.go                     # Domain types
  â”œâ”€â”€ repository.go                # Database operations (sqlc)
  â”œâ”€â”€ service.go                   # Wiki logic
  â”œâ”€â”€ markdown.go                  # Markdown rendering
  â”œâ”€â”€ handler.go                   # HTTP API handlers
  â””â”€â”€ wiki_test.go

  web/src/routes/(app)/wiki/
  â”œâ”€â”€ +page.svelte                 # Wiki home
  â”œâ”€â”€ +page.ts
  â”œâ”€â”€ [slug]/
  â”‚   â”œâ”€â”€ +page.svelte             # View page
  â”‚   â”œâ”€â”€ +page.ts
  â”‚   â””â”€â”€ edit/
  â”‚       â””â”€â”€ +page.svelte         # Edit page
  â””â”€â”€ components/
      â”œâ”€â”€ MarkdownEditor.svelte    # MD editor with preview
      â”œâ”€â”€ PageTree.svelte          # Hierarchical page navigation
      â””â”€â”€ VersionHistory.svelte    # Revision history
  ```
key_interfaces: |
  ```go
  type WikiService interface {
    CreatePage(ctx context.Context, page CreatePageRequest) (*WikiPage, error)
    GetPage(ctx context.Context, slug string) (*WikiPage, error)
    UpdatePage(ctx context.Context, slug string, update PageUpdate) (*WikiPage, error)
    DeletePage(ctx context.Context, slug string) error

    ListPages(ctx context.Context, filters PageFilters) ([]WikiPage, error)
    SearchPages(ctx context.Context, query string) ([]WikiPage, error)

    GetVersions(ctx context.Context, pageID uuid.UUID) ([]WikiPageVersion, error)
    RestoreVersion(ctx context.Context, pageID uuid.UUID, version int) error
  }
  ```
dependencies: |
  **Go Packages**:
  - `github.com/google/uuid`
  - `github.com/jackc/pgx/v5`
  - `github.com/gomarkdown/markdown` - Markdown rendering
  - `go.uber.org/fx`
env_vars: |
  ```bash
  WIKI_ENABLED=true
  ```
config_keys: |
  ```yaml
  wiki:
    enabled: true
    allow_public_editing: false
    require_review: false
  ```
component_interaction: |
  **Page Creation**:
  1. User creates new wiki page with Markdown content
  2. Service renders Markdown to HTML
  3. Store in wiki_pages with content and content_html
  4. Create version 1 in wiki_page_versions
  5. Return page

  **Page Edit**:
  1. User edits page content
  2. Service renders new Markdown
  3. Update wiki_pages
  4. Insert new version in wiki_page_versions
  5. Increment version_number
api_endpoints: |
  ```
  POST   /api/v1/wiki/pages           # Create page
  GET    /api/v1/wiki/pages/:slug     # Get page
  PUT    /api/v1/wiki/pages/:slug     # Update page
  DELETE /api/v1/wiki/pages/:slug     # Delete page
  GET    /api/v1/wiki/pages/:slug/versions  # Get versions
  POST   /api/v1/wiki/pages/:slug/restore/:version  # Restore version
  ```
unit_tests: |
  ```go
  func TestWikiService_CreatePage(t *testing.T) {
    // Test page creation with Markdown rendering
  }
  ```
integration_tests: |
  ```go
  func TestWiki_EndToEnd(t *testing.T) {
    // Test create, edit, version restore workflow
  }
  ```
