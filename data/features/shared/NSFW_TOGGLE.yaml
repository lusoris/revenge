doc_title: Revenge - NSFW Toggle
doc_category: feature
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: ğŸŸ¡
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ğŸ”´
status_code_notes: '-'
status_linting: ğŸ”´
status_linting_notes: '-'
status_unit_testing: ğŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ğŸ”´
status_integration_testing_notes: '-'
technical_summary: '> User preference component for adult content visibility. > Referenced
  by [WHISPARR_STASHDB_SCHEMA.md](../adult/WHISPARR_STASHDB_SCHEMA.md) and [ADULT_CONTENT_SYSTEM.md](../adult/ADULT_CONTENT_SYSTEM.md).'
wiki_tagline: '> Show or hide adult libraries with a simple toggle'
wiki_overview: Control adult content visibility per user. When disabled, adult libraries
  are completely hidden from the UI. Toggle requires PIN confirmation for security.
  Quick toggle in the header for users with permission. Server admins control who
  can enable the toggle. Works with the RBAC system to enforce content access policies.
sources:
- name: Casbin
  url: https://pkg.go.dev/github.com/casbin/casbin/v2
  note: Auto-resolved from casbin
- name: Dragonfly Documentation
  url: https://www.dragonflydb.io/docs
  note: Auto-resolved from dragonfly
- name: Uber fx
  url: https://pkg.go.dev/go.uber.org/fx
  note: Auto-resolved from fx
- name: ogen OpenAPI Generator
  url: https://pkg.go.dev/github.com/ogen-go/ogen
  note: Auto-resolved from ogen
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: rueidis
  url: https://pkg.go.dev/github.com/redis/rueidis
  note: Auto-resolved from rueidis
- name: rueidis GitHub README
  url: https://github.com/redis/rueidis
  note: Auto-resolved from rueidis-docs
- name: sqlc
  url: https://docs.sqlc.dev/en/stable/
  note: Auto-resolved from sqlc
- name: sqlc Configuration
  url: https://docs.sqlc.dev/en/stable/reference/config.html
  note: Auto-resolved from sqlc-config
- name: Svelte 5 Runes
  url: https://svelte.dev/docs/svelte/$state
  note: Auto-resolved from svelte-runes
- name: Svelte 5 Documentation
  url: https://svelte.dev/docs/svelte/overview
  note: Auto-resolved from svelte5
- name: SvelteKit Documentation
  url: https://svelte.dev/docs/kit/introduction
  note: Auto-resolved from sveltekit
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
feature_name: Revenge - NSFW Toggle
module_name: revenge___nsfw_toggle
schema_name: public
architecture_diagram: "```\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n\
  \  â”‚   Client    â”‚â”€â”€â”€â”€â–¶â”‚  API Handler â”‚â”€â”€â”€â”€â–¶â”‚   Service   â”‚\n  â”‚  (Web/App)  â”‚â—€â”€â”€â”€â”€â”‚\
  \   (ogen)     â”‚â—€â”€â”€â”€â”€â”‚   (Logic)   â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   \
  \  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜\n                                                   â”‚\n     \
  \                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                \
  \            â–¼                      â–¼            â–¼\n                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\
  \          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”\n                      â”‚Repositoryâ”‚       \
  \   â”‚ Metadata  â”‚  â”‚  Cache â”‚\n                      â”‚  (sqlc)  â”‚          â”‚  Service\
  \  â”‚  â”‚(otter) â”‚\n                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\
  \                           â”‚                      â”‚\n                         \
  \  â–¼                      â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n\
  \                    â”‚ PostgreSQL  â”‚        â”‚ External â”‚\n                    â”‚\
  \   (pgx)     â”‚        â”‚   APIs   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       \
  \ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  ```"
database_schema: "**Schema**: `public`\n\n  **Tables**: See migration files for complete\
  \ schema\n\n  **Indexes**: Optimized for common queries and full-text search\n  "
module_structure: "```\n  internal/content/revenge___nsfw_toggle/\n  â”œâ”€â”€ module.go\
  \              # fx module definition\n  â”œâ”€â”€ repository.go          # Database operations\
  \ (sqlc)\n  â”œâ”€â”€ service.go             # Business logic\n  â”œâ”€â”€ handler.go      \
  \       # HTTP handlers (ogen)\n  â”œâ”€â”€ types.go               # Domain types\n  â””â”€â”€\
  \ cache.go               # Caching layer (otter)\n  ```"
component_interaction: "1. Client requests resource via HTTP\n  2. API handler validates\
  \ and routes to service\n  3. Service checks cache, queries repository if needed\n\
  \  4. Repository executes SQL via sqlc\n  5. Results return through layers to client"
