doc_title: Revenge - User Experience Features
doc_category: feature
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> User-facing features inspired by modern streaming services.'
wiki_tagline: '> A streaming experience that feels like Netflix'
wiki_overview: Modern UI inspired by popular streaming services. Auto-playing previews on hover, personalized recommendations,
  and trending sections. Top 10 lists show what is popular on your server. Quick actions let you add to watchlist or mark
  as watched. Keyboard shortcuts for power users. Dark and light themes with customizable accent colors.
sources:
- name: Uber fx
  url: https://pkg.go.dev/go.uber.org/fx
  note: Auto-resolved from fx
- name: ogen OpenAPI Generator
  url: https://pkg.go.dev/github.com/ogen-go/ogen
  note: Auto-resolved from ogen
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: sqlc
  url: https://docs.sqlc.dev/en/stable/
  note: Auto-resolved from sqlc
- name: sqlc Configuration
  url: https://docs.sqlc.dev/en/stable/reference/config.html
  note: Auto-resolved from sqlc-config
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
feature_name: Revenge - User Experience Features
module_name: revenge___user_experience_features
schema_name: public
architecture_diagram: |-
  ```mermaid
  flowchart TD
      node1([Client<br/>[Web/App]])
      node2[[API Handler<br/>[ogen]]]
      node3[[Service<br/>[Logic]]]
      node4["Repository<br/>[sqlc]"]
      node5[[Metadata<br/>Service]]
      node6[(Cache<br/>[otter])]
      node7[(PostgreSQL<br/>[pgx])]
      node8([External<br/>APIs])
      node1 --> node2
      node2 --> node3
      node4 --> node5
      node5 --> node6
      node7 --> node8
      node3 --> node4
      node6 --> node7
  ```
database_schema: |
  **Schema**: `public`

  ```sql
  -- User watchlist
  CREATE TABLE watchlist (
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    item_type VARCHAR(50) NOT NULL,               -- 'movie', 'tvshow', 'episode', 'album', 'track'
    item_id UUID NOT NULL,

    added_at TIMESTAMPTZ DEFAULT now(),
    PRIMARY KEY (user_id, item_type, item_id)
  );
  CREATE INDEX idx_watchlist_user ON watchlist(user_id, added_at DESC);

  -- User preferences for UX
  CREATE TABLE user_ux_preferences (
    user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,

    -- Theme settings
    theme VARCHAR(20) DEFAULT 'dark',              -- 'dark', 'light', 'auto'
    accent_color VARCHAR(7) DEFAULT '#e50914',     -- Hex color code

    -- Auto-play settings
    autoplay_previews BOOLEAN DEFAULT true,
    autoplay_next_episode BOOLEAN DEFAULT true,

    -- UI preferences
    show_adult_content BOOLEAN DEFAULT false,
    default_quality VARCHAR(20) DEFAULT 'auto',    -- 'auto', '4K', '1080p', '720p'
    subtitle_language VARCHAR(10),
    audio_language VARCHAR(10),

    -- Recommendations
    enable_recommendations BOOLEAN DEFAULT true,

    updated_at TIMESTAMPTZ DEFAULT now()
  );

  -- Top 10 lists (server-wide trending)
  CREATE TABLE top_10_lists (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    -- List details
    list_type VARCHAR(50) NOT NULL,                -- 'movies', 'tvshows', 'music', 'overall'
    time_period VARCHAR(20) NOT NULL,              -- 'today', 'week', 'month', 'alltime'

    -- Rankings (JSONB array of items with rankings)
    rankings JSONB NOT NULL,                       -- [{"rank": 1, "item_id": "...", "item_type": "movie", "views": 150}]

    generated_at TIMESTAMPTZ DEFAULT now(),
    valid_until TIMESTAMPTZ                        -- Cache expiration
  );
  CREATE INDEX idx_top_10_type_period ON top_10_lists(list_type, time_period, generated_at DESC);

  -- Trending content (calculated from analytics)
  CREATE TABLE trending_content (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    item_type VARCHAR(50) NOT NULL,
    item_id UUID NOT NULL,

    -- Trending metrics
    views_24h INTEGER DEFAULT 0,
    views_7d INTEGER DEFAULT 0,
    trending_score FLOAT DEFAULT 0,                -- Weighted score for ranking

    last_updated TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_trending_score ON trending_content(trending_score DESC);
  CREATE INDEX idx_trending_updated ON trending_content(last_updated DESC);

  -- User keyboard shortcuts (customizable)
  CREATE TABLE user_keyboard_shortcuts (
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    action VARCHAR(100) NOT NULL,                  -- 'play_pause', 'skip_forward', 'toggle_fullscreen'
    key_combination TEXT NOT NULL,                 -- 'Space', 'Ctrl+K', 'F'

    PRIMARY KEY (user_id, action)
  );
  ```
module_structure: |
  ```
  internal/ux/
  â”œâ”€â”€ module.go                    # fx module
  â”œâ”€â”€ types.go                     # Domain types
  â”œâ”€â”€ repository.go                # Database operations (sqlc)
  â”œâ”€â”€ service.go                   # UX logic
  â”œâ”€â”€ preferences.go               # User preference management
  â”œâ”€â”€ watchlist.go                 # Watchlist operations
  â”œâ”€â”€ trending.go                  # Trending/Top 10 calculation
  â”œâ”€â”€ recommendations.go           # Recommendation engine
  â”œâ”€â”€ handler.go                   # HTTP API handlers
  â””â”€â”€ ux_test.go

  web/src/routes/(app)/
  â”œâ”€â”€ +layout.svelte               # Root layout with theme
  â”œâ”€â”€ +page.svelte                 # Home page with trending
  â”œâ”€â”€ settings/
  â”‚   â””â”€â”€ appearance/
  â”‚       â””â”€â”€ +page.svelte         # Theme/UX settings
  â”œâ”€â”€ watchlist/
  â”‚   â””â”€â”€ +page.svelte             # Watchlist view
  â””â”€â”€ components/
      â”œâ”€â”€ AutoplayPreview.svelte   # Hover preview component
      â”œâ”€â”€ Top10List.svelte         # Top 10 rankings
      â”œâ”€â”€ TrendingCarousel.svelte  # Trending content
      â””â”€â”€ ThemeSelector.svelte     # Theme picker
  ```
key_interfaces: |
  ```go
  type UXService interface {
    // Watchlist
    AddToWatchlist(ctx context.Context, userID uuid.UUID, itemType string, itemID uuid.UUID) error
    RemoveFromWatchlist(ctx context.Context, userID uuid.UUID, itemType string, itemID uuid.UUID) error
    GetWatchlist(ctx context.Context, userID uuid.UUID) ([]WatchlistItem, error)

    // Preferences
    GetPreferences(ctx context.Context, userID uuid.UUID) (*UXPreferences, error)
    UpdatePreferences(ctx context.Context, userID uuid.UUID, prefs UXPreferences) error

    // Trending
    GetTop10(ctx context.Context, listType, timePeriod string) (*Top10List, error)
    GetTrending(ctx context.Context, limit int) ([]TrendingItem, error)
    CalculateTrending(ctx context.Context) error  // Background job
  }

  type UXPreferences struct {
    UserID             uuid.UUID `db:"user_id" json:"user_id"`
    Theme              string    `db:"theme" json:"theme"`
    AccentColor        string    `db:"accent_color" json:"accent_color"`
    AutoplayPreviews   bool      `db:"autoplay_previews" json:"autoplay_previews"`
    AutoplayNextEpisode bool     `db:"autoplay_next_episode" json:"autoplay_next_episode"`
  }
  ```
dependencies: |
  **Go Packages**:
  - `github.com/google/uuid`
  - `github.com/jackc/pgx/v5`
  - `github.com/riverqueue/river` - Background trending calculation
  - `go.uber.org/fx`
env_vars: |
  ```bash
  UX_TRENDING_UPDATE_INTERVAL=1h
  UX_TOP10_UPDATE_INTERVAL=6h
  ```
config_keys: |
  ```yaml
  ux:
    trending_update_interval: 1h
    top10_update_interval: 6h
    default_theme: dark
    default_accent_color: '#e50914'
  ```
component_interaction: |
  **Watchlist Add**:
  1. User clicks "Add to Watchlist" button
  2. POST /api/v1/ux/watchlist with item details
  3. Service inserts into watchlist table
  4. Return success, UI updates

  **Trending Calculation** (background job):
  1. River job triggers every hour
  2. Query analytics_daily for recent view counts
  3. Calculate trending_score = (views_24h * 3) + (views_7d * 1)
  4. Update trending_content table
  5. Generate top_10_lists for each category

  **Theme Change**:
  1. User selects theme/accent in settings
  2. PUT /api/v1/ux/preferences
  3. Update user_ux_preferences
  4. Frontend applies CSS variables immediately
api_endpoints: |
  ```
  # Watchlist
  POST   /api/v1/ux/watchlist          # Add to watchlist
  DELETE /api/v1/ux/watchlist/:type/:id # Remove from watchlist
  GET    /api/v1/ux/watchlist          # Get watchlist

  # Preferences
  GET    /api/v1/ux/preferences         # Get UX preferences
  PUT    /api/v1/ux/preferences         # Update preferences

  # Trending
  GET    /api/v1/ux/top10/:type/:period # Get Top 10 list
  GET    /api/v1/ux/trending            # Get trending content
  ```
unit_tests: |
  ```go
  func TestUXService_Watchlist(t *testing.T) {
    // Test add/remove/get watchlist operations
  }

  func TestUXService_CalculateTrending(t *testing.T) {
    // Test trending score calculation
  }
  ```
integration_tests: |
  ```go
  func TestUX_EndToEnd(t *testing.T) {
    // Test watchlist, preferences, trending workflow
  }
  ```
