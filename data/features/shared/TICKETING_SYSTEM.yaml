doc_title: Ticketing System
doc_category: feature
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: ðŸŸ¡
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> User portal for bug reports, feature requests, and support tickets'
wiki_tagline: '> Report issues and request features through a built-in portal'
wiki_overview: Built-in support system for your media server. Users can submit bug reports, request features, or ask for help
  without leaving the app. Admins see a dashboard of all tickets with priority, status, and assignment. Email notifications
  keep everyone updated. Integrates with GitHub Issues for developers who want external tracking.
sources:
- name: Uber fx
  url: https://pkg.go.dev/go.uber.org/fx
  note: Auto-resolved from fx
- name: ogen OpenAPI Generator
  url: https://pkg.go.dev/github.com/ogen-go/ogen
  note: Auto-resolved from ogen
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: rueidis
  url: https://pkg.go.dev/github.com/redis/rueidis
  note: Auto-resolved from rueidis
- name: rueidis GitHub README
  url: https://github.com/redis/rueidis
  note: Auto-resolved from rueidis-docs
- name: shadcn-svelte
  url: https://www.shadcn-svelte.com/docs
  note: Auto-resolved from shadcn-svelte
- name: sqlc
  url: https://docs.sqlc.dev/en/stable/
  note: Auto-resolved from sqlc
- name: sqlc Configuration
  url: https://docs.sqlc.dev/en/stable/reference/config.html
  note: Auto-resolved from sqlc-config
- name: Svelte 5 Runes
  url: https://svelte.dev/docs/svelte/$state
  note: Auto-resolved from svelte-runes
- name: Svelte 5 Documentation
  url: https://svelte.dev/docs/svelte/overview
  note: Auto-resolved from svelte5
- name: SvelteKit Documentation
  url: https://svelte.dev/docs/kit/introduction
  note: Auto-resolved from sveltekit
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
feature_name: Ticketing System
module_name: ticketing_system
schema_name: public
architecture_diagram: |-
  ```mermaid
  flowchart TD
      subgraph row1[ ]
          direction LR
          node1(["Client<br/>(Web/App)"])
          node2[["API Handler<br/>(ogen)"]]
          node3[["Service<br/>(Logic)"]]
      end
      subgraph row2[ ]
          direction LR
          node4["Repository<br/>(sqlc)"]
          node5[["Metadata<br/>Service"]]
          node6[("Cache<br/>(otter)")]
      end
      subgraph row3[ ]
          direction LR
          node7[("PostgreSQL<br/>(pgx)")]
          node8(["External<br/>APIs"])
      end
      node1 --> node2
      node2 --> node3
      node4 --> node5
      node5 --> node6
      node7 --> node8
      node3 --> node4
      node6 --> node7

      %% Hide row subgraph borders
      style row1 fill:transparent,stroke:transparent
      style row2 fill:transparent,stroke:transparent
      style row3 fill:transparent,stroke:transparent
  ```
database_schema: |
  **Schema**: `public`

  ```sql
  -- Support tickets
  CREATE TABLE tickets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    -- Ticket details
    type VARCHAR(50) NOT NULL,                     -- 'bug', 'feature', 'question', 'help'
    priority VARCHAR(20) DEFAULT 'medium',         -- 'low', 'medium', 'high', 'urgent'
    status VARCHAR(20) DEFAULT 'open',             -- 'open', 'in_progress', 'closed', 'resolved'

    -- Content
    title TEXT NOT NULL,
    description TEXT NOT NULL,

    -- Assignment
    assigned_to_user_id UUID REFERENCES users(id),

    -- External tracking
    github_issue_number INTEGER,                   -- Linked GitHub issue
    github_issue_url TEXT,

    -- Timestamps
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now(),
    closed_at TIMESTAMPTZ
  );
  CREATE INDEX idx_tickets_user ON tickets(user_id, created_at DESC);
  CREATE INDEX idx_tickets_status ON tickets(status);
  CREATE INDEX idx_tickets_assigned ON tickets(assigned_to_user_id) WHERE assigned_to_user_id IS NOT NULL;
  CREATE INDEX idx_tickets_type ON tickets(type);
  CREATE INDEX idx_tickets_priority ON tickets(priority);

  -- Ticket comments/updates
  CREATE TABLE ticket_comments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ticket_id UUID NOT NULL REFERENCES tickets(id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

    comment TEXT NOT NULL,
    is_internal BOOLEAN DEFAULT false,             -- Internal notes not visible to requester

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_ticket_comments_ticket ON ticket_comments(ticket_id, created_at);
  CREATE INDEX idx_ticket_comments_user ON ticket_comments(user_id);

  -- Ticket attachments
  CREATE TABLE ticket_attachments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ticket_id UUID NOT NULL REFERENCES tickets(id) ON DELETE CASCADE,
    uploaded_by_user_id UUID NOT NULL REFERENCES users(id),

    filename TEXT NOT NULL,
    file_path TEXT NOT NULL,                       -- Path to file on disk
    file_size_bytes BIGINT NOT NULL,
    mime_type VARCHAR(100),

    created_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_ticket_attachments_ticket ON ticket_attachments(ticket_id);

  -- Ticket tags
  CREATE TABLE ticket_tags (
    ticket_id UUID NOT NULL REFERENCES tickets(id) ON DELETE CASCADE,
    tag VARCHAR(50) NOT NULL,

    created_at TIMESTAMPTZ DEFAULT now(),
    PRIMARY KEY (ticket_id, tag)
  );
  CREATE INDEX idx_ticket_tags_tag ON ticket_tags(tag);
  ```
module_structure: |
  ```
  internal/tickets/
  â”œâ”€â”€ module.go                    # fx module
  â”œâ”€â”€ types.go                     # Domain types
  â”œâ”€â”€ repository.go                # Database operations (sqlc)
  â”œâ”€â”€ service.go                   # Ticket logic
  â”œâ”€â”€ github.go                    # GitHub Issues integration
  â”œâ”€â”€ handler.go                   # HTTP API handlers
  â””â”€â”€ tickets_test.go

  web/src/routes/(app)/support/
  â”œâ”€â”€ +page.svelte                 # Tickets list
  â”œâ”€â”€ +page.ts                     # Data loading
  â”œâ”€â”€ new/
  â”‚   â””â”€â”€ +page.svelte             # Create ticket
  â”œâ”€â”€ [id]/
  â”‚   â”œâ”€â”€ +page.svelte             # Ticket detail
  â”‚   â””â”€â”€ +page.ts
  â””â”€â”€ components/
      â”œâ”€â”€ TicketCard.svelte        # Ticket display card
      â”œâ”€â”€ CommentThread.svelte     # Comment thread
      â”œâ”€â”€ StatusBadge.svelte       # Status badge
      â””â”€â”€ PriorityBadge.svelte     # Priority badge
  ```
key_interfaces: |
  ```go
  type TicketService interface {
    CreateTicket(ctx context.Context, userID uuid.UUID, req CreateTicketRequest) (*Ticket, error)
    ListTickets(ctx context.Context, filters TicketFilters) ([]Ticket, error)
    GetTicket(ctx context.Context, ticketID uuid.UUID) (*TicketDetail, error)
    UpdateTicket(ctx context.Context, ticketID uuid.UUID, update TicketUpdate) (*Ticket, error)
    CloseTicket(ctx context.Context, ticketID uuid.UUID) error

    AddComment(ctx context.Context, ticketID, userID uuid.UUID, comment string, isInternal bool) (*TicketComment, error)
    GetComments(ctx context.Context, ticketID uuid.UUID) ([]TicketComment, error)

    AddAttachment(ctx context.Context, ticketID, userID uuid.UUID, file FileUpload) (*TicketAttachment, error)
    AssignTicket(ctx context.Context, ticketID, assigneeID uuid.UUID) error

    LinkGitHubIssue(ctx context.Context, ticketID uuid.UUID, issueNumber int) error
  }

  type Ticket struct {
    ID                uuid.UUID  `db:"id" json:"id"`
    UserID            uuid.UUID  `db:"user_id" json:"user_id"`
    Type              string     `db:"type" json:"type"`
    Priority          string     `db:"priority" json:"priority"`
    Status            string     `db:"status" json:"status"`
    Title             string     `db:"title" json:"title"`
    Description       string     `db:"description" json:"description"`
    AssignedToUserID  *uuid.UUID `db:"assigned_to_user_id" json:"assigned_to_user_id,omitempty"`
    GitHubIssueNumber *int       `db:"github_issue_number" json:"github_issue_number,omitempty"`
    CreatedAt         time.Time  `db:"created_at" json:"created_at"`
    UpdatedAt         time.Time  `db:"updated_at" json:"updated_at"`
  }

  type TicketDetail struct {
    Ticket
    Submitter   User               `json:"submitter"`
    AssignedTo  *User              `json:"assigned_to,omitempty"`
    Comments    []TicketComment    `json:"comments"`
    Attachments []TicketAttachment `json:"attachments"`
    Tags        []string           `json:"tags"`
  }

  type GitHubIntegration interface {
    CreateIssue(ctx context.Context, ticket Ticket) (int, string, error)
    UpdateIssue(ctx context.Context, issueNumber int, update IssueUpdate) error
    CloseIssue(ctx context.Context, issueNumber int) error
  }
  ```
dependencies: |
  **Go Packages**:
  - `github.com/google/uuid`
  - `github.com/jackc/pgx/v5`
  - `github.com/google/go-github/v58/github` - GitHub API client
  - `go.uber.org/fx`

  **External APIs**:
  - GitHub REST API v3 (optional)
env_vars: |
  ```bash
  TICKETS_GITHUB_ENABLED=false
  TICKETS_GITHUB_REPO=owner/repo
  TICKETS_GITHUB_TOKEN=ghp_xxx
  TICKETS_MAX_ATTACHMENT_SIZE_MB=10
  ```
config_keys: |
  ```yaml
  tickets:
    enabled: true
    max_attachment_size_mb: 10
    allow_attachments: true

    github:
      enabled: false
      repo: owner/repo
      token: ${TICKETS_GITHUB_TOKEN}
      auto_create_issues: false
  ```
component_interaction: |
  **Ticket Creation Flow**:
  1. User submits ticket via POST /api/v1/tickets
  2. Service validates and creates tickets record
  3. If GitHub integration enabled and auto_create_issues=true:
     - Call GitHub API to create issue
     - Store issue number in github_issue_number
  4. Send email notification to admins
  5. Return ticket to user

  **Comment Flow**:
  1. User or admin adds comment
  2. Service creates ticket_comments record
  3. If GitHub issue linked, add comment to GitHub
  4. Notify ticket participants via email
  5. Update ticket updated_at timestamp

  **Assignment Flow**:
  1. Admin assigns ticket to user
  2. Service updates assigned_to_user_id
  3. Notify assigned user via email
  4. Update GitHub issue assignee if linked

  **Status Update Flow**:
  1. Admin changes ticket status
  2. Service updates status field
  3. If status = 'closed', set closed_at timestamp
  4. If GitHub issue linked, close GitHub issue
  5. Notify requester of resolution
api_endpoints: |
  ```
  POST   /api/v1/tickets                 # Create ticket
  GET    /api/v1/tickets                 # List tickets (filter by status/type)
  GET    /api/v1/tickets/:id             # Get ticket details
  PUT    /api/v1/tickets/:id             # Update ticket
  DELETE /api/v1/tickets/:id/close       # Close ticket

  POST   /api/v1/tickets/:id/comments    # Add comment
  GET    /api/v1/tickets/:id/comments    # Get comments

  POST   /api/v1/tickets/:id/attachments # Upload attachment
  GET    /api/v1/tickets/:id/attachments # List attachments

  PUT    /api/v1/tickets/:id/assign      # Assign ticket
  POST   /api/v1/tickets/:id/github      # Link GitHub issue
  ```
unit_tests: |
  ```go
  func TestTicketService_CreateTicket(t *testing.T) {
    // Test ticket creation
    // Test GitHub issue creation
  }

  func TestTicketService_AddComment(t *testing.T) {
    // Test adding comments
    // Test internal vs public comments
  }

  func TestGitHubIntegration_CreateIssue(t *testing.T) {
    // Test GitHub API integration
    // Mock GitHub responses
  }
  ```
integration_tests: |
  ```go
  func TestTickets_EndToEnd(t *testing.T) {
    // 1. User creates ticket
    // 2. Admin assigns ticket
    // 3. Admin adds comment
    // 4. Admin closes ticket
    // 5. Verify all actions recorded
  }

  func TestTickets_GitHubIntegration(t *testing.T) {
    // Test full GitHub integration flow
    // Mock GitHub API
  }
  ```
