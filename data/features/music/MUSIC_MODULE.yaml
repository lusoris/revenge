doc_title: Music Module
doc_category: feature
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: Complete music module design
status_sources: âœ…
status_sources_notes: All music APIs documented
status_instructions: âœ…
status_instructions_notes: Generated from design
status_code: ğŸ”´
status_code_notes: '-'
status_linting: ğŸ”´
status_linting_notes: '-'
status_unit_testing: ğŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ğŸ”´
status_integration_testing_notes: '-'
technical_summary: '> Music content management with metadata enrichment from MusicBrainz
  and Last.fm


  Complete music library management:

  - **Lidarr Integration**: Two-way sync for music library automation

  - **Metadata Sources**: MusicBrainz (primary), Last.fm (scrobbling, tags)

  - **Supported Formats**: MP3, FLAC, AAC, OGG, ALAC, Opus

  - **Playback**: HLS adaptive streaming with gapless playback

  - **Features**: Playlists, smart collections, album art, lyrics'
wiki_tagline: '> Your complete music library with beautiful album art and metadata'
wiki_overview: The Music Module provides a complete music library experience with
  support for artists, albums, and tracks. It integrates with Lidarr for automated
  music management and uses MusicBrainz and Last.fm for rich metadata. Stream your
  music in high quality with gapless playback, create playlists, and discover new
  music through smart collections.
sources:
- name: Uber fx
  url: https://pkg.go.dev/go.uber.org/fx
  note: Auto-resolved from fx
- name: Last.fm API
  url: https://www.last.fm/api/intro
  note: Auto-resolved from lastfm-api
- name: ogen OpenAPI Generator
  url: https://pkg.go.dev/github.com/ogen-go/ogen
  note: Auto-resolved from ogen
- name: pgx PostgreSQL Driver
  url: https://pkg.go.dev/github.com/jackc/pgx/v5
  note: Auto-resolved from pgx
- name: PostgreSQL Arrays
  url: https://www.postgresql.org/docs/current/arrays.html
  note: Auto-resolved from postgresql-arrays
- name: PostgreSQL JSON Functions
  url: https://www.postgresql.org/docs/current/functions-json.html
  note: Auto-resolved from postgresql-json
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: sqlc
  url: https://docs.sqlc.dev/en/stable/
  note: Auto-resolved from sqlc
- name: sqlc Configuration
  url: https://docs.sqlc.dev/en/stable/reference/config.html
  note: Auto-resolved from sqlc-config
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
feature_name: Music Module
module_name: music
schema_name: public
content_types:
- Artists
- Albums
- Tracks
lidarr_integration:
  sync_direction: two-way
  metadata_priority:
    1: Lidarr (cached metadata from MusicBrainz)
    2: MusicBrainz (direct API)
    3: Last.fm (tags, scrobbles, similar artists)
  webhook_events:
  - AlbumDownload
  - AlbumUpgrade
  - TrackRetag
  - ArtistDelete
  notes: Lidarr provides pre-fetched MusicBrainz metadata, reducing API calls
supported_formats:
- format: MP3
  codec: MPEG-1/2 Audio Layer III
  streaming: Direct playback or HLS transcode
- format: FLAC
  codec: Free Lossless Audio Codec
  streaming: Transcode to AAC/Opus for bandwidth savings
- format: AAC
  codec: Advanced Audio Coding
  streaming: Direct playback via HLS
- format: OGG
  codec: Vorbis/Opus
  streaming: Direct playback or transcode
- format: ALAC
  codec: Apple Lossless
  streaming: Transcode to AAC for web playback
- format: Opus
  codec: Opus
  streaming: Direct playback (best quality/bandwidth ratio)
metadata_sources:
- name: Lidarr
  purpose: Primary metadata source (cached from MusicBrainz)
  priority: 1
  fields: Artist, album, track, release date, genres, album art
- name: MusicBrainz
  purpose: Fallback for missing metadata
  priority: 2
  fields: Complete discography, relationships, ISRCs
  api_url: https://musicbrainz.org/ws/2/
- name: Last.fm
  purpose: User scrobbles, tags, similar artists
  priority: 3
  fields: Play counts, user tags, artist bio, similar artists
  api_url: https://www.last.fm/api
database_schema: "**Schema**: `public`\n\n  **Tables**: See migration files for complete\
  \ schema\n\n  **Indexes**: Optimized for common queries and full-text search\n  "
playback_features:
  streaming_protocol: HLS (HTTP Live Streaming)
  gapless_playback: true
  crossfade: Configurable (0-12 seconds)
  audio_normalization: ReplayGain support
  lyrics_display: Synced lyrics (LRC format) if available
  queue_management: Add to queue, play next, shuffle, repeat
playlist_support:
  types:
  - Manual playlists (user-created)
  - Smart playlists (filter-based)
  features:
  - Collaborative playlists
  - Playlist sharing (public/private)
  - Import from M3U/PLS
  - Export to M3U/PLS
  database_table: playlists (shared with other modules)
scrobbling_integration:
  services:
  - Last.fm
  - ListenBrainz
  - Spotify (if configured)
  scrobble_trigger: 50% played or 4 minutes (whichever comes first)
  offline_queue: Queue scrobbles when offline, submit when online
api_endpoints:
- method: GET
  path: /api/v1/music/artists
  description: List all artists with pagination and filters
- method: GET
  path: /api/v1/music/artists/:id
  description: Get artist details by ID
- method: GET
  path: /api/v1/music/artists/:id/albums
  description: List all albums by an artist
- method: GET
  path: /api/v1/music/albums
  description: List all albums with pagination and filters
- method: GET
  path: /api/v1/music/albums/:id
  description: Get album details by ID
- method: GET
  path: /api/v1/music/albums/:id/tracks
  description: List all tracks on an album
- method: GET
  path: /api/v1/music/tracks
  description: List all tracks with pagination and filters
- method: GET
  path: /api/v1/music/tracks/:id
  description: Get track details by ID
- method: GET
  path: /api/v1/music/tracks/:id/stream
  description: Get audio streaming URL for a track
- method: POST
  path: /api/v1/music/playlists
  description: Create a new playlist
- method: GET
  path: /api/v1/music/genres
  description: List all music genres
architecture_diagram: "```\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n\
  \  â”‚   Client    â”‚â”€â”€â”€â”€â–¶â”‚  API Handler â”‚â”€â”€â”€â”€â–¶â”‚   Service   â”‚\n  â”‚  (Web/App)  â”‚â—€â”€â”€â”€â”€â”‚\
  \   (ogen)     â”‚â—€â”€â”€â”€â”€â”‚   (Logic)   â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   \
  \  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜\n                                                   â”‚\n     \
  \                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                \
  \            â–¼                      â–¼            â–¼\n                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\
  \          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”\n                      â”‚Repositoryâ”‚       \
  \   â”‚ Metadata  â”‚  â”‚  Cache â”‚\n                      â”‚  (sqlc)  â”‚          â”‚  Service\
  \  â”‚  â”‚(otter) â”‚\n                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\
  \                           â”‚                      â”‚\n                         \
  \  â–¼                      â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n\
  \                    â”‚ PostgreSQL  â”‚        â”‚ External â”‚\n                    â”‚\
  \   (pgx)     â”‚        â”‚   APIs   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       \
  \ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  ```"
module_structure: "```\n  internal/content/music/\n  â”œâ”€â”€ module.go              #\
  \ fx module definition\n  â”œâ”€â”€ repository.go          # Database operations (sqlc)\n\
  \  â”œâ”€â”€ service.go             # Business logic\n  â”œâ”€â”€ handler.go             # HTTP\
  \ handlers (ogen)\n  â”œâ”€â”€ types.go               # Domain types\n  â””â”€â”€ cache.go \
  \              # Caching layer (otter)\n  ```"
component_interaction: "1. Client requests resource via HTTP\n  2. API handler validates\
  \ and routes to service\n  3. Service checks cache, queries repository if needed\n\
  \  4. Repository executes SQL via sqlc\n  5. Results return through layers to client"
