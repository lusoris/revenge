doc_title: Release Calendar System
doc_category: feature
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ðŸ”´
status_code_notes: '-'
status_linting: ðŸ”´
status_linting_notes: '-'
status_unit_testing: ðŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ðŸ”´
status_integration_testing_notes: '-'
technical_summary: '> Upcoming releases and recent additions calendar via Servarr integration'
wiki_tagline: '> Upcoming releases and recent additions calendar via Servarr integration'
wiki_overview: See upcoming releases and recent additions at a glance. The calendar pulls data from Radarr, Sonarr, and other
  Arr services to show what is releasing soon. View by day, week, or month. Filter by media type, genre, or library. Get notified
  when anticipated titles become available in your library.
sources:
- name: Go context
  url: https://pkg.go.dev/context
  note: Auto-resolved from go-context
- name: Radarr API Docs
  url: https://radarr.video/docs/api/
  note: Auto-resolved from radarr-docs
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: Sonarr API Docs
  url: https://sonarr.tv/docs/api/
  note: Auto-resolved from sonarr-docs
- name: sqlc
  url: https://docs.sqlc.dev/en/stable/
  note: Auto-resolved from sqlc
- name: sqlc Configuration
  url: https://docs.sqlc.dev/en/stable/reference/config.html
  note: Auto-resolved from sqlc-config
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
feature_name: Release Calendar System
module_name: release_calendar_system
schema_name: public
architecture_diagram: |-
  ```mermaid
  flowchart LR
      subgraph Layer1["Layer 1"]
          node1(["Client<br/>(Web/App)"])
          node2[["API Handler<br/>(ogen)"]]
          node3[["Service<br/>(Logic)"]]
      end

      subgraph Layer2["Layer 2"]
          node4["Repository<br/>(sqlc)"]
          node5[["Metadata<br/>Service"]]
          node6[("Cache<br/>(otter)")]
      end

      subgraph Layer3["Layer 3"]
          node7[("PostgreSQL<br/>(pgx)")]
          node8(["External<br/>APIs"])
      end

      %% Connections
      node3 --> node4
      node6 --> node7

      %% Styling
      style Layer1 fill:#1976D2,stroke:#1976D2,color:#fff
      style Layer2 fill:#388E3C,stroke:#388E3C,color:#fff
      style Layer3 fill:#7B1FA2,stroke:#7B1FA2,color:#fff
  ```
database_schema: |
  **Schema**: `public`

  ```sql
  -- Calendar events (aggregated from multiple sources)
  CREATE TABLE calendar_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    event_type VARCHAR(50) NOT NULL,           -- 'release', 'addition', 'premiere'
    media_type VARCHAR(20) NOT NULL,           -- 'movie', 'episode', 'album'
    content_id UUID,                           -- References movie/episode if exists
    title TEXT NOT NULL,
    series_title TEXT,                         -- For episodes
    season_number INTEGER,                     -- For episodes
    episode_number INTEGER,                    -- For episodes

    -- Dates
    air_date DATE,                             -- Original air/release date
    physical_release_date DATE,                -- Physical media release
    digital_release_date DATE,                 -- Digital release
    in_cinemas_date DATE,                      -- Theatrical release

    -- Source tracking
    source VARCHAR(50) NOT NULL,               -- 'radarr', 'sonarr', 'lidarr', 'local'
    source_id VARCHAR(255),                    -- External ID from source
    monitored BOOLEAN DEFAULT true,            -- Is this being monitored for download?
    downloaded BOOLEAN DEFAULT false,          -- Has it been downloaded?

    -- Metadata
    overview TEXT,
    poster_url TEXT,
    genres TEXT[] DEFAULT '{}',

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_calendar_events_air_date ON calendar_events(air_date DESC) WHERE air_date IS NOT NULL;
  CREATE INDEX idx_calendar_events_media_type ON calendar_events(media_type, air_date DESC);
  CREATE INDEX idx_calendar_events_source ON calendar_events(source, source_id);
  CREATE INDEX idx_calendar_events_monitored ON calendar_events(monitored, air_date DESC) WHERE monitored = true;
  CREATE INDEX idx_calendar_events_downloaded ON calendar_events(downloaded) WHERE downloaded = false;

  -- User calendar subscriptions
  CREATE TABLE calendar_subscriptions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    subscription_name TEXT NOT NULL,

    -- Filters
    media_types TEXT[] DEFAULT '{}',           -- ['movie', 'episode']
    sources TEXT[] DEFAULT '{}',               -- ['radarr', 'sonarr']
    genres TEXT[] DEFAULT '{}',                -- Filter by genre
    monitored_only BOOLEAN DEFAULT true,       -- Only monitored content

    -- Format
    ical_url TEXT UNIQUE,                      -- Generated iCal URL
    ical_token UUID DEFAULT gen_random_uuid(), -- Secret token for iCal feed

    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
  );
  CREATE INDEX idx_calendar_subscriptions_user ON calendar_subscriptions(user_id);
  CREATE INDEX idx_calendar_subscriptions_ical_token ON calendar_subscriptions(ical_token);
  ```
module_structure: |
  ```
  internal/calendar/
  â”œâ”€â”€ module.go                    # fx module
  â”œâ”€â”€ types.go                     # Domain types
  â”œâ”€â”€ repository.go                # Database operations (sqlc)
  â”œâ”€â”€ service.go                   # Calendar logic
  â”œâ”€â”€ sync/
  â”‚   â”œâ”€â”€ radarr.go                # Radarr calendar sync
  â”‚   â”œâ”€â”€ sonarr.go                # Sonarr calendar sync
  â”‚   â”œâ”€â”€ lidarr.go                # Lidarr calendar sync
  â”‚   â””â”€â”€ readarr.go               # Readarr calendar sync
  â”œâ”€â”€ ical/
  â”‚   â”œâ”€â”€ generator.go             # iCal feed generator
  â”‚   â””â”€â”€ parser.go                # iCal parser
  â”œâ”€â”€ handler.go                   # HTTP API handlers
  â””â”€â”€ calendar_test.go

  web/src/routes/(app)/calendar/
  â”œâ”€â”€ +page.svelte                 # Calendar view
  â”œâ”€â”€ +page.ts                     # Data loading
  â””â”€â”€ components/
      â”œâ”€â”€ MonthView.svelte         # Month calendar
      â”œâ”€â”€ WeekView.svelte          # Week calendar
      â”œâ”€â”€ DayView.svelte           # Day calendar
      â””â”€â”€ EventCard.svelte         # Event card
  ```
file_structure: |
  **Key Files**:
  - `internal/calendar/service.go` - Calendar aggregation logic
  - `internal/calendar/sync/*.go` - Arr service sync
  - `internal/calendar/ical/generator.go` - iCal feed generation
  - `web/src/routes/(app)/calendar/+page.svelte` - Calendar UI
key_interfaces: |
  ```go
  type CalendarService interface {
    GetEvents(ctx context.Context, start, end time.Time, filters EventFilters) ([]CalendarEvent, error)
    SyncFromSources(ctx context.Context) error
    CreateSubscription(ctx context.Context, sub CalendarSubscription) (*CalendarSubscription, error)
    GetICalFeed(ctx context.Context, token uuid.UUID) (string, error)
  }

  type CalendarEvent struct {
    ID                  uuid.UUID   `db:"id" json:"id"`
    EventType           string      `db:"event_type" json:"event_type"`
    MediaType           string      `db:"media_type" json:"media_type"`
    Title               string      `db:"title" json:"title"`
    AirDate             *time.Time  `db:"air_date" json:"air_date,omitempty"`
    Source              string      `db:"source" json:"source"`
    Monitored           bool        `db:"monitored" json:"monitored"`
    Downloaded          bool        `db:"downloaded" json:"downloaded"`
  }
  ```
dependencies: |
  **Go Packages**:
  - `github.com/google/uuid`
  - `github.com/jackc/pgx/v5`
  - `github.com/riverqueue/river`
  - `github.com/arran4/golang-ical` - iCal generation
env_vars: |
  ```bash
  CALENDAR_SYNC_INTERVAL=1h
  CALENDAR_RADARR_URL=http://localhost:7878
  CALENDAR_SONARR_URL=http://localhost:8989
  ```
config_keys: |
  ```yaml
  calendar:
    sync_interval: 1h
    sources:
      radarr:
        enabled: true
        url: http://localhost:7878
      sonarr:
        enabled: true
        url: http://localhost:8989
  ```
component_interaction: |
  **Sync Flow**:
  1. Background job triggers hourly
  2. Fetch calendar from each Arr service
  3. Aggregate and deduplicate events
  4. Update calendar_events table

  **iCal Feed Flow**:
  1. User creates subscription with filters
  2. Generate unique iCal URL with token
  3. External calendar app fetches iCal feed
  4. Service generates iCal format from events
api_endpoints: |
  ```
  GET /api/v1/calendar/events?start=2026-01-01&end=2026-01-31
  POST /api/v1/calendar/subscriptions
  GET /api/v1/calendar/ical/:token
  ```
unit_tests: |
  ```go
  func TestCalendarService_GetEvents(t *testing.T) {
    // Test date range filtering
  }
  ```
integration_tests: |
  ```go
  func TestCalendar_ArrSync(t *testing.T) {
    // Test Radarr/Sonarr sync
  }
  ```
