doc_title: Comics Module
doc_category: feature
created_date: '2026-01-31'
overall_status: âœ… Complete
status_design: âœ…
status_design_notes: '-'
status_sources: âœ…
status_sources_notes: '-'
status_instructions: âœ…
status_instructions_notes: '-'
status_code: ğŸ”´
status_code_notes: '-'
status_linting: ğŸ”´
status_linting_notes: '-'
status_unit_testing: ğŸ”´
status_unit_testing_notes: '-'
status_integration_testing: ğŸ”´
status_integration_testing_notes: '-'
technical_summary: '> Digital comics/manga/graphic novel support with metadata from
  ComicVine, Marvel API, GCD


  Complete comics library:

  - **Metadata Sources**: ComicVine (primary), Marvel API, Grand Comics Database,
  AniList/MAL (manga)

  - **Supported Formats**: CBZ, CBR, CB7, CBT, PDF

  - **Reader Features**: Page-by-page viewing, two-page spread, webtoon scroll mode

  - **Progress Tracking**: Per-user reading progress with sync across devices

  - **Collection Management**: Pull lists, reading lists, series tracking'
wiki_tagline: '> Your digital comics library with beautiful reading experience'
wiki_overview: The Comics Module provides a comprehensive digital comics experience
  supporting CBZ, CBR, and PDF formats. Read comics, manga, and graphic novels with
  a beautiful web reader that supports single-page, two-page spread, and webtoon scroll
  modes. Track your reading progress, manage pull lists, and discover new series with
  rich metadata from ComicVine, Marvel API, and anime databases for manga.
sources:
- name: AniList GraphQL API
  url: https://anilist.gitbook.io/anilist-apiv2-docs
  note: Auto-resolved from anilist
- name: ComicVine API
  url: https://comicvine.gamespot.com/api/documentation
  note: Auto-resolved from comicvine
- name: Uber fx
  url: https://pkg.go.dev/go.uber.org/fx
  note: Auto-resolved from fx
- name: MyAnimeList API
  url: https://myanimelist.net/apiconfig/references/api/v2
  note: Auto-resolved from myanimelist
- name: ogen OpenAPI Generator
  url: https://pkg.go.dev/github.com/ogen-go/ogen
  note: Auto-resolved from ogen
- name: River Job Queue
  url: https://pkg.go.dev/github.com/riverqueue/river
  note: Auto-resolved from river
- name: sqlc
  url: https://docs.sqlc.dev/en/stable/
  note: Auto-resolved from sqlc
- name: sqlc Configuration
  url: https://docs.sqlc.dev/en/stable/reference/config.html
  note: Auto-resolved from sqlc-config
- name: Svelte 5 Runes
  url: https://svelte.dev/docs/svelte/$state
  note: Auto-resolved from svelte-runes
- name: Svelte 5 Documentation
  url: https://svelte.dev/docs/svelte/overview
  note: Auto-resolved from svelte5
- name: SvelteKit Documentation
  url: https://svelte.dev/docs/kit/introduction
  note: Auto-resolved from sveltekit
design_refs:
- title: 01_ARCHITECTURE
  path: ../../architecture/01_ARCHITECTURE.md
- title: 02_DESIGN_PRINCIPLES
  path: ../../architecture/02_DESIGN_PRINCIPLES.md
- title: 03_METADATA_SYSTEM
  path: ../../architecture/03_METADATA_SYSTEM.md
feature_name: Comics Module
module_name: comics
schema_name: public
content_types:
- Comics
- Issues
- Series
supported_formats:
- format: CBZ
  description: Comic Book Archive (ZIP)
  extraction: go-unarr
  preferred: true
- format: CBR
  description: Comic Book Archive (RAR)
  extraction: go-unarr
  notes: RAR format support
- format: CB7
  description: Comic Book Archive (7z)
  extraction: go-unarr
- format: CBT
  description: Comic Book Archive (TAR)
  extraction: go-unarr
- format: PDF
  description: Portable Document Format
  extraction: PDF.js
  notes: Scan-based comics
metadata_sources:
- name: ComicVine
  purpose: Primary metadata for Western comics
  priority: 1
  fields: Series, issue, publisher, creators, cover art, release date
  api_url: https://comicvine.gamespot.com/api/
  notes: Requires API key
- name: Marvel API
  purpose: Official Marvel comics metadata
  priority: 2
  fields: Complete Marvel catalog data
  api_url: https://developer.marvel.com/
  notes: Marvel comics only
- name: Grand Comics Database
  purpose: Comprehensive comics database
  priority: 3
  fields: Historical comics data, credits
  api_url: https://www.comics.org/
- name: AniList
  purpose: Manga metadata
  priority: 4
  fields: Manga series, chapters, Japanese metadata
  api_url: https://anilist.co/graphql
- name: MyAnimeList
  purpose: Alternative manga metadata
  priority: 5
  fields: Manga information, user ratings
  api_url: https://api.myanimelist.net/v2/
database_schema: |
  **Schema**: `public`

  **Tables**:
  - `comic_series`: Comic/manga series metadata
  - `comic_issues`: Individual comic issues/chapters
  - `comic_files`: Physical comic files
  - `comic_publishers`: Publishers/studios
  - `comic_creators`: Writers, artists, colorists, etc.
  - `comic_issue_creators`: Issue-creator associations with role
  - `comic_characters`: Characters appearing in comics
  - `comic_issue_characters`: Issue-character appearances
  - `comic_reading_progress`: Per-user reading progress
  - `comic_reading_lists`: User-created reading lists
  - `comic_pull_lists`: User pull lists for ongoing series
  - `comic_metadata_cache`: Cached metadata from providers

  **Key Columns** (`comic_series`):
  - `id` (UUID): Primary key
  - `title` (TEXT): Series title
  - `sort_title` (TEXT): Title for alphabetical sorting
  - `description` (TEXT): Series description/synopsis
  - `publisher_id` (UUID): Publisher foreign key
  - `start_year` (INTEGER): Series start year
  - `end_year` (INTEGER): Series end year (nullable for ongoing)
  - `issue_count` (INTEGER): Total issues in series
  - `cover_path` (TEXT): Series cover image
  - `series_type` (TEXT): comic, manga, graphic_novel, limited, one-shot
  - `reading_direction` (TEXT): ltr, rtl, auto
  - `comicvine_id` (TEXT): ComicVine series ID
  - `anilist_id` (INTEGER): AniList manga ID
  - `mal_id` (INTEGER): MyAnimeList manga ID
  - `created_at` (TIMESTAMPTZ): Record creation time
  - `updated_at` (TIMESTAMPTZ): Last update time

  **Key Columns** (`comic_issues`):
  - `id` (UUID): Primary key
  - `series_id` (UUID): Series foreign key
  - `issue_number` (TEXT): Issue number (e.g., "1", "2.5", "Annual 1")
  - `title` (TEXT): Issue title
  - `description` (TEXT): Issue description
  - `page_count` (INTEGER): Number of pages
  - `cover_path` (TEXT): Issue cover image
  - `release_date` (DATE): Original release date
  - `comicvine_id` (TEXT): ComicVine issue ID
  - `created_at` (TIMESTAMPTZ): Record creation time

  **Key Columns** (`comic_files`):
  - `id` (UUID): Primary key
  - `issue_id` (UUID): Issue foreign key
  - `file_path` (TEXT): Absolute file path
  - `file_size` (BIGINT): Size in bytes
  - `format` (TEXT): File format (CBZ, CBR, CB7, CBT, PDF)
  - `checksum` (TEXT): File checksum (SHA256)
  - `pages_extracted` (BOOLEAN): Pages extracted to cache
  - `created_at` (TIMESTAMPTZ): Record creation time

  **Key Columns** (`comic_reading_progress`):
  - `id` (UUID): Primary key
  - `user_id` (UUID): User foreign key
  - `issue_id` (UUID): Issue foreign key
  - `current_page` (INTEGER): Current page number (1-indexed)
  - `total_pages` (INTEGER): Total pages in issue
  - `progress_percent` (DECIMAL): Completion percentage (0-100)
  - `completed` (BOOLEAN): Issue fully read
  - `last_read_at` (TIMESTAMPTZ): Last reading timestamp

  **Key Columns** (`comic_creators`):
  - `id` (UUID): Primary key
  - `name` (TEXT): Creator name
  - `photo_path` (TEXT): Creator photo
  - `comicvine_id` (TEXT): ComicVine person ID
  - `created_at` (TIMESTAMPTZ): Record creation time

  **Key Columns** (`comic_publishers`):
  - `id` (UUID): Primary key
  - `name` (TEXT): Publisher name
  - `logo_path` (TEXT): Publisher logo
  - `comicvine_id` (TEXT): ComicVine publisher ID
  - `created_at` (TIMESTAMPTZ): Record creation time

  **Indexes**:
  - `idx_comic_series_title_trgm` (GIN trigram) for fuzzy search
  - `idx_comic_series_publisher_id` on `publisher_id`
  - `idx_comic_series_comicvine_id` on `comicvine_id`
  - `idx_comic_series_anilist_id` on `anilist_id`
  - `idx_comic_issues_series_id` on `series_id`
  - `idx_comic_issues_release_date` on `release_date`
  - `idx_comic_reading_progress_user_issue` (unique) on (`user_id`, `issue_id`)
  - `idx_comic_issue_creators_issue_id` on `issue_id`
  - `idx_comic_issue_creators_creator_id` on `creator_id`
reader_features:
  reading_modes:
  - Single page (default)
  - Two-page spread (double-page)
  - Webtoon scroll mode (vertical continuous)
  - Fit to width
  - Fit to height
  navigation:
  - Previous/next page
  - Jump to page
  - Keyboard shortcuts (arrow keys, spacebar)
  - Touch gestures (swipe)
  viewing_options:
  - Zoom controls
  - Pan and zoom
  - Rotate pages
  - Full-screen mode
  reading_direction:
  - Left-to-right (Western comics)
  - Right-to-left (Manga)
  - Auto-detect from metadata
collection_features:
  pull_lists:
    description: Upcoming issues you want to read
    notifications: Notify when new issue available
  reading_lists:
    types:
    - Want to Read
    - Currently Reading
    - Completed
    - Custom lists
  series_tracking:
    progress: Track series completion percentage
    next_issue: Auto-suggest next issue to read
  subscriptions:
    ongoing_series: Auto-add new issues when detected
progress_tracking:
  granularity: Per-page accuracy
  storage: Per-user, per-issue
  sync: Real-time across devices
  history: Reading history with timestamps
  statistics: Total pages read, issues completed
api_endpoints:
- method: GET
  path: /api/v1/comics/series
  description: List all comic series with pagination and filters
- method: GET
  path: /api/v1/comics/series/:id
  description: Get comic series details by ID
- method: GET
  path: /api/v1/comics/series/:id/issues
  description: List all issues in a series
- method: GET
  path: /api/v1/comics/issues
  description: List all comic issues with pagination and filters
- method: GET
  path: /api/v1/comics/issues/:id
  description: Get comic issue details by ID
- method: GET
  path: /api/v1/comics/issues/:id/read
  description: Get issue content for comic reader
- method: GET
  path: /api/v1/comics/issues/:id/pages/:page
  description: Get a specific page image from an issue
- method: GET
  path: /api/v1/comics/issues/:id/progress
  description: Get user reading progress for an issue
- method: PUT
  path: /api/v1/comics/issues/:id/progress
  description: Update user reading progress for an issue
- method: GET
  path: /api/v1/comics/publishers
  description: List all comic publishers
- method: POST
  path: /api/v1/comics/pull-list
  description: Add a series to user pull list
- method: GET
  path: /api/v1/comics/pull-list
  description: Get user pull list of series
architecture_diagram: "```\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n\
  \  â”‚   Client    â”‚â”€â”€â”€â”€â–¶â”‚  API Handler â”‚â”€â”€â”€â”€â–¶â”‚   Service   â”‚\n  â”‚  (Web/App)  â”‚â—€â”€â”€â”€â”€â”‚\
  \   (ogen)     â”‚â—€â”€â”€â”€â”€â”‚   (Logic)   â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   \
  \  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜\n                                                   â”‚\n     \
  \                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                \
  \            â–¼                      â–¼            â–¼\n                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\
  \          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”\n                      â”‚Repositoryâ”‚       \
  \   â”‚ Metadata  â”‚  â”‚  Cache â”‚\n                      â”‚  (sqlc)  â”‚          â”‚  Service\
  \  â”‚  â”‚(otter) â”‚\n                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\
  \                           â”‚                      â”‚\n                         \
  \  â–¼                      â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n\
  \                    â”‚ PostgreSQL  â”‚        â”‚ External â”‚\n                    â”‚\
  \   (pgx)     â”‚        â”‚   APIs   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       \
  \ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  ```"
module_structure: "```\n  internal/content/comics/\n  â”œâ”€â”€ module.go              #\
  \ fx module definition\n  â”œâ”€â”€ repository.go          # Database operations (sqlc)\n\
  \  â”œâ”€â”€ service.go             # Business logic\n  â”œâ”€â”€ handler.go             # HTTP\
  \ handlers (ogen)\n  â”œâ”€â”€ types.go               # Domain types\n  â””â”€â”€ cache.go \
  \              # Caching layer (otter)\n  ```"
component_interaction: |
  1. **Request Flow**:
     - Client sends HTTP request to `/api/v1/comics/*`
     - API handler (ogen) validates request and calls service
     - Service checks cache for existing data
     - If cache miss, service calls repository for database query
     - Repository executes SQL via sqlc-generated code
     - Results flow back through service â†’ handler â†’ client

  2. **Metadata Enrichment**:
     - New comic file scan triggers enrichment
     - Service extracts filename/metadata for series/issue identification
     - Service queries ComicVine API (or manga APIs for manga)
     - Service downloads cover art
     - Service stores series, issue, creator, and publisher data
     - Cache is populated with enriched metadata

  3. **Comic Reader Flow**:
     - Client requests issue content via `/api/v1/comics/issues/{id}/read`
     - Service checks if pages are extracted and cached
     - If not extracted: Service extracts pages from CBZ/CBR/etc. to cache
     - Service returns page count and base URL for page images
     - Client requests individual pages via `/api/v1/comics/issues/{id}/pages/{page}`
     - Service serves cached page images
     - Progress updates sent periodically

  4. **Progress Tracking**:
     - Client sends progress updates as user reads
     - Service updates reading_progress table
     - Progress synced to all user's devices in real-time
     - Last read page restored when opening issue

# Implementation
file_structure: |
  ```
  internal/content/comics/
  â”œâ”€â”€ module.go              # fx.Module with all providers
  â”œâ”€â”€ repository.go          # Database layer
  â”œâ”€â”€ repository_test.go     # Repository tests (testcontainers)
  â”œâ”€â”€ service.go             # Business logic
  â”œâ”€â”€ service_test.go        # Service tests (mocks)
  â”œâ”€â”€ handler.go             # HTTP handlers
  â”œâ”€â”€ handler_test.go        # Handler tests (httptest)
  â”œâ”€â”€ types.go               # Domain types
  â”œâ”€â”€ cache.go               # Caching logic
  â”œâ”€â”€ cache_test.go          # Cache tests
  â”œâ”€â”€ extractor/
  â”‚   â”œâ”€â”€ cbz.go             # CBZ extraction
  â”‚   â”œâ”€â”€ cbr.go             # CBR extraction
  â”‚   â”œâ”€â”€ cb7.go             # CB7 extraction
  â”‚   â”œâ”€â”€ cbt.go             # CBT extraction
  â”‚   â”œâ”€â”€ extractor.go       # Common extractor interface
  â”‚   â””â”€â”€ extractor_test.go  # Extraction tests
  â”œâ”€â”€ metadata/
  â”‚   â”œâ”€â”€ provider.go        # Interface: MetadataProvider
  â”‚   â”œâ”€â”€ comicvine.go       # ComicVine API integration
  â”‚   â”œâ”€â”€ marvel.go          # Marvel API integration
  â”‚   â”œâ”€â”€ gcd.go             # Grand Comics Database
  â”‚   â”œâ”€â”€ anilist.go         # AniList GraphQL (manga)
  â”‚   â”œâ”€â”€ mal.go             # MyAnimeList API (manga)
  â”‚   â””â”€â”€ enricher.go        # Enrichment orchestration
  â””â”€â”€ progress/
      â”œâ”€â”€ tracker.go         # Reading progress tracking
      â””â”€â”€ sync.go            # Multi-device sync logic

  migrations/
  â””â”€â”€ comics/
      â”œâ”€â”€ 001_series.sql     # Series and publishers schema
      â”œâ”€â”€ 002_issues.sql     # Issues and files schema
      â”œâ”€â”€ 003_creators.sql   # Creators schema
      â””â”€â”€ 004_progress.sql   # Progress tracking schema

  api/
  â””â”€â”€ openapi.yaml           # OpenAPI spec (comics/* endpoints)
  ```

key_interfaces: |
  ```go
  // Repository defines database operations for comics
  type Repository interface {
      // Series CRUD
      GetSeries(ctx context.Context, id uuid.UUID) (*Series, error)
      ListSeries(ctx context.Context, filters ListFilters) ([]Series, error)
      CreateSeries(ctx context.Context, series *Series) error
      UpdateSeries(ctx context.Context, series *Series) error
      DeleteSeries(ctx context.Context, id uuid.UUID) error

      // Issue CRUD
      GetIssue(ctx context.Context, id uuid.UUID) (*Issue, error)
      ListIssues(ctx context.Context, seriesID uuid.UUID, filters ListFilters) ([]Issue, error)
      CreateIssue(ctx context.Context, issue *Issue) error
      UpdateIssue(ctx context.Context, issue *Issue) error
      DeleteIssue(ctx context.Context, id uuid.UUID) error

      // Publisher and creator operations
      GetPublisher(ctx context.Context, id uuid.UUID) (*Publisher, error)
      ListPublishers(ctx context.Context) ([]Publisher, error)
      GetCreator(ctx context.Context, id uuid.UUID) (*Creator, error)
      ListCreators(ctx context.Context) ([]Creator, error)

      // Progress tracking
      GetProgress(ctx context.Context, userID, issueID uuid.UUID) (*ReadingProgress, error)
      UpdateProgress(ctx context.Context, progress *ReadingProgress) error
      GetRecentlyRead(ctx context.Context, userID uuid.UUID, limit int) ([]Issue, error)

      // Pull list management
      AddToPullList(ctx context.Context, userID, seriesID uuid.UUID) error
      RemoveFromPullList(ctx context.Context, userID, seriesID uuid.UUID) error
      GetPullList(ctx context.Context, userID uuid.UUID) ([]Series, error)
  }

  // Service defines business logic for comics
  type Service interface {
      // Series operations
      GetSeries(ctx context.Context, id uuid.UUID) (*Series, error)
      SearchSeries(ctx context.Context, query string, filters SearchFilters) ([]Series, error)
      EnrichSeries(ctx context.Context, id uuid.UUID) error

      // Issue operations
      GetIssue(ctx context.Context, id uuid.UUID) (*Issue, error)
      GetIssuePages(ctx context.Context, issueID uuid.UUID) ([]PageInfo, error)
      GetPage(ctx context.Context, issueID uuid.UUID, pageNumber int) (image.Image, error)

      // Progress operations
      UpdateProgress(ctx context.Context, userID, issueID uuid.UUID, progress ProgressUpdate) error
      GetNextIssue(ctx context.Context, userID, issueID uuid.UUID) (*Issue, error)
  }

  // MetadataProvider fetches comic metadata from external sources
  type MetadataProvider interface {
      GetSeriesByID(ctx context.Context, providerID string) (*SeriesMetadata, error)
      GetIssueByID(ctx context.Context, providerID string) (*IssueMetadata, error)
      SearchSeries(ctx context.Context, query string) ([]SeriesMetadata, error)
      SearchIssues(ctx context.Context, seriesID string) ([]IssueMetadata, error)
      GetCreatorByID(ctx context.Context, providerID string) (*CreatorMetadata, error)
  }

  // ComicExtractor extracts pages from comic archive files
  type ComicExtractor interface {
      // ExtractPages extracts all pages from comic archive
      ExtractPages(ctx context.Context, filePath string, outputDir string) ([]string, error)

      // GetPageCount returns number of pages without extraction
      GetPageCount(ctx context.Context, filePath string) (int, error)

      // ExtractPage extracts a single page by number
      ExtractPage(ctx context.Context, filePath string, pageNumber int) (image.Image, error)

      // SupportedFormats returns formats this extractor can handle
      SupportedFormats() []string
  }

  // ProgressTracker manages reading progress synchronization
  type ProgressTracker interface {
      // UpdateProgress updates user's reading position
      UpdateProgress(ctx context.Context, update ProgressUpdate) error

      // GetProgress retrieves current reading position
      GetProgress(ctx context.Context, userID, issueID uuid.UUID) (*ReadingProgress, error)

      // SyncProgress synchronizes progress across devices
      SyncProgress(ctx context.Context, userID uuid.UUID) error

      // GetNextIssue suggests next issue to read in series
      GetNextIssue(ctx context.Context, userID, currentIssueID uuid.UUID) (*Issue, error)
  }
  ```

dependencies: |
  **Go Dependencies**:
  - `github.com/jackc/pgx/v5/pgxpool` - PostgreSQL connection pool
  - `github.com/google/uuid` - UUID generation
  - `github.com/maypok86/otter` - In-memory cache
  - `github.com/gen2brain/go-unarr` - CBZ/CBR/CB7/CBT extraction
  - `github.com/disintegration/imaging` - Image processing
  - `github.com/go-resty/resty/v2` - HTTP client for external APIs
  - `go.uber.org/fx` - Dependency injection
  - `github.com/riverqueue/river` - Background job queue

  **External APIs**:
  - ComicVine API - Primary metadata for Western comics
  - Marvel API - Official Marvel comics metadata
  - Grand Comics Database - Historical comics data
  - AniList GraphQL API - Manga metadata
  - MyAnimeList API - Alternative manga metadata

  **Database**:
  - PostgreSQL 18+ with trigram extension for fuzzy search

# Configuration
env_vars: |
  **Environment Variables**:
  - `REVENGE_COMIC_CACHE_TTL` - Cache TTL duration (default: 30m)
  - `REVENGE_COMIC_CACHE_SIZE` - Cache size in MB (default: 200)
  - `REVENGE_METADATA_COMICVINE_API_KEY` - ComicVine API key (required)
  - `REVENGE_METADATA_MARVEL_API_KEY` - Marvel API public key (optional)
  - `REVENGE_METADATA_MARVEL_API_PRIVATE_KEY` - Marvel API private key (optional)
  - `REVENGE_METADATA_ANILIST_ENABLED` - Enable AniList for manga (default: true)
  - `REVENGE_METADATA_MAL_CLIENT_ID` - MyAnimeList client ID (optional)
  - `REVENGE_COMIC_PAGE_CACHE_PATH` - Path for cached extracted pages
  - `REVENGE_COMIC_PAGE_CACHE_SIZE_GB` - Max page cache size in GB (default: 50)

config_keys: |
  **config.yaml keys**:
  ```yaml
  comic:
    cache:
      ttl: 30m
      size_mb: 200

    metadata:
      comicvine:
        api_key: ${REVENGE_METADATA_COMICVINE_API_KEY}
        rate_limit: 1  # Requests per second
        timeout: 15s

      marvel:
        enabled: false
        public_key: ${REVENGE_METADATA_MARVEL_API_KEY}
        private_key: ${REVENGE_METADATA_MARVEL_API_PRIVATE_KEY}

      gcd:
        enabled: true
        api_url: https://www.comics.org/api/

      anilist:
        enabled: true
        rate_limit: 90  # Per minute

      mal:
        enabled: false
        client_id: ${REVENGE_METADATA_MAL_CLIENT_ID}

      priority:
        comics:
          - comicvine
          - marvel
          - gcd
        manga:
          - anilist
          - mal

    reader:
      page_cache:
        enabled: true
        path: ${REVENGE_COMIC_PAGE_CACHE_PATH}
        max_size_gb: 50
        cleanup_policy: lru

      image_optimization:
        enabled: true
        max_width: 2048
        max_height: 2048
        quality: 85
        format: webp

      extraction:
        on_demand: false  # Extract all pages on first access
        parallel: true
        max_workers: 4

    features:
      pull_lists_enabled: true
      reading_lists_enabled: true
      series_tracking_enabled: true
      auto_suggest_next_enabled: true
  ```

defaults: |
  - Cache TTL: 30 minutes
  - Cache size: 200 MB
  - ComicVine rate limit: 1 request/second
  - Page cache size: 50 GB
  - Image optimization: enabled (WebP, 2048x2048 max, 85% quality)
  - On-demand extraction: disabled (extract all on first access)
  - Metadata priority (comics): ComicVine â†’ Marvel â†’ GCD
  - Metadata priority (manga): AniList â†’ MyAnimeList

# API Endpoints (additional to those already listed)
request_examples: |
  **List comic series with filters**:
  ```http
  GET /api/v1/comics/series?publisher=publisher-uuid&type=comic&limit=20&offset=0
  Authorization: Bearer {token}
  ```

  **Get series with issues**:
  ```http
  GET /api/v1/comics/series/550e8400-e29b-41d4-a716-446655440000?include=issues
  Authorization: Bearer {token}
  ```

  **Get issue content for reader**:
  ```http
  GET /api/v1/comics/issues/650e8400-e29b-41d4-a716-446655440000/read
  Authorization: Bearer {token}
  ```

  **Get specific page image**:
  ```http
  GET /api/v1/comics/issues/650e8400-e29b-41d4-a716-446655440000/pages/15
  Authorization: Bearer {token}
  ```

  **Update reading progress**:
  ```http
  PUT /api/v1/comics/issues/650e8400-e29b-41d4-a716-446655440000/progress
  Authorization: Bearer {token}
  Content-Type: application/json

  {
    "current_page": 15,
    "completed": false
  }
  ```

  **Add to pull list**:
  ```http
  POST /api/v1/comics/pull-list
  Authorization: Bearer {token}
  Content-Type: application/json

  {
    "series_id": "550e8400-e29b-41d4-a716-446655440000"
  }
  ```

response_examples: |
  **Series details response**:
  ```json
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "The Amazing Spider-Man",
    "sort_title": "Amazing Spider-Man, The",
    "description": "The classic Spider-Man series...",
    "publisher": {
      "id": "...",
      "name": "Marvel Comics"
    },
    "start_year": 1963,
    "end_year": null,
    "issue_count": 900,
    "cover_path": "/comics/series/amazing-spider-man.jpg",
    "series_type": "comic",
    "reading_direction": "ltr",
    "user_progress": {
      "issues_read": 45,
      "completion_percent": 5.0
    },
    "in_pull_list": true,
    "created_at": "2024-01-01T00:00:00Z"
  }
  ```

  **Issue details response**:
  ```json
  {
    "id": "650e8400-e29b-41d4-a716-446655440000",
    "series_id": "550e8400-e29b-41d4-a716-446655440000",
    "issue_number": "1",
    "title": "With Great Power",
    "description": "The origin of Spider-Man...",
    "page_count": 22,
    "cover_path": "/comics/issues/asm-1.jpg",
    "release_date": "1963-03-01",
    "creators": [
      {
        "id": "...",
        "name": "Stan Lee",
        "role": "Writer"
      },
      {
        "id": "...",
        "name": "Steve Ditko",
        "role": "Artist"
      }
    ],
    "user_progress": {
      "current_page": 15,
      "progress_percent": 68.2,
      "completed": false,
      "last_read_at": "2024-01-15T20:30:00Z"
    },
    "created_at": "2024-01-01T00:00:00Z"
  }
  ```

  **Reader data response**:
  ```json
  {
    "issue_id": "650e8400-e29b-41d4-a716-446655440000",
    "page_count": 22,
    "reading_direction": "ltr",
    "page_urls": [
      "/api/v1/comics/issues/650e8400.../pages/1",
      "/api/v1/comics/issues/650e8400.../pages/2"
    ],
    "current_page": 15,
    "series_info": {
      "title": "The Amazing Spider-Man",
      "issue_number": "1"
    }
  }
  ```

# Testing
unit_tests: |
  **Repository Tests** (with testcontainers):
  - Test CRUD operations for series
  - Test CRUD operations for issues
  - Test publisher and creator associations
  - Test progress tracking
  - Test pull list management
  - Test reading list management
  - Test search with filters

  **Service Tests** (with mocks):
  - Test business logic with mocked repository
  - Test metadata enrichment flow (ComicVine â†’ fallbacks)
  - Test manga enrichment (AniList â†’ MAL)
  - Test cache hit/miss scenarios
  - Test error handling
  - Test rate limiting

  **Handler Tests** (with httptest):
  - Test HTTP request/response handling
  - Test authentication/authorization
  - Test request validation
  - Test error responses
  - Test pagination

  **Extractor Tests**:
  - Test CBZ extraction
  - Test CBR extraction
  - Test CB7 extraction
  - Test CBT extraction
  - Test PDF page extraction
  - Test page count detection
  - Test corrupted archive handling

  **Progress Tracking Tests**:
  - Test progress update logic
  - Test multi-device sync
  - Test next issue suggestion
  - Test series completion tracking

integration_tests: |
  **Full Stack Tests**:
  - Test complete request flow (client â†’ database)
  - Test metadata enrichment with real ComicVine API (rate-limited)
  - Test manga enrichment with AniList (mocked)
  - Test comic reader page serving end-to-end
  - Test page extraction and caching
  - Test progress sync across simulated devices

  **Database Tests**:
  - Test migrations (up/down)
  - Test indexes performance
  - Test foreign key constraints
  - Test transaction isolation
  - Test trigram search performance

  **Reader Tests**:
  - Test page extraction from various formats
  - Test image optimization
  - Test page caching
  - Test concurrent page requests
  - Test reading direction detection

test_coverage_target: |
  - **Overall**: 80% minimum
  - **Repository**: 90% (critical path)
  - **Service**: 85% (business logic)
  - **Handler**: 75% (integration layer)
  - **Metadata providers**: 70% (external dependency)
  - **Extractor components**: 90% (critical functionality)
  - **Progress tracking**: 85% (user experience)
