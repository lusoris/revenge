openapi: 3.1.0
info:
  title: Revenge Media Server API
  version: 0.1.0
  description: |
    Modern, self-hosted media server with Go backend and SvelteKit frontend.

    This is the skeleton API for v0.1.0 - only health endpoints are implemented.
  contact:
    name: Revenge Development Team
    url: https://github.com/lusoris/revenge
  license:
    name: AGPL-3.0
    url: https://www.gnu.org/licenses/agpl-3.0.html

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.revenge.example.com
    description: Production server

tags:
  - name: health
    description: Health check endpoints for monitoring and Kubernetes probes
  - name: auth
    description: Authentication and user registration
  - name: mfa
    description: Multi-factor authentication (TOTP, WebAuthn, backup codes)
  - name: movies
    description: Movie library management and playback
  - name: collections
    description: Movie collections (e.g., MCU, Star Wars)
  - name: tvshows
    description: TV show library management and playback
  - name: search
    description: Full-text search across the library using Typesense
  - name: metadata
    description: External metadata lookup (TMDb)
  - name: images
    description: Image proxy for TMDb images
  - name: settings
    description: Server and user settings management
  - name: users
    description: User account and profile management
  - name: Integrations Admin
    description: Admin endpoints for managing integrations (Radarr, Sonarr, etc.)
  - name: Webhooks
    description: Webhook endpoints for external service notifications
  - name: playback
    description: HLS streaming and playback session management

paths:
  /healthz:
    get:
      summary: Liveness probe
      description: |
        Checks if the service is alive and running.
        This should always return 200 unless the process is deadlocked.
        Used by Kubernetes liveness probes.
      operationId: getLiveness
      tags:
        - health
      responses:
        '200':
          description: Service is alive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'
        default:
          $ref: '#/components/responses/Error'

  /readyz:
    get:
      summary: Readiness probe
      description: |
        Checks if the service is ready to accept traffic.
        Returns 200 only if all dependencies (database, cache, etc.) are available.
        Used by Kubernetes readiness probes.
      operationId: getReadiness
      tags:
        - health
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'
        '503':
          description: Service is not ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'
        default:
          $ref: '#/components/responses/Error'

  /startupz:
    get:
      summary: Startup probe
      description: |
        Checks if the service has completed initialization.
        Returns 200 only after startup is complete.
        Used by Kubernetes startup probes.
      operationId: getStartup
      tags:
        - health
      responses:
        '200':
          description: Startup complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'
        '503':
          description: Startup in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'
        default:
          $ref: '#/components/responses/Error'

  # Auth endpoints
  /api/v1/auth/register:
    post:
      summary: Register new user
      description: Create a new user account with username, email, and password
      operationId: register
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/auth/login:
    post:
      summary: Login with credentials
      description: Authenticate user and return access token and refresh token
      operationId: login
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/auth/logout:
    post:
      summary: Logout
      description: Invalidate the current refresh token
      operationId: logout
      tags:
        - auth
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '204':
          description: Logout successful
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/auth/refresh:
    post:
      summary: Refresh access token
      description: Exchange refresh token for a new access token
      operationId: refreshToken
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/auth/verify-email:
    post:
      summary: Verify email
      description: Verify user email address with token from verification email
      operationId: verifyEmail
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyEmailRequest'
      responses:
        '204':
          description: Email verified successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/auth/resend-verification:
    post:
      summary: Resend verification email
      description: Resend email verification token to user's email address
      operationId: resendVerification
      tags:
        - auth
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '204':
          description: Verification email sent
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/auth/forgot-password:
    post:
      summary: Request password reset
      description: Send password reset token to user's email address
      operationId: forgotPassword
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
      responses:
        '204':
          description: Password reset email sent (if email exists)
        '400':
          $ref: '#/components/responses/BadRequest'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/auth/reset-password:
    post:
      summary: Reset password
      description: Reset password using token from password reset email
      operationId: resetPassword
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '204':
          description: Password reset successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/auth/change-password:
    post:
      summary: Change password
      description: Change password for authenticated user (requires old password)
      operationId: changePassword
      tags:
        - auth
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '204':
          description: Password changed successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  # MFA endpoints
  /api/v1/mfa/status:
    get:
      summary: Get MFA status
      description: Get current MFA configuration status for authenticated user
      operationId: getMFAStatus
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: MFA status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MFAStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/totp/setup:
    post:
      summary: Setup TOTP
      description: Generate TOTP secret and QR code for enrollment
      operationId: setupTOTP
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - accountName
              properties:
                accountName:
                  type: string
                  description: Account name to display in authenticator app (usually email or username)
                  example: user@example.com
      responses:
        '200':
          description: TOTP setup information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TOTPSetup'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/totp/verify:
    post:
      summary: Verify and enable TOTP
      description: Verify TOTP code to complete enrollment and enable TOTP
      operationId: verifyTOTP
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
              properties:
                code:
                  type: string
                  description: 6-digit TOTP code
                  pattern: '^\d{6}$'
                  example: "123456"
      responses:
        '200':
          description: TOTP verified and enabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: TOTP enabled successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/totp:
    delete:
      summary: Disable TOTP
      description: Remove TOTP from user's MFA methods
      operationId: disableTOTP
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '204':
          description: TOTP disabled successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/backup-codes/generate:
    post:
      summary: Generate backup codes
      description: Generate new set of 10 one-time use backup codes
      operationId: generateBackupCodes
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Backup codes generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  codes:
                    type: array
                    items:
                      type: string
                      pattern: '^[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}$'
                    description: List of backup codes (shown only once)
                    example:
                      - "1a2b-3c4d-5e6f-7890"
                      - "9876-5432-10ab-cdef"
                  count:
                    type: integer
                    example: 10
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/backup-codes/regenerate:
    post:
      summary: Regenerate backup codes
      description: Delete all existing backup codes and generate a new set
      operationId: regenerateBackupCodes
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Backup codes regenerated
          content:
            application/json:
              schema:
                type: object
                properties:
                  codes:
                    type: array
                    items:
                      type: string
                    example:
                      - "1a2b-3c4d-5e6f-7890"
                  count:
                    type: integer
                    example: 10
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/enable:
    post:
      summary: Enable MFA requirement
      description: Require MFA for login (at least one method must be configured)
      operationId: enableMFA
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: MFA requirement enabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/disable:
    post:
      summary: Disable MFA requirement
      description: Turn off MFA requirement for login
      operationId: disableMFA
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: MFA requirement disabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  # WebAuthn endpoints
  /api/v1/mfa/webauthn/register/begin:
    post:
      summary: Begin WebAuthn registration
      description: Start the WebAuthn credential registration ceremony. Returns PublicKeyCredentialCreationOptions.
      operationId: beginWebAuthnRegistration
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                credential_name:
                  type: string
                  description: User-facing name for the credential
                  example: "My YubiKey"
      responses:
        '200':
          description: Registration options
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebAuthnBeginRegistrationResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/webauthn/register/finish:
    post:
      summary: Finish WebAuthn registration
      description: Complete the WebAuthn registration ceremony with the authenticator response.
      operationId: finishWebAuthnRegistration
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebAuthnFinishRegistrationRequest'
      responses:
        '200':
          description: Registration complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: WebAuthn credential registered successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/webauthn/login/begin:
    post:
      summary: Begin WebAuthn login
      description: Start the WebAuthn authentication ceremony. Returns PublicKeyCredentialRequestOptions.
      operationId: beginWebAuthnLogin
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Login options
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebAuthnBeginLoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/webauthn/login/finish:
    post:
      summary: Finish WebAuthn login
      description: Complete the WebAuthn authentication ceremony with the authenticator assertion.
      operationId: finishWebAuthnLogin
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebAuthnFinishLoginRequest'
      responses:
        '200':
          description: Login verified
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: WebAuthn verification successful
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/webauthn/credentials:
    get:
      summary: List WebAuthn credentials
      description: List all WebAuthn credentials for the authenticated user
      operationId: listWebAuthnCredentials
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Credentials list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebAuthnCredentialsList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/mfa/webauthn/credentials/{credentialId}:
    delete:
      summary: Delete WebAuthn credential
      description: Remove a WebAuthn credential
      operationId: deleteWebAuthnCredential
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: credentialId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Credential deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'
    patch:
      summary: Rename WebAuthn credential
      description: Update the user-facing name of a WebAuthn credential
      operationId: renameWebAuthnCredential
      tags:
        - mfa
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: credentialId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  description: New name for the credential
                  example: "My YubiKey 5"
      responses:
        '200':
          description: Credential renamed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # Movie endpoints
  /api/v1/movies:
    get:
      summary: List movies
      description: Get a paginated list of movies with optional filtering and sorting
      operationId: listMovies
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: order_by
          in: query
          description: Sort order (title, year, added, rating)
          schema:
            type: string
            enum: [title, year, added, rating]
            default: added
        - name: limit
          in: query
          description: Number of movies per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Number of movies to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of movies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/search:
    get:
      summary: Search movies
      description: Search movies by title using fuzzy matching
      operationId: searchMovies
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: query
          in: query
          required: true
          description: Search query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Movie'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/recently-added:
    get:
      summary: Get recently added movies
      description: Get movies ordered by when they were added to the library
      operationId: getRecentlyAdded
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Recently added movies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/top-rated:
    get:
      summary: Get top-rated movies
      description: Get highest-rated movies
      operationId: getTopRated
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: min_votes
          in: query
          description: Minimum number of votes required
          schema:
            type: integer
            minimum: 0
            default: 100
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Top-rated movies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/continue-watching:
    get:
      summary: Get continue watching list
      description: Get movies the user is currently watching
      operationId: getContinueWatching
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Continue watching list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContinueWatchingItem'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/watch-history:
    get:
      summary: Get watch history
      description: Get user's watched movies
      operationId: getWatchHistory
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Watch history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WatchedMovieItem'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/stats:
    get:
      summary: Get user movie statistics
      description: Get statistics about user's movie watching
      operationId: getUserMovieStats
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: User statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserMovieStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}:
    get:
      summary: Get movie details
      description: Get detailed information about a movie
      operationId: getMovie
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Movie details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Movie'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/files:
    get:
      summary: Get movie files
      description: Get physical files for a movie
      operationId: getMovieFiles
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Movie files
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MovieFile'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/cast:
    get:
      summary: Get movie cast
      description: Get cast members for a movie
      operationId: getMovieCast
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Movie cast
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieCreditListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/crew:
    get:
      summary: Get movie crew
      description: Get crew members for a movie
      operationId: getMovieCrew
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Movie crew
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieCreditListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/genres:
    get:
      summary: Get movie genres
      description: Get genres for a movie
      operationId: getMovieGenres
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Movie genres
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MovieGenre'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/collection:
    get:
      summary: Get movie collection
      description: Get the collection this movie belongs to
      operationId: getMovieCollection
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Movie collection
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieCollection'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/similar:
    get:
      summary: Get similar movies
      description: Get movies similar to this one based on TMDb recommendations
      operationId: getSimilarMovies
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of similar movies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimilarMoviesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/progress:
    get:
      summary: Get watch progress
      description: Get user's watch progress for a movie
      operationId: getWatchProgress
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Watch progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieWatched'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    post:
      summary: Update watch progress
      description: Update or create watch progress for a movie
      operationId: updateWatchProgress
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - progressSeconds
                - durationSeconds
              properties:
                progressSeconds:
                  type: integer
                  minimum: 0
                  description: Current playback position in seconds
                durationSeconds:
                  type: integer
                  minimum: 1
                  description: Total duration in seconds
      responses:
        '200':
          description: Watch progress updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieWatched'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    delete:
      summary: Delete watch progress
      description: Remove watch progress for a movie
      operationId: deleteWatchProgress
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Watch progress deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/watched:
    post:
      summary: Mark movie as watched
      description: Mark a movie as fully watched
      operationId: markAsWatched
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Movie marked as watched
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/movies/{id}/refresh:
    post:
      summary: Refresh movie metadata
      description: Trigger a metadata refresh from TMDb/Radarr
      operationId: refreshMovieMetadata
      tags:
        - movies
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: string
            format: uuid
      responses:
        '202':
          description: Metadata refresh queued
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/collections/{id}:
    get:
      summary: Get collection details
      description: Get detailed information about a collection
      operationId: getCollection
      tags:
        - collections
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Collection ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Collection details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieCollection'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/collections/{id}/movies:
    get:
      summary: Get collection movies
      description: Get all movies in a collection
      operationId: getCollectionMovies
      tags:
        - collections
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Collection ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Collection movies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Movie'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # TV Show endpoints
  /api/v1/tvshows:
    get:
      summary: List TV shows
      description: Get a paginated list of TV shows with optional filtering and sorting
      operationId: listTVShows
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: order_by
          in: query
          required: false
          schema:
            type: string
            enum: [created_at, title, first_air_date, vote_average, popularity]
            default: created_at
          description: Field to sort by
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: List of TV shows
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVShowListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/search:
    get:
      summary: Search TV shows
      description: Search TV shows by title using fuzzy matching
      operationId: searchTVShows
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
            minLength: 1
          description: Search query
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Matching TV shows
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TVSeries'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/recently-added:
    get:
      summary: Get recently added TV shows
      description: Get TV shows ordered by when they were added to the library
      operationId: getRecentlyAddedTVShows
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Recently added TV shows
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVSeriesListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/continue-watching:
    get:
      summary: Get continue watching list for TV shows
      description: Get TV shows the user is currently watching
      operationId: getTVContinueWatching
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Continue watching list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TVContinueWatchingItem'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/stats:
    get:
      summary: Get user TV show statistics
      description: Get statistics about user's TV show watching
      operationId: getUserTVStats
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: User TV statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserTVStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/episodes/recent:
    get:
      summary: Get recent episodes
      description: Get recently aired episodes across all TV shows
      operationId: getRecentEpisodes
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Recent episodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EpisodeWithSeriesInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/episodes/upcoming:
    get:
      summary: Get upcoming episodes
      description: Get upcoming episodes across all TV shows
      operationId: getUpcomingEpisodes
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Upcoming episodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EpisodeWithSeriesInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}:
    get:
      summary: Get TV show details
      description: Get detailed information about a TV show
      operationId: getTVShow
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: TV show details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVSeries'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/seasons:
    get:
      summary: Get TV show seasons
      description: Get all seasons for a TV show
      operationId: getTVShowSeasons
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: TV show seasons
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TVSeason'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/episodes:
    get:
      summary: Get all episodes for a TV show
      description: Get all episodes across all seasons for a TV show
      operationId: getTVShowEpisodes
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: TV show episodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TVEpisode'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/cast:
    get:
      summary: Get TV show cast
      description: Get cast members for a TV show
      operationId: getTVShowCast
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: TV show cast
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVSeriesCreditListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/crew:
    get:
      summary: Get TV show crew
      description: Get crew members for a TV show
      operationId: getTVShowCrew
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: TV show crew
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVSeriesCreditListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/genres:
    get:
      summary: Get TV show genres
      description: Get genres for a TV show
      operationId: getTVShowGenres
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: TV show genres
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TVGenre'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/networks:
    get:
      summary: Get TV show networks
      description: Get networks for a TV show
      operationId: getTVShowNetworks
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: TV show networks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TVNetwork'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/movie/{tmdbId}/credits:
    get:
      summary: Get movie credits from metadata provider
      description: |
        Fetch cast and crew credits for a movie from TMDb.
      operationId: getMovieMetadataCredits
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb movie ID
          example: 550
      responses:
        '200':
          description: Movie credits
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataCredits'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/movie/{tmdbId}/images:
    get:
      summary: Get movie images from metadata provider
      description: |
        Fetch all available images (posters, backdrops, logos) for a movie from TMDb.
      operationId: getMovieMetadataImages
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb movie ID
          example: 550
        - name: language
          in: query
          required: false
          schema:
            type: string
          description: ISO 639-1 language filter (e.g. en, de)
          example: en
      responses:
        '200':
          description: Movie images
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataImages'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/movie/{tmdbId}/similar:
    get:
      summary: Get similar movies from metadata provider
      description: |
        Fetch a list of similar movies from TMDb based on genres and keywords.
      operationId: getSimilarMoviesMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb movie ID
          example: 550
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Maximum number of results
      responses:
        '200':
          description: Similar movies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataSearchResults'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/movie/{tmdbId}/recommendations:
    get:
      summary: Get movie recommendations from metadata provider
      description: |
        Fetch recommended movies from TMDb based on user ratings and viewing patterns.
      operationId: getMovieRecommendationsMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb movie ID
          example: 550
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Maximum number of results
      responses:
        '200':
          description: Recommended movies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataSearchResults'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/movie/{tmdbId}/external-ids:
    get:
      summary: Get movie external IDs
      description: |
        Fetch external database IDs for a movie (IMDb, TVDb, Wikidata, social media).
      operationId: getMovieExternalIDs
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb movie ID
          example: 550
      responses:
        '200':
          description: External IDs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataExternalIDs'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}/credits:
    get:
      summary: Get TV show credits from metadata provider
      description: |
        Fetch aggregate cast and crew credits for a TV show from TMDb.
      operationId: getTVShowMetadataCredits
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
      responses:
        '200':
          description: TV show credits
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataCredits'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}/images:
    get:
      summary: Get TV show images from metadata provider
      description: |
        Fetch all available images (posters, backdrops, logos) for a TV show from TMDb.
      operationId: getTVShowMetadataImages
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
        - name: language
          in: query
          required: false
          schema:
            type: string
          description: ISO 639-1 language filter
          example: en
      responses:
        '200':
          description: TV show images
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataImages'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}/content-ratings:
    get:
      summary: Get TV show content ratings
      description: |
        Fetch content ratings (age classifications) for a TV show across different countries.
      operationId: getTVShowContentRatings
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
      responses:
        '200':
          description: Content ratings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataContentRatings'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}/external-ids:
    get:
      summary: Get TV show external IDs
      description: |
        Fetch external database IDs for a TV show (IMDb, TVDb, Wikidata, social media).
      operationId: getTVShowExternalIDs
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
      responses:
        '200':
          description: External IDs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataExternalIDs'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}/season/{seasonNumber}/images:
    get:
      summary: Get season images from metadata provider
      description: |
        Fetch all available images (posters) for a TV season from TMDb.
      operationId: getSeasonMetadataImages
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
        - name: seasonNumber
          in: path
          required: true
          schema:
            type: integer
          description: Season number
          example: 1
        - name: language
          in: query
          required: false
          schema:
            type: string
          description: ISO 639-1 language filter
          example: en
      responses:
        '200':
          description: Season images
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataImages'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}/season/{seasonNumber}/episode/{episodeNumber}/images:
    get:
      summary: Get episode images from metadata provider
      description: |
        Fetch all available images (stills) for a TV episode from TMDb.
      operationId: getEpisodeMetadataImages
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
        - name: seasonNumber
          in: path
          required: true
          schema:
            type: integer
          description: Season number
          example: 1
        - name: episodeNumber
          in: path
          required: true
          schema:
            type: integer
          description: Episode number
          example: 1
        - name: language
          in: query
          required: false
          schema:
            type: string
          description: ISO 639-1 language filter
          example: en
      responses:
        '200':
          description: Episode images
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataImages'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/search/person:
    get:
      summary: Search people via metadata provider
      description: |
        Search for actors, directors, and other crew members. By default uses TMDb.
        Use the `provider` parameter to search via a different provider (e.g., tvdb).
      operationId: searchPersonMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
          example: Brad Pitt
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Maximum number of results
        - name: provider
          in: query
          required: false
          schema:
            type: string
            enum:
              - tmdb
              - tvdb
          description: Metadata provider to search (default tmdb)
        - name: language
          in: query
          required: false
          schema:
            type: string
            pattern: '^[a-z]{2}(-[A-Z]{2})?$'
          description: ISO 639-1 language code (e.g., en, de, pt-BR)
          example: en
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataPersonSearchResults'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/person/{tmdbId}:
    get:
      summary: Get person details from metadata provider
      description: |
        Fetch detailed information about a person (actor, director, etc.) from TMDb.
      operationId: getPersonMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb person ID
          example: 287
      responses:
        '200':
          description: Person details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataPerson'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/person/{tmdbId}/credits:
    get:
      summary: Get person credits from metadata provider
      description: |
        Fetch filmography (cast and crew credits) for a person from TMDb.
      operationId: getPersonMetadataCredits
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb person ID
          example: 287
      responses:
        '200':
          description: Person credits
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataPersonCredits'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/person/{tmdbId}/images:
    get:
      summary: Get person images from metadata provider
      description: |
        Fetch all available profile images for a person from TMDb.
      operationId: getPersonMetadataImages
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb person ID
          example: 287
      responses:
        '200':
          description: Person images
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataImages'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/providers:
    get:
      summary: List available metadata providers
      description: |
        Returns the list of registered metadata providers and their capabilities.
      operationId: listMetadataProviders
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Available providers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataProviderList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/watch-stats:
    get:
      summary: Get watch stats for a TV show
      description: Get user's watch statistics for a specific TV show
      operationId: getTVShowWatchStats
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: TV show watch stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeriesWatchStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/next-episode:
    get:
      summary: Get next unwatched episode
      description: Get the next episode to watch for a TV show
      operationId: getTVShowNextEpisode
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Next unwatched episode
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVEpisode'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/{id}/refresh:
    post:
      summary: Refresh TV show metadata
      description: Trigger a metadata refresh from TMDb/Sonarr
      operationId: refreshTVShowMetadata
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: TV Show ID
          schema:
            type: string
            format: uuid
      responses:
        '202':
          description: Metadata refresh queued
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/seasons/{id}:
    get:
      summary: Get season details
      description: Get detailed information about a season
      operationId: getTVSeason
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Season ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Season details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVSeason'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/seasons/{id}/episodes:
    get:
      summary: Get season episodes
      description: Get all episodes for a season
      operationId: getTVSeasonEpisodes
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Season ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Season episodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TVEpisode'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/episodes/{id}:
    get:
      summary: Get episode details
      description: Get detailed information about an episode
      operationId: getTVEpisode
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Episode ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Episode details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVEpisode'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/episodes/{id}/files:
    get:
      summary: Get episode files
      description: Get physical files for an episode
      operationId: getTVEpisodeFiles
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Episode ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Episode files
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TVEpisodeFile'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/episodes/{id}/progress:
    get:
      summary: Get episode watch progress
      description: Get user's watch progress for an episode
      operationId: getTVEpisodeProgress
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Episode ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Episode watch progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EpisodeWatchProgress'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'
    put:
      summary: Update episode watch progress
      description: Update user's watch progress for an episode
      operationId: updateTVEpisodeProgress
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Episode ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEpisodeProgressRequest'
      responses:
        '200':
          description: Updated watch progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EpisodeWatchProgress'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'
    delete:
      summary: Delete episode watch progress
      description: Delete user's watch progress for an episode
      operationId: deleteTVEpisodeProgress
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Episode ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Progress deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/episodes/{id}/watched:
    post:
      summary: Mark episode as watched
      description: Mark an episode as fully watched
      operationId: markTVEpisodeWatched
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Episode ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                duration_seconds:
                  type: integer
                  description: Episode duration in seconds (optional)
      responses:
        '204':
          description: Episode marked as watched
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/tvshows/episodes/bulk-watched:
    post:
      summary: Mark multiple episodes as watched
      description: |
        Mark multiple episodes as fully watched in a single request.
        Uses episode runtimes for duration; defaults to 45 minutes when unavailable.
        Episodes that do not exist are silently skipped.
      operationId: markTVEpisodesBulkWatched
      tags:
        - tvshows
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkEpisodesWatchedRequest'
      responses:
        '200':
          description: Episodes marked as watched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkEpisodesWatchedResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  # Metadata endpoints (external lookup)
  /api/v1/metadata/search/movie:
    get:
      summary: Search movies via metadata provider
      description: |
        Search for movies using an external metadata provider. By default uses TMDb.
        Use the `provider` parameter to search via a different provider (e.g., tvdb).
        This searches the external metadata provider, not the local library.
      operationId: searchMoviesMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 1
            maxLength: 100
          description: Search query (movie title)
          example: "The Matrix"
        - name: year
          in: query
          required: false
          schema:
            type: integer
            minimum: 1888
            maximum: 2100
          description: Filter by release year
          example: 1999
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
          description: Maximum results to return
        - name: provider
          in: query
          required: false
          schema:
            type: string
            enum:
              - tmdb
              - tvdb
              - radarr
          description: Metadata provider to search (default tmdb). Use 'radarr' to search via the configured Radarr instance.
        - name: language
          in: query
          required: false
          schema:
            type: string
            pattern: '^[a-z]{2}(-[A-Z]{2})?$'
          description: ISO 639-1 language code (e.g., en, de, pt-BR)
          example: en
      responses:
        '200':
          description: Search results from metadata provider
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataSearchResults'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/movie/{tmdbId}:
    get:
      summary: Get movie details from TMDb
      description: |
        Fetch detailed movie information from TMDb by TMDb ID.
        Returns full metadata including cast, crew, and images.
      operationId: getMovieMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb movie ID
          example: 603
      responses:
        '200':
          description: Movie metadata from TMDb
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataMovie'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/collection/{tmdbId}:
    get:
      summary: Get collection details from TMDb
      description: |
        Fetch detailed collection information from TMDb by collection ID.
        Returns collection metadata including all movies in the collection.
      operationId: getCollectionMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb collection ID
          example: 86311
      responses:
        '200':
          description: Collection metadata from TMDb
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataCollection'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/search/tv:
    get:
      summary: Search TV shows via metadata provider
      description: |
        Search for TV shows using an external metadata provider. By default uses TMDb.
        Use the `provider` parameter to search via a different provider (e.g., tvdb).
        Returns matching TV shows with basic metadata.
      operationId: searchTVShowsMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
          example: "Breaking Bad"
        - name: year
          in: query
          required: false
          schema:
            type: integer
          description: Filter by first air year
          example: 2008
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            maximum: 100
          description: Maximum results to return
        - name: provider
          in: query
          required: false
          schema:
            type: string
            enum:
              - tmdb
              - tvdb
              - sonarr
          description: Metadata provider to search (default tmdb). Use 'sonarr' to search via the configured Sonarr instance.
        - name: language
          in: query
          required: false
          schema:
            type: string
            pattern: '^[a-z]{2}(-[A-Z]{2})?$'
          description: ISO 639-1 language code (e.g., en, de, pt-BR)
          example: en
      responses:
        '200':
          description: TV show search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataTVSearchResults'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}:
    get:
      summary: Get TV show details from TMDb
      description: |
        Fetch detailed TV show information from TMDb by TV show ID.
        Returns comprehensive metadata including seasons overview.
      operationId: getTVShowMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
      responses:
        '200':
          description: TV show metadata from TMDb
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataTVShow'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}/season/{seasonNumber}:
    get:
      summary: Get season details from TMDb
      description: |
        Fetch detailed season information from TMDb.
        Returns season metadata including episodes overview.
      operationId: getSeasonMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
        - name: seasonNumber
          in: path
          required: true
          schema:
            type: integer
          description: Season number
          example: 1
      responses:
        '200':
          description: Season metadata from TMDb
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataSeason'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/metadata/tv/{tmdbId}/season/{seasonNumber}/episode/{episodeNumber}:
    get:
      summary: Get episode details from TMDb
      description: |
        Fetch detailed episode information from TMDb.
        Returns episode metadata including guest stars and crew.
      operationId: getEpisodeMetadata
      tags:
        - metadata
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: tmdbId
          in: path
          required: true
          schema:
            type: integer
          description: TMDb TV show ID
          example: 1396
        - name: seasonNumber
          in: path
          required: true
          schema:
            type: integer
          description: Season number
          example: 1
        - name: episodeNumber
          in: path
          required: true
          schema:
            type: integer
          description: Episode number
          example: 1
      responses:
        '200':
          description: Episode metadata from TMDb
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetadataEpisode'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/images/{type}/{size}/{path}:
    get:
      summary: Proxy image from TMDb
      description: |
        Proxy images from TMDb image server. This caches images locally
        and serves them to clients without exposing TMDb API keys.
      operationId: getProxiedImage
      tags:
        - images
      parameters:
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [poster, backdrop, profile, logo]
          description: Image type
          example: poster
        - name: size
          in: path
          required: true
          schema:
            type: string
            enum: [w185, w342, w500, w780, w300, w1280, w45, h632, original]
          description: Image size
          example: w500
        - name: path
          in: path
          required: true
          schema:
            type: string
          description: TMDb image path (e.g., /abc123.jpg)
          example: /f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg
      responses:
        '200':
          description: Image data
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # Search endpoints
  /api/v1/search/movies:
    get:
      summary: Search movies in library
      description: |
        Full-text search across the movie library using Typesense.
        Supports filtering by genres, year, status, and more.
        Returns faceted results for filtering.
      operationId: searchLibraryMovies
      tags:
        - search
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 1
            maxLength: 200
          description: Search query (searches title, overview, cast, directors)
          example: "Matrix"
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - name: per_page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Results per page
        - name: sort_by
          in: query
          required: false
          schema:
            type: string
            enum: [popularity:desc, popularity:asc, vote_average:desc, vote_average:asc, release_date:desc, release_date:asc, library_added_at:desc, library_added_at:asc, title:asc, title:desc]
            default: popularity:desc
          description: Sort field and direction
        - name: filter_by
          in: query
          required: false
          schema:
            type: string
          description: |
            Typesense filter syntax. Examples:
            - `genres:=Action`
            - `year:>=2020`
            - `has_file:=true && genres:=Action`
          example: "genres:=Action"
      responses:
        '200':
          description: Search results with facets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResults'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/search/movies/autocomplete:
    get:
      summary: Autocomplete movie titles
      description: |
        Provides search suggestions for movie titles.
        Useful for search-as-you-type interfaces.
      operationId: autocompleteMovies
      tags:
        - search
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 1
            maxLength: 100
          description: Partial search query
          example: "Matr"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 5
          description: Maximum suggestions to return
      responses:
        '200':
          description: Autocomplete suggestions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutocompleteResults'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/search/movies/facets:
    get:
      summary: Get search facets
      description: |
        Returns available facet values for filtering (genres, years, etc.).
        Use this to populate filter dropdowns in the UI.
      operationId: getSearchFacets
      tags:
        - search
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Available facet values
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchFacets'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/search/reindex:
    post:
      summary: Reindex all movies
      description: |
        Triggers a full reindex of all movies in the search engine.
        This is an admin-only operation and may take a while for large libraries.
      operationId: reindexSearch
      tags:
        - search
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '202':
          description: Reindex started
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Reindex job started"
                  job_id:
                    type: string
                    format: uuid
                    description: Job ID for tracking progress
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/search/tvshows/reindex:
    post:
      summary: Reindex all TV shows
      description: |
        Triggers a full reindex of all TV shows in the search engine.
        This is an admin-only operation and may take a while for large libraries.
      operationId: reindexTVShowSearch
      tags:
        - search
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '202':
          description: Reindex started
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "TV show reindex job started"
                  job_id:
                    type: string
                    format: uuid
                    description: Job ID for tracking progress
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/search/tvshows:
    get:
      summary: Search TV shows in library
      description: |
        Full-text search across the TV show library using Typesense.
        Supports filtering by genres, year, status, type, networks, and more.
        Returns faceted results for filtering.
      operationId: searchLibraryTVShows
      tags:
        - search
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 1
            maxLength: 200
          description: Search query (searches title, overview, cast, networks)
          example: "Breaking Bad"
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - name: per_page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Results per page
        - name: sort_by
          in: query
          required: false
          schema:
            type: string
            enum: [popularity:desc, popularity:asc, vote_average:desc, vote_average:asc, first_air_date:desc, first_air_date:asc, title:asc, title:desc]
            default: popularity:desc
          description: Sort field and direction
        - name: filter_by
          in: query
          required: false
          schema:
            type: string
          description: |
            Typesense filter syntax. Examples:
            - `genres:=Drama`
            - `year:>=2020`
            - `has_file:=true && status:=Returning Series`
          example: "genres:=Drama"
      responses:
        '200':
          description: Search results with facets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVShowSearchResults'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/search/tvshows/autocomplete:
    get:
      summary: Autocomplete TV show titles
      description: |
        Provides search suggestions for TV show titles.
        Useful for search-as-you-type interfaces.
      operationId: autocompleteTVShows
      tags:
        - search
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 1
            maxLength: 100
          description: Partial search query
          example: "Break"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 5
          description: Maximum suggestions to return
      responses:
        '200':
          description: Autocomplete suggestions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutocompleteResults'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/search/tvshows/facets:
    get:
      summary: Get TV show search facets
      description: |
        Returns available facet values for TV show filtering (genres, years, networks, etc.).
        Use this to populate filter dropdowns in the UI.
      operationId: getTVShowSearchFacets
      tags:
        - search
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Available facet values
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TVShowSearchFacets'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  # Settings endpoints
  /api/v1/settings/server:
    get:
      summary: List all server settings
      description: Retrieve all server-wide configuration settings
      operationId: listServerSettings
      tags:
        - settings
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of server settings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ServerSetting'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/settings/server/{key}:
    get:
      summary: Get a server setting
      description: Retrieve a specific server setting by key
      operationId: getServerSetting
      tags:
        - settings
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Setting key
          example: server.name
      responses:
        '200':
          description: Server setting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerSetting'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    put:
      summary: Update a server setting
      description: Update the value of a server setting
      operationId: updateServerSetting
      tags:
        - settings
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Setting key
          example: server.name
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SettingValue'
      responses:
        '200':
          description: Updated server setting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerSetting'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/settings/user:
    get:
      summary: List current user's settings
      description: Retrieve all settings for the authenticated user
      operationId: listUserSettings
      tags:
        - settings
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of user settings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserSetting'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/settings/user/{key}:
    get:
      summary: Get a user setting
      description: Retrieve a specific user setting by key
      operationId: getUserSetting
      tags:
        - settings
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Setting key
          example: theme
      responses:
        '200':
          description: User setting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSetting'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    put:
      summary: Update a user setting
      description: Update the value of a user setting
      operationId: updateUserSetting
      tags:
        - settings
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Setting key
          example: theme
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SettingValue'
      responses:
        '200':
          description: Updated user setting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSetting'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

    delete:
      summary: Delete a user setting
      description: Delete a user setting (revert to default)
      operationId: deleteUserSetting
      tags:
        - settings
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Setting key
          example: theme
      responses:
        '204':
          description: Setting deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # User endpoints
  /api/v1/users/me:
    get:
      summary: Get current user
      description: Get the currently authenticated user's profile
      operationId: getCurrentUser
      tags:
        - users
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

    put:
      summary: Update current user
      description: Update the authenticated user's profile
      operationId: updateCurrentUser
      tags:
        - users
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: Updated user profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/users/me/preferences:
    get:
      summary: Get user preferences
      description: Get notification and display preferences for the authenticated user
      operationId: getUserPreferences
      tags:
        - users
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: User preferences
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPreferences'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

    put:
      summary: Update user preferences
      description: Update notification and display preferences
      operationId: updateUserPreferences
      tags:
        - users
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserPreferencesUpdate'
      responses:
        '200':
          description: Updated preferences
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPreferences'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/users/me/avatar:
    post:
      summary: Upload avatar
      description: Upload a new avatar image
      operationId: uploadAvatar
      tags:
        - users
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Avatar image file (JPEG, PNG, GIF, WebP, max 5MB)
      responses:
        '200':
          description: Avatar uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Avatar'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/users/{userId}:
    get:
      summary: Get user by ID
      description: Get a user's public profile information
      operationId: getUserById
      tags:
        - users
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # Session management endpoints
  /api/v1/sessions:
    get:
      summary: List user sessions
      description: Get all active sessions for the authenticated user
      operationId: listSessions
      tags:
        - sessions
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of sessions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

    delete:
      summary: Logout all sessions
      description: Revoke all sessions for the authenticated user (logout everywhere)
      operationId: logoutAll
      tags:
        - sessions
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '204':
          description: All sessions revoked
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/sessions/current:
    get:
      summary: Get current session
      description: Get information about the current session
      operationId: getCurrentSession
      tags:
        - sessions
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Current session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    delete:
      summary: Logout current session
      description: Revoke the current session (logout)
      operationId: logoutCurrent
      tags:
        - sessions
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '204':
          description: Session revoked
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/sessions/refresh:
    post:
      summary: Refresh session
      description: Refresh access token using refresh token
      operationId: refreshSession
      tags:
        - sessions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshSessionRequest'
      responses:
        '200':
          description: New access token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshSessionResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/sessions/{sessionId}:
    delete:
      summary: Revoke session
      description: Revoke a specific session by ID
      operationId: revokeSession
      tags:
        - sessions
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Session ID
      responses:
        '204':
          description: Session revoked
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # RBAC endpoints
  /api/v1/rbac/policies:
    get:
      summary: List policies
      description: Get all authorization policies (admin only)
      operationId: listPolicies
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of policies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

    post:
      summary: Add policy
      description: Add a new authorization policy (admin only)
      operationId: addPolicy
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyRequest'
      responses:
        '201':
          description: Policy created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

    delete:
      summary: Remove policy
      description: Remove an authorization policy (admin only)
      operationId: removePolicy
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyRequest'
      responses:
        '204':
          description: Policy removed
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/rbac/users/{userId}/roles:
    get:
      summary: Get user roles
      description: Get all roles assigned to a user
      operationId: getUserRoles
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      responses:
        '200':
          description: List of roles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

    post:
      summary: Assign role
      description: Assign a role to a user (admin only)
      operationId: assignRole
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignRoleRequest'
      responses:
        '201':
          description: Role assigned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/rbac/users/{userId}/roles/{role}:
    delete:
      summary: Remove role
      description: Remove a role from a user (admin only)
      operationId: removeRole
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
        - name: role
          in: path
          required: true
          schema:
            type: string
          description: Role name
      responses:
        '204':
          description: Role removed
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # Role Management endpoints
  /api/v1/rbac/roles:
    get:
      summary: List all roles
      description: Get all available roles with their permissions (admin only)
      operationId: listRoles
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of roles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RolesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

    post:
      summary: Create role
      description: Create a new custom role (admin only)
      operationId: createRole
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRoleRequest'
      responses:
        '201':
          description: Role created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Role already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/rbac/roles/{roleName}:
    get:
      summary: Get role details
      description: Get a specific role with its permissions (admin only)
      operationId: getRole
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: roleName
          in: path
          required: true
          schema:
            type: string
          description: Role name
      responses:
        '200':
          description: Role details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleDetail'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    delete:
      summary: Delete role
      description: Delete a custom role (admin only, cannot delete built-in roles)
      operationId: deleteRole
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: roleName
          in: path
          required: true
          schema:
            type: string
          description: Role name
      responses:
        '204':
          description: Role deleted
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/rbac/roles/{roleName}/permissions:
    put:
      summary: Update role permissions
      description: Update all permissions for a role (admin only)
      operationId: updateRolePermissions
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: roleName
          in: path
          required: true
          schema:
            type: string
          description: Role name
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePermissionsRequest'
      responses:
        '200':
          description: Permissions updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/rbac/permissions:
    get:
      summary: List available permissions
      description: Get all available resource:action permission combinations (admin only)
      operationId: listPermissions
      tags:
        - rbac
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of available permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'


  # API Keys endpoints
  /api/v1/apikeys:
    get:
      summary: List API keys
      description: Get all API keys for the authenticated user
      operationId: listAPIKeys
      tags:
        - apikeys
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of API keys
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIKeyListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

    post:
      summary: Create API key
      description: Generate a new API key for the authenticated user
      operationId: createAPIKey
      tags:
        - apikeys
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAPIKeyRequest'
      responses:
        '201':
          description: API key created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAPIKeyResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/apikeys/{keyId}:
    get:
      summary: Get API key
      description: Get details of a specific API key
      operationId: getAPIKey
      tags:
        - apikeys
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: keyId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: API Key ID
      responses:
        '200':
          description: API key details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIKeyInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    delete:
      summary: Revoke API key
      description: Revoke (deactivate) an API key
      operationId: revokeAPIKey
      tags:
        - apikeys
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: keyId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: API Key ID
      responses:
        '204':
          description: API key revoked
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'
  # ==========================================================================
  # OIDC Endpoints
  # ==========================================================================

  /api/v1/oidc/providers:
    get:
      operationId: listOIDCProviders
      summary: List enabled OIDC providers
      description: Returns a list of enabled OIDC providers for login
      tags:
        - OIDC
      responses:
        '200':
          description: List of enabled OIDC providers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OIDCProviderListResponse'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/oidc/auth/{provider}:
    get:
      operationId: oidcAuthorize
      summary: Initiate OIDC login
      description: Redirects to the OIDC provider's authorization endpoint
      tags:
        - OIDC
      parameters:
        - name: provider
          in: path
          required: true
          description: Provider name (e.g., authentik, keycloak)
          schema:
            type: string
        - name: redirect_url
          in: query
          required: false
          description: URL to redirect after successful auth
          schema:
            type: string
      responses:
        '200':
          description: OIDC auth URL for client-side redirect
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OIDCAuthURLResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/oidc/callback/{provider}:
    get:
      operationId: oidcCallback
      summary: Handle OIDC callback
      description: Handles the OAuth2 callback from OIDC provider
      tags:
        - OIDC
      parameters:
        - name: provider
          in: path
          required: true
          description: Provider name
          schema:
            type: string
        - name: code
          in: query
          required: true
          description: Authorization code from provider
          schema:
            type: string
        - name: state
          in: query
          required: true
          description: OAuth2 state parameter
          schema:
            type: string
        - name: error
          in: query
          required: false
          description: Error code if authorization failed
          schema:
            type: string
        - name: error_description
          in: query
          required: false
          description: Error description if authorization failed
          schema:
            type: string
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OIDCCallbackResponse'
        '302':
          description: Redirect to app with tokens
        '400':
          $ref: '#/components/responses/BadRequest'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/users/me/oidc:
    get:
      operationId: listUserOIDCLinks
      summary: List user's OIDC links
      description: Returns all OIDC providers linked to the current user
      tags:
        - OIDC
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of OIDC links
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OIDCUserLinkListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/users/me/oidc/{provider}/link:
    post:
      operationId: initOIDCLink
      summary: Start linking OIDC provider
      description: Initiates the flow to link an OIDC provider to the user's account
      tags:
        - OIDC
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          description: Provider name to link
          schema:
            type: string
      responses:
        '200':
          description: Link initiation successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OIDCAuthURLResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/users/me/oidc/{provider}:
    delete:
      operationId: unlinkOIDCProvider
      summary: Unlink OIDC provider
      description: Removes the link between user and OIDC provider
      tags:
        - OIDC
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          description: Provider name to unlink
          schema:
            type: string
      responses:
        '204':
          description: Successfully unlinked
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # Admin User Management endpoints
  /api/v1/admin/users:
    get:
      operationId: adminListUsers
      summary: List and search users (admin)
      description: List all users with optional text search and filters. Searches across username, email, and display name.
      tags:
        - Users Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: query
          in: query
          description: Text search across username, email, and display name
          schema:
            type: string
            maxLength: 200
        - name: is_active
          in: query
          description: Filter by active status
          schema:
            type: boolean
        - name: is_admin
          in: query
          description: Filter by admin status
          schema:
            type: boolean
        - name: limit
          in: query
          description: Maximum number of results (default 50, max 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          description: Number of results to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Users retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminUserListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/users/{userId}:
    delete:
      operationId: adminDeleteUser
      summary: Delete a user (admin)
      description: Soft-deletes a user account. The user will no longer be able to log in.
      tags:
        - Users Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: User ID to delete
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: User deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # Admin OIDC endpoints
  /api/v1/admin/oidc/providers:
    get:
      operationId: adminListOIDCProviders
      summary: List all OIDC providers (admin)
      description: Returns all OIDC providers including disabled ones
      tags:
        - OIDC Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of all OIDC providers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminOIDCProviderListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

    post:
      operationId: adminCreateOIDCProvider
      summary: Create OIDC provider (admin)
      description: Creates a new OIDC provider configuration
      tags:
        - OIDC Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOIDCProviderRequest'
      responses:
        '201':
          description: Provider created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminOIDCProvider'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Provider name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/oidc/providers/{providerId}:
    get:
      operationId: adminGetOIDCProvider
      summary: Get OIDC provider (admin)
      description: Returns detailed OIDC provider configuration
      tags:
        - OIDC Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          description: Provider ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Provider details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminOIDCProvider'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    patch:
      operationId: adminUpdateOIDCProvider
      summary: Update OIDC provider (admin)
      description: Updates an OIDC provider configuration
      tags:
        - OIDC Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          description: Provider ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOIDCProviderRequest'
      responses:
        '200':
          description: Provider updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminOIDCProvider'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    delete:
      operationId: adminDeleteOIDCProvider
      summary: Delete OIDC provider (admin)
      description: Deletes an OIDC provider configuration
      tags:
        - OIDC Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          description: Provider ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Provider deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/oidc/providers/{providerId}/enable:
    post:
      operationId: adminEnableOIDCProvider
      summary: Enable OIDC provider (admin)
      description: Enables an OIDC provider
      tags:
        - OIDC Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          description: Provider ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Provider enabled
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/oidc/providers/{providerId}/disable:
    post:
      operationId: adminDisableOIDCProvider
      summary: Disable OIDC provider (admin)
      description: Disables an OIDC provider
      tags:
        - OIDC Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          description: Provider ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Provider disabled
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/oidc/providers/{providerId}/default:
    post:
      operationId: adminSetDefaultOIDCProvider
      summary: Set default OIDC provider (admin)
      description: Sets an OIDC provider as the default for SSO
      tags:
        - OIDC Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          description: Provider ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Provider set as default
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # ============================================================================
  # Activity Endpoints (Admin only)
  # ============================================================================

  /api/v1/admin/activity:
    get:
      operationId: searchActivityLogs
      summary: Search activity logs (admin)
      description: Search and filter activity logs with pagination
      tags:
        - Activity
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: user_id
          in: query
          description: Filter by user ID
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          description: Filter by action type
          schema:
            type: string
        - name: resource_type
          in: query
          description: Filter by resource type
          schema:
            type: string
        - name: resource_id
          in: query
          description: Filter by resource ID
          schema:
            type: string
            format: uuid
        - name: success
          in: query
          description: Filter by success status
          schema:
            type: boolean
        - name: start_time
          in: query
          description: Filter by start time (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: end_time
          in: query
          description: Filter by end time (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          description: Maximum number of results (default 50, max 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          description: Number of results to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Activity logs retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityLogListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/activity/users/{userId}:
    get:
      operationId: getUserActivityLogs
      summary: Get user activity logs (admin)
      description: Get activity logs for a specific user
      tags:
        - Activity
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: User ID
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          description: Maximum number of results (default 50, max 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          description: Number of results to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: User activity logs retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityLogListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/activity/resources/{resourceType}/{resourceId}:
    get:
      operationId: getResourceActivityLogs
      summary: Get resource activity logs (admin)
      description: Get activity logs for a specific resource
      tags:
        - Activity
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: resourceType
          in: path
          required: true
          description: Resource type (user, library, movie, etc.)
          schema:
            type: string
        - name: resourceId
          in: path
          required: true
          description: Resource ID
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          description: Maximum number of results (default 50, max 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          description: Number of results to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Resource activity logs retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityLogListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/activity/stats:
    get:
      operationId: getActivityStats
      summary: Get activity statistics (admin)
      description: Get activity log statistics
      tags:
        - Activity
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Activity statistics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/activity/actions:
    get:
      operationId: getRecentActions
      summary: Get recent action types (admin)
      description: Get recent distinct action types for filtering
      tags:
        - Activity
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          description: Maximum number of results (default 20, max 50)
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
      responses:
        '200':
          description: Recent actions retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionCountListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/Error'

  # ============================================================================
  # Genre Endpoints
  # ============================================================================

  /api/v1/genres:
    get:
      summary: List all genres
      description: >
        Returns all distinct genres across movies and TV shows with per-content-type item counts.
        Useful for building genre filter UIs. Genres are identified by their TMDb ID and name.
      operationId: listGenres
      tags:
        - Libraries
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: All genres
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Genre'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

  # ============================================================================
  # Library Endpoints
  # ============================================================================

  /api/v1/libraries:
    get:
      tags:
        - Libraries
      operationId: listLibraries
      summary: List accessible libraries
      description: List all libraries the authenticated user can access. Admins see all libraries.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of libraries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LibraryListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        default:
          $ref: '#/components/responses/Error'

    post:
      tags:
        - Libraries
      operationId: createLibrary
      summary: Create a new library (admin)
      description: Create a new media library. Admin only.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLibraryRequest'
      responses:
        '201':
          description: Library created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Library'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Library with this name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/libraries/{libraryId}:
    get:
      tags:
        - Libraries
      operationId: getLibrary
      summary: Get library details
      description: Get detailed information about a library.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Library ID
      responses:
        '200':
          description: Library details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Library'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    put:
      tags:
        - Libraries
      operationId: updateLibrary
      summary: Update a library (admin)
      description: Update library settings. Admin only.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Library ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateLibraryRequest'
      responses:
        '200':
          description: Library updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Library'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Library with this name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

    delete:
      tags:
        - Libraries
      operationId: deleteLibrary
      summary: Delete a library (admin)
      description: Delete a library and all its content. Admin only.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Library ID
      responses:
        '204':
          description: Library deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/libraries/{libraryId}/scan:
    post:
      tags:
        - Libraries
      operationId: triggerLibraryScan
      summary: Trigger library scan (admin)
      description: Start a library scan job. Admin only.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Library ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - scanType
              properties:
                scanType:
                  type: string
                  enum: [full, incremental, metadata]
                  description: Type of scan to perform
      responses:
        '202':
          description: Scan started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LibraryScan'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Scan already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/libraries/{libraryId}/scans:
    get:
      tags:
        - Libraries
      operationId: listLibraryScans
      summary: List library scans
      description: List scan history for a library.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Library ID
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
          description: Maximum number of results
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
          description: Number of results to skip
      responses:
        '200':
          description: List of scans
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LibraryScanListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/libraries/{libraryId}/permissions:
    get:
      tags:
        - Libraries
      operationId: listLibraryPermissions
      summary: List library permissions (admin)
      description: List all user permissions for a library. Admin only.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Library ID
      responses:
        '200':
          description: List of permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LibraryPermissionListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    post:
      tags:
        - Libraries
      operationId: grantLibraryPermission
      summary: Grant library permission (admin)
      description: Grant a user permission to access a library. Admin only.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Library ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - permission
              properties:
                userId:
                  type: string
                  format: uuid
                  description: User ID to grant permission to
                permission:
                  type: string
                  enum: [view, download, manage]
                  description: Permission type
      responses:
        '201':
          description: Permission granted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LibraryPermission'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/libraries/{libraryId}/permissions/{userId}:
    delete:
      tags:
        - Libraries
      operationId: revokeLibraryPermission
      summary: Revoke library permission (admin)
      description: Revoke a user's permission for a library. Admin only.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Library ID
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
        - name: permission
          in: query
          required: true
          schema:
            type: string
            enum: [view, download, manage]
          description: Permission to revoke
      responses:
        '204':
          description: Permission revoked
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  # Radarr Integration Admin Endpoints
  /api/v1/admin/integrations/radarr/status:
    get:
      operationId: adminGetRadarrStatus
      summary: Get Radarr integration status (admin)
      description: |
        Returns the current Radarr integration status including connection health,
        sync status, and last sync information. Admin only.
      tags:
        - Integrations Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Radarr status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RadarrStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '503':
          description: Radarr integration not configured or unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/integrations/radarr/sync:
    post:
      operationId: adminTriggerRadarrSync
      summary: Trigger Radarr library sync (admin)
      description: |
        Triggers a full library sync from Radarr to Revenge.
        This is an asynchronous operation - check status endpoint for progress.
        Admin only.
      tags:
        - Integrations Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '202':
          description: Sync started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RadarrSyncResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Sync already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: Radarr integration not configured or unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/integrations/radarr/quality-profiles:
    get:
      operationId: adminGetRadarrQualityProfiles
      summary: Get Radarr quality profiles (admin)
      description: |
        Returns all quality profiles configured in Radarr.
        Useful for mapping quality profiles during sync configuration.
        Admin only.
      tags:
        - Integrations Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of quality profiles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RadarrQualityProfileList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '503':
          description: Radarr integration not configured or unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/integrations/radarr/root-folders:
    get:
      operationId: adminGetRadarrRootFolders
      summary: Get Radarr root folders (admin)
      description: |
        Returns all root folders configured in Radarr.
        These are the library paths that Radarr monitors for movies.
        Admin only.
      tags:
        - Integrations Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: List of root folders
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RadarrRootFolderList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '503':
          description: Radarr integration not configured or unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/webhooks/radarr:
    post:
      operationId: handleRadarrWebhook
      summary: Handle Radarr webhook
      description: |
        Endpoint for receiving webhook notifications from Radarr.
        Supports events: Grab, Download, Rename, MovieDelete, MovieFileDelete, Health.
        Configure this URL in Radarr Settings > Connect > Webhook.
        Authenticate with the X-Webhook-Secret header matching integrations.radarr.webhook_secret.
      tags:
        - Webhooks
      security:
        - webhookAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RadarrWebhookPayload'
      responses:
        '202':
          description: Webhook accepted for processing
        '400':
          $ref: '#/components/responses/BadRequest'
        default:
          $ref: '#/components/responses/Error'

  # Sonarr Integration Admin Endpoints
  /api/v1/admin/integrations/sonarr/status:
    get:
      operationId: adminGetSonarrStatus
      summary: Get Sonarr integration status (admin)
      description: |
        Returns the current Sonarr integration status including connection health,
        sync status, and last sync information. Admin only.
      tags:
        - Integrations Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Sonarr status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SonarrStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '503':
          description: Sonarr integration not configured or unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/integrations/sonarr/sync:
    post:
      operationId: adminTriggerSonarrSync
      summary: Trigger Sonarr library sync (admin)
      description: |
        Triggers a full library sync from Sonarr to Revenge.
        This is an asynchronous operation - check status endpoint for progress.
        Admin only.
      tags:
        - Integrations Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '202':
          description: Sync started or queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SonarrSyncResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Sync already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: Sonarr integration not configured or unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/integrations/sonarr/quality-profiles:
    get:
      operationId: adminGetSonarrQualityProfiles
      summary: Get Sonarr quality profiles (admin)
      description: |
        Returns all quality profiles configured in Sonarr.
        Useful for mapping quality profiles during sync configuration.
        Admin only.
      tags:
        - Integrations Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Quality profiles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SonarrQualityProfileList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '503':
          description: Sonarr integration not configured or unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/admin/integrations/sonarr/root-folders:
    get:
      operationId: adminGetSonarrRootFolders
      summary: Get Sonarr root folders (admin)
      description: |
        Returns all root folders configured in Sonarr.
        These are the library paths that Sonarr monitors for TV shows.
        Admin only.
      tags:
        - Integrations Admin
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        '200':
          description: Root folders
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SonarrRootFolderList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '503':
          description: Sonarr integration not configured or unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/webhooks/sonarr:
    post:
      operationId: handleSonarrWebhook
      summary: Handle Sonarr webhook
      description: |
        Endpoint for receiving webhook notifications from Sonarr.
        Supports events: Grab, Download, Rename, SeriesDelete, EpisodeFileDelete, Health.
        Configure this URL in Sonarr Settings > Connect > Webhook.
        Authenticate with the X-Webhook-Secret header matching integrations.sonarr.webhook_secret.
      tags:
        - Webhooks
      security:
        - webhookAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SonarrWebhookPayload'
      responses:
        '202':
          description: Webhook accepted for processing
        '400':
          $ref: '#/components/responses/BadRequest'
        default:
          $ref: '#/components/responses/Error'

  # ============================================================================
  # Playback / HLS Streaming
  # ============================================================================

  /api/v1/playback/sessions:
    post:
      operationId: startPlaybackSession
      summary: Start a playback session
      description: |
        Creates a new HLS playback session for a movie or episode.
        Returns a master playlist URL and session metadata.
        Video and audio are segmented separately  audio tracks are individual
        HLS renditions so the player can switch tracks instantly without
        restarting the stream.
      tags:
        - playback
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartPlaybackRequest'
      responses:
        '201':
          description: Playback session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaybackSession'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

  /api/v1/playback/sessions/{sessionId}:
    get:
      operationId: getPlaybackSession
      summary: Get playback session info
      description: Returns metadata for an active playback session.
      tags:
        - playback
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Playback session info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaybackSession'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

    delete:
      operationId: stopPlaybackSession
      summary: Stop a playback session
      description: |
        Stops the playback session, terminates FFmpeg processes,
        and cleans up segment files.
      tags:
        - playback
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Session stopped
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        default:
          $ref: '#/components/responses/Error'

components:
  schemas:
    # Auth schemas
    RegisterRequest:
      type: object
      required:
        - username
        - email
        - password
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 30
          pattern: '^[a-zA-Z0-9_-]+$'
          description: Username (alphanumeric, dash, underscore)
          example: johndoe
        email:
          type: string
          format: email
          description: Email address
          example: john@example.com
        password:
          type: string
          minLength: 8
          description: Password (minimum 8 characters)
          example: SecurePass123!
        display_name:
          type: string
          maxLength: 100
          description: Display name (optional)
          example: John Doe

    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: Username or email
          example: johndoe
        password:
          type: string
          description: Password
          example: SecurePass123!
        device_name:
          type: string
          maxLength: 100
          description: Device name for tracking (optional)
          example: Chrome on Linux

    LoginResponse:
      type: object
      required:
        - user
        - access_token
        - refresh_token
        - expires_in
      properties:
        user:
          $ref: '#/components/schemas/User'
        access_token:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refresh_token:
          type: string
          description: Refresh token for obtaining new access tokens
          example: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6...
        expires_in:
          type: integer
          description: Access token expiry time in seconds
          example: 86400

    LogoutRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          description: Refresh token to invalidate
        logout_all:
          type: boolean
          description: Logout from all devices (default false)
          example: false

    RefreshRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          description: Refresh token

    RefreshResponse:
      type: object
      required:
        - access_token
        - expires_in
      properties:
        access_token:
          type: string
          description: New JWT access token
        expires_in:
          type: integer
          description: Access token expiry time in seconds
          example: 86400

    VerifyEmailRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          description: Email verification token from email

    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          description: Email address to send password reset token
          example: john@example.com

    ResetPasswordRequest:
      type: object
      required:
        - token
        - new_password
      properties:
        token:
          type: string
          description: Password reset token from email
        new_password:
          type: string
          minLength: 8
          description: New password (minimum 8 characters)

    ChangePasswordRequest:
      type: object
      required:
        - old_password
        - new_password
      properties:
        old_password:
          type: string
          description: Current password
        new_password:
          type: string
          minLength: 8
          description: New password (minimum 8 characters)

    # MFA schemas
    MFAStatus:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          description: User ID
        has_totp:
          type: boolean
          description: Whether TOTP is configured
          example: true
        webauthn_count:
          type: integer
          description: Number of WebAuthn credentials registered
          example: 2
        unused_backup_codes:
          type: integer
          description: Number of unused backup codes
          example: 8
        require_mfa:
          type: boolean
          description: Whether MFA is required for login
          example: true

    TOTPSetup:
      type: object
      properties:
        secret:
          type: string
          description: Base32-encoded TOTP secret (for manual entry)
          example: "JBSWY3DPEHPK3PXP"
        qr_code:
          type: string
          format: byte
          description: Base64-encoded PNG QR code
        url:
          type: string
          format: uri
          description: otpauth:// URL for the QR code
          example: "otpauth://totp/Revenge:user@example.com?secret=JBSWY3DPEHPK3PXP&issuer=Revenge"

    # WebAuthn schemas
    WebAuthnBeginRegistrationResponse:
      type: object
      description: WebAuthn registration options (PublicKeyCredentialCreationOptions wrapper)
      properties:
        options:
          type: object
          description: PublicKeyCredentialCreationOptions JSON from the WebAuthn library
          additionalProperties: {}
        credential_name:
          type: string
          description: The credential name to associate upon completion

    WebAuthnFinishRegistrationRequest:
      type: object
      description: WebAuthn registration response from the authenticator
      required:
        - credential
      properties:
        credential:
          type: object
          description: The PublicKeyCredential response from navigator.credentials.create()
          additionalProperties: {}
        credential_name:
          type: string
          description: User-facing name for the credential
          example: "My YubiKey"

    WebAuthnBeginLoginResponse:
      type: object
      description: WebAuthn login options (PublicKeyCredentialRequestOptions wrapper)
      properties:
        options:
          type: object
          description: PublicKeyCredentialRequestOptions JSON from the WebAuthn library
          additionalProperties: {}

    WebAuthnFinishLoginRequest:
      type: object
      description: WebAuthn login assertion from the authenticator
      required:
        - credential
      properties:
        credential:
          type: object
          description: The PublicKeyCredential response from navigator.credentials.get()
          additionalProperties: {}

    WebAuthnCredentialInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Internal credential ID
        name:
          type: string
          description: User-facing credential name
          example: "My YubiKey"
        created_at:
          type: string
          format: date-time
          description: When the credential was registered
        last_used_at:
          type: string
          format: date-time
          description: When the credential was last used
        backup_eligible:
          type: boolean
          description: Whether the credential supports backup
        backup_state:
          type: boolean
          description: Whether the credential is currently backed up
        clone_detected:
          type: boolean
          description: Whether a clone has been detected for this credential

    WebAuthnCredentialsList:
      type: object
      properties:
        credentials:
          type: array
          items:
            $ref: '#/components/schemas/WebAuthnCredentialInfo'
        count:
          type: integer
          description: Total number of credentials

    # Movie schemas
    MovieListResponse:
      type: object
      required:
        - items
        - total
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Movie'
        total:
          type: integer
          format: int64
          description: Total number of movies matching the filters
        page:
          type: integer
          description: Current page number (1-indexed)
        pageSize:
          type: integer
          description: Number of items per page

    MovieCreditListResponse:
      type: object
      required:
        - items
        - total
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/MovieCredit'
        total:
          type: integer
          format: int64
          description: Total number of credits
        page:
          type: integer
          description: Current page number (1-indexed)
        pageSize:
          type: integer
          description: Number of items per page

    Movie:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Movie ID
        tmdb_id:
          type: integer
          nullable: true
          description: TMDb ID
        imdb_id:
          type: string
          nullable: true
          description: IMDb ID (tt1234567 format)
        title:
          type: string
          description: Movie title
        original_title:
          type: string
          nullable: true
          description: Original title (if different)
        year:
          type: integer
          nullable: true
          description: Release year
        release_date:
          type: string
          format: date
          nullable: true
          description: Release date
        runtime:
          type: integer
          nullable: true
          description: Runtime in minutes
        overview:
          type: string
          nullable: true
          description: Plot synopsis
        tagline:
          type: string
          nullable: true
          description: Movie tagline
        status:
          type: string
          nullable: true
          description: Release status (released, post-production, etc.)
        original_language:
          type: string
          nullable: true
          description: ISO 639-1 language code
        poster_path:
          type: string
          nullable: true
          description: Poster image path
        backdrop_path:
          type: string
          nullable: true
          description: Backdrop image path
        trailer_url:
          type: string
          nullable: true
          description: Trailer URL
        vote_average:
          type: number
          format: float
          nullable: true
          description: Average rating (0-10)
        vote_count:
          type: integer
          nullable: true
          description: Number of votes
        popularity:
          type: number
          format: float
          nullable: true
          description: Popularity score
        budget:
          type: integer
          format: int64
          nullable: true
          description: Production budget
        revenue:
          type: integer
          format: int64
          nullable: true
          description: Box office revenue
        library_added_at:
          type: string
          format: date-time
          description: When added to library
        metadata_updated_at:
          type: string
          format: date-time
          nullable: true
          description: Last metadata update
        radarr_id:
          type: integer
          nullable: true
          description: Radarr movie ID
        external_ratings:
          type: array
          items:
            $ref: '#/components/schemas/ExternalRating'
          description: Ratings from external providers (IMDb, Rotten Tomatoes, Metacritic, etc.)
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MovieFile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        movie_id:
          type: string
          format: uuid
        file_path:
          type: string
          description: Full file path
        file_size:
          type: integer
          format: int64
          description: File size in bytes
        file_name:
          type: string
          description: File name
        resolution:
          type: string
          nullable: true
          description: Video resolution (1080p, 2160p, etc.)
        quality_profile:
          type: string
          nullable: true
          description: Quality profile from Radarr
        video_codec:
          type: string
          nullable: true
          description: Video codec (h264, h265, av1)
        audio_codec:
          type: string
          nullable: true
          description: Audio codec (aac, ac3, dts)
        container:
          type: string
          nullable: true
          description: Container format (mkv, mp4, avi)
        duration_seconds:
          type: integer
          nullable: true
          description: Duration in seconds
        bitrate_kbps:
          type: integer
          nullable: true
          description: Bitrate in kbps
        framerate:
          type: number
          format: float
          nullable: true
          description: Frames per second
        dynamic_range:
          type: string
          nullable: true
          description: HDR type (SDR, HDR10, Dolby Vision)
        color_space:
          type: string
          nullable: true
          description: Color space (BT.709, BT.2020)
        audio_channels:
          type: string
          nullable: true
          description: Audio channels (2.0, 5.1, 7.1)
        audio_languages:
          type: array
          items:
            type: string
          description: Audio language codes
        subtitle_languages:
          type: array
          items:
            type: string
          description: Subtitle language codes
        radarr_file_id:
          type: integer
          nullable: true
        last_scanned_at:
          type: string
          format: date-time
          nullable: true
        is_monitored:
          type: boolean
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MovieCredit:
      type: object
      properties:
        id:
          type: string
          format: uuid
        movie_id:
          type: string
          format: uuid
        tmdb_person_id:
          type: integer
          description: TMDb person ID
        name:
          type: string
          description: Person name
        credit_type:
          type: string
          enum: [cast, crew]
          description: Credit type
        character:
          type: string
          nullable: true
          description: Character name (for cast)
        job:
          type: string
          nullable: true
          description: Job title (for crew)
        department:
          type: string
          nullable: true
          description: Department (for crew)
        cast_order:
          type: integer
          nullable: true
          description: Billing order (for cast)
        profile_path:
          type: string
          nullable: true
          description: Profile image path
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MovieCollection:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tmdb_collection_id:
          type: integer
          nullable: true
          description: TMDb collection ID
        name:
          type: string
          description: Collection name
        overview:
          type: string
          nullable: true
          description: Collection overview
        poster_path:
          type: string
          nullable: true
          description: Poster image path
        backdrop_path:
          type: string
          nullable: true
          description: Backdrop image path
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Genre:
      type: object
      description: A distinct genre with per-content-type item counts.
      required:
        - tmdb_genre_id
        - name
        - movie_count
        - tvshow_count
      properties:
        tmdb_genre_id:
          type: integer
          description: TMDb genre ID
          example: 28
        name:
          type: string
          description: Genre name
          example: "Action"
        movie_count:
          type: integer
          format: int64
          description: Number of movies with this genre
        tvshow_count:
          type: integer
          format: int64
          description: Number of TV shows with this genre

    MovieGenre:
      type: object
      properties:
        id:
          type: string
          format: uuid
        movie_id:
          type: string
          format: uuid
        tmdb_genre_id:
          type: integer
          description: TMDb genre ID
        name:
          type: string
          description: Genre name
        created_at:
          type: string
          format: date-time

    # TV Show schemas
    TVShowListResponse:
      type: object
      required:
        - items
        - total
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TVSeries'
        total:
          type: integer
          format: int64

    MetadataCredits:
      type: object
      properties:
        cast:
          type: array
          items:
            $ref: '#/components/schemas/MetadataCastMember'
        crew:
          type: array
          items:
            $ref: '#/components/schemas/MetadataCrewMember'

    MetadataImages:
      type: object
      properties:
        posters:
          type: array
          items:
            $ref: '#/components/schemas/MetadataImage'
        backdrops:
          type: array
          items:
            $ref: '#/components/schemas/MetadataImage'
        logos:
          type: array
          items:
            $ref: '#/components/schemas/MetadataImage'
        stills:
          type: array
          items:
            $ref: '#/components/schemas/MetadataImage'
        profiles:
          type: array
          items:
            $ref: '#/components/schemas/MetadataImage'

    MetadataImage:
      type: object
      properties:
        file_path:
          type: string
          description: Image path for use with the image proxy
        aspect_ratio:
          type: number
          format: double
        width:
          type: integer
        height:
          type: integer
        vote_average:
          type: number
          format: float
        vote_count:
          type: integer
        language:
          type: string
          nullable: true
          description: ISO 639-1 language code

    MetadataExternalIDs:
      type: object
      properties:
        imdb_id:
          type: string
          nullable: true
        tvdb_id:
          type: integer
          nullable: true
        tmdb_id:
          type: integer
          nullable: true
        wikidata_id:
          type: string
          nullable: true
        facebook_id:
          type: string
          nullable: true
        instagram_id:
          type: string
          nullable: true
        twitter_id:
          type: string
          nullable: true
        tiktok_id:
          type: string
          nullable: true
        youtube_id:
          type: string
          nullable: true

    MetadataContentRatings:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/MetadataContentRating'

    MetadataContentRating:
      type: object
      properties:
        country_code:
          type: string
          description: ISO 3166-1 alpha-2 country code
          example: US
        rating:
          type: string
          description: Content rating
          example: TV-MA
        descriptors:
          type: array
          items:
            type: string

    MetadataPersonSearchResults:
      type: object
      properties:
        page:
          type: integer
        total_results:
          type: integer
        total_pages:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/MetadataPersonSearchResult'

    MetadataPersonSearchResult:
      type: object
      properties:
        tmdb_id:
          type: integer
        name:
          type: string
        profile_path:
          type: string
          nullable: true
        popularity:
          type: number
          format: float
        known_for_department:
          type: string
          description: Primary known-for department (Acting, Directing, etc.)
        known_for:
          type: array
          items:
            $ref: '#/components/schemas/MetadataMediaReference'

    MetadataMediaReference:
      type: object
      properties:
        media_type:
          type: string
          enum: [movie, tv]
        tmdb_id:
          type: integer
        title:
          type: string
        poster_path:
          type: string
          nullable: true

    MetadataPerson:
      type: object
      properties:
        tmdb_id:
          type: integer
        imdb_id:
          type: string
          nullable: true
        name:
          type: string
        also_known_as:
          type: array
          items:
            type: string
        biography:
          type: string
          nullable: true
        birthday:
          type: string
          format: date
          nullable: true
        deathday:
          type: string
          format: date
          nullable: true
        gender:
          type: integer
          description: "0=not specified, 1=female, 2=male, 3=non-binary"
        place_of_birth:
          type: string
          nullable: true
        profile_path:
          type: string
          nullable: true
        homepage:
          type: string
          nullable: true
        popularity:
          type: number
          format: float
        known_for_department:
          type: string

    MetadataPersonCredits:
      type: object
      properties:
        tmdb_id:
          type: integer
        cast:
          type: array
          items:
            $ref: '#/components/schemas/MetadataMediaCredit'
        crew:
          type: array
          items:
            $ref: '#/components/schemas/MetadataMediaCredit'

    MetadataMediaCredit:
      type: object
      properties:
        media_type:
          type: string
          enum: [movie, tv]
        tmdb_id:
          type: integer
        title:
          type: string
        character:
          type: string
          nullable: true
        job:
          type: string
          nullable: true
        department:
          type: string
          nullable: true
        release_date:
          type: string
          format: date
          nullable: true
        poster_path:
          type: string
          nullable: true
        vote_average:
          type: number
          format: float
        episode_count:
          type: integer
          nullable: true

    MetadataProviderList:
      type: object
      properties:
        providers:
          type: array
          items:
            $ref: '#/components/schemas/MetadataProvider'

    MetadataProvider:
      type: object
      properties:
        id:
          type: string
          description: Provider identifier
          example: tmdb
        name:
          type: string
          description: Provider display name
          example: The Movie Database
        capabilities:
          type: array
          items:
            type: string
          description: List of capabilities (movie, tvshow, person, image, collection)

    TVSeriesListResponse:
      type: object
      required:
        - items
        - total
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TVSeries'
        total:
          type: integer
          format: int64
          description: Total number of TV series matching the filters
        page:
          type: integer
          description: Current page number (1-indexed)
        pageSize:
          type: integer
          description: Number of items per page

    TVSeriesCreditListResponse:
      type: object
      required:
        - items
        - total
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TVSeriesCredit'
        total:
          type: integer
          format: int64
          description: Total number of credits
        page:
          type: integer
          description: Current page number (1-indexed)
        pageSize:
          type: integer
          description: Number of items per page

    TVSeries:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Series ID
        tmdb_id:
          type: integer
          nullable: true
          description: TMDb ID
        tvdb_id:
          type: integer
          nullable: true
          description: TVDb ID
        imdb_id:
          type: string
          nullable: true
          description: IMDb ID
        sonarr_id:
          type: integer
          nullable: true
          description: Sonarr series ID
        title:
          type: string
          description: Series title
        original_title:
          type: string
          nullable: true
          description: Original title (if different)
        original_language:
          type: string
          nullable: true
          description: ISO 639-1 language code
        tagline:
          type: string
          nullable: true
          description: Series tagline
        overview:
          type: string
          nullable: true
          description: Plot synopsis
        status:
          type: string
          nullable: true
          description: Series status (Returning Series, Ended, etc.)
        type:
          type: string
          nullable: true
          description: Series type (Scripted, Reality, Documentary, etc.)
        first_air_date:
          type: string
          format: date
          nullable: true
          description: First air date
        last_air_date:
          type: string
          format: date
          nullable: true
          description: Last air date
        vote_average:
          type: number
          format: float
          nullable: true
          description: Average rating (0-10)
        vote_count:
          type: integer
          nullable: true
          description: Number of votes
        popularity:
          type: number
          format: float
          nullable: true
          description: Popularity score
        poster_path:
          type: string
          nullable: true
          description: Poster image path
        backdrop_path:
          type: string
          nullable: true
          description: Backdrop image path
        total_seasons:
          type: integer
          description: Total number of seasons
        total_episodes:
          type: integer
          description: Total number of episodes
        trailer_url:
          type: string
          nullable: true
          description: Trailer URL
        homepage:
          type: string
          nullable: true
          description: Official homepage URL
        external_ratings:
          type: array
          items:
            $ref: '#/components/schemas/ExternalRating'
          description: Ratings from external providers (IMDb, Rotten Tomatoes, Metacritic, etc.)
        library_added_at:
          type: string
          format: date-time
          description: When added to library
        metadata_updated_at:
          type: string
          format: date-time
          nullable: true
          description: Last metadata update
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TVSeason:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Season ID
        series_id:
          type: string
          format: uuid
          description: Parent series ID
        tmdb_id:
          type: integer
          nullable: true
          description: TMDb season ID
        season_number:
          type: integer
          description: Season number
        name:
          type: string
          description: Season name
        overview:
          type: string
          nullable: true
          description: Season overview
        poster_path:
          type: string
          nullable: true
          description: Poster image path
        episode_count:
          type: integer
          description: Number of episodes in season
        air_date:
          type: string
          format: date
          nullable: true
          description: Season air date
        vote_average:
          type: number
          format: float
          nullable: true
          description: Average rating
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TVEpisode:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Episode ID
        series_id:
          type: string
          format: uuid
          description: Parent series ID
        season_id:
          type: string
          format: uuid
          description: Parent season ID
        tmdb_id:
          type: integer
          nullable: true
          description: TMDb episode ID
        tvdb_id:
          type: integer
          nullable: true
          description: TVDb episode ID
        imdb_id:
          type: string
          nullable: true
          description: IMDb ID
        season_number:
          type: integer
          description: Season number
        episode_number:
          type: integer
          description: Episode number within season
        title:
          type: string
          description: Episode title
        overview:
          type: string
          nullable: true
          description: Episode overview
        air_date:
          type: string
          format: date
          nullable: true
          description: Air date
        runtime:
          type: integer
          nullable: true
          description: Runtime in minutes
        vote_average:
          type: number
          format: float
          nullable: true
          description: Average rating
        vote_count:
          type: integer
          nullable: true
          description: Number of votes
        still_path:
          type: string
          nullable: true
          description: Still image path
        production_code:
          type: string
          nullable: true
          description: Production code
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TVEpisodeFile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        episode_id:
          type: string
          format: uuid
        file_path:
          type: string
          description: Full file path
        file_name:
          type: string
          description: File name
        file_size:
          type: integer
          format: int64
          description: File size in bytes
        resolution:
          type: string
          nullable: true
          description: Video resolution (1080p, 2160p, etc.)
        quality_profile:
          type: string
          nullable: true
          description: Quality profile from Sonarr
        video_codec:
          type: string
          nullable: true
          description: Video codec (h264, h265, av1)
        audio_codec:
          type: string
          nullable: true
          description: Audio codec (aac, ac3, dts)
        container:
          type: string
          nullable: true
          description: Container format (mkv, mp4, avi)
        duration_seconds:
          type: integer
          nullable: true
          description: Duration in seconds
        bitrate_kbps:
          type: integer
          nullable: true
          description: Bitrate in kbps
        audio_languages:
          type: array
          items:
            type: string
          description: Audio language codes
        subtitle_languages:
          type: array
          items:
            type: string
          description: Subtitle language codes
        sonarr_file_id:
          type: integer
          nullable: true
          description: Sonarr file ID
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TVSeriesCredit:
      type: object
      properties:
        id:
          type: string
          format: uuid
        series_id:
          type: string
          format: uuid
        tmdb_person_id:
          type: integer
          description: TMDb person ID
        name:
          type: string
          description: Person name
        credit_type:
          type: string
          enum: [cast, crew]
          description: Credit type
        character:
          type: string
          nullable: true
          description: Character name (for cast)
        job:
          type: string
          nullable: true
          description: Job title (for crew)
        department:
          type: string
          nullable: true
          description: Department (for crew)
        cast_order:
          type: integer
          nullable: true
          description: Billing order (for cast)
        profile_path:
          type: string
          nullable: true
          description: Profile image path
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TVGenre:
      type: object
      properties:
        id:
          type: string
          format: uuid
        series_id:
          type: string
          format: uuid
        tmdb_genre_id:
          type: integer
          description: TMDb genre ID
        name:
          type: string
          description: Genre name
        created_at:
          type: string
          format: date-time

    TVNetwork:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tmdb_id:
          type: integer
          description: TMDb network ID
        name:
          type: string
          description: Network name
        logo_path:
          type: string
          nullable: true
          description: Logo image path
        origin_country:
          type: string
          nullable: true
          description: Origin country code
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    BulkEpisodesWatchedRequest:
      type: object
      required:
        - episode_ids
      properties:
        episode_ids:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          maxItems: 500
          description: List of episode IDs to mark as watched

    BulkEpisodesWatchedResponse:
      type: object
      required:
        - marked_count
      properties:
        marked_count:
          type: integer
          format: int64
          description: Number of episodes marked as watched

    EpisodeWatchProgress:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        episode_id:
          type: string
          format: uuid
        progress_seconds:
          type: integer
          description: Current progress in seconds
        duration_seconds:
          type: integer
          description: Total duration in seconds
        is_completed:
          type: boolean
          description: Whether episode has been watched
        watched_at:
          type: string
          format: date-time
          nullable: true
          description: When episode was marked as watched
        last_watched_at:
          type: string
          format: date-time
          description: Last time progress was updated
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UpdateEpisodeProgressRequest:
      type: object
      required:
        - progress_seconds
        - duration_seconds
      properties:
        progress_seconds:
          type: integer
          minimum: 0
          description: Current playback position in seconds
        duration_seconds:
          type: integer
          minimum: 1
          description: Total episode duration in seconds

    TVContinueWatchingItem:
      type: object
      properties:
        series_id:
          type: string
          format: uuid
        series_title:
          type: string
        series_poster_path:
          type: string
          nullable: true
        episode_id:
          type: string
          format: uuid
        episode_title:
          type: string
        season_number:
          type: integer
        episode_number:
          type: integer
        progress_seconds:
          type: integer
        duration_seconds:
          type: integer
        progress_percent:
          type: number
          format: float
          description: Progress as percentage (0-100)
        last_watched_at:
          type: string
          format: date-time

    EpisodeWithSeriesInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        series_id:
          type: string
          format: uuid
        series_title:
          type: string
        series_poster_path:
          type: string
          nullable: true
        season_id:
          type: string
          format: uuid
        tmdb_id:
          type: integer
          nullable: true
        tvdb_id:
          type: integer
          nullable: true
        season_number:
          type: integer
        episode_number:
          type: integer
        title:
          type: string
        overview:
          type: string
          nullable: true
        air_date:
          type: string
          format: date
          nullable: true
        runtime:
          type: integer
          nullable: true
        still_path:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    SeriesWatchStats:
      type: object
      properties:
        series_id:
          type: string
          format: uuid
        total_episodes:
          type: integer
          description: Total episodes in series
        watched_episodes:
          type: integer
          description: Number of episodes watched
        total_runtime_minutes:
          type: integer
          description: Total runtime of all episodes in minutes
        watched_runtime_minutes:
          type: integer
          description: Total watched runtime in minutes
        completion_percent:
          type: number
          format: float
          description: Completion percentage (0-100)
        last_watched_at:
          type: string
          format: date-time
          nullable: true

    UserTVStats:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        total_series:
          type: integer
          description: Total series with watch progress
        total_episodes_watched:
          type: integer
          description: Total episodes watched
        total_watch_time_minutes:
          type: integer
          description: Total watch time in minutes
        completed_series:
          type: integer
          description: Number of fully completed series
        current_series:
          type: integer
          description: Number of series in progress

    # Search schemas (Typesense library search)
    SearchResults:
      type: object
      properties:
        hits:
          type: array
          items:
            $ref: '#/components/schemas/SearchHit'
        total_hits:
          type: integer
          description: Total number of matching documents
        total_pages:
          type: integer
          description: Total number of pages
        current_page:
          type: integer
          description: Current page number
        search_time_ms:
          type: integer
          description: Search execution time in milliseconds
        facets:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/FacetValue'
          description: Facet counts for filtering

    SearchHit:
      type: object
      properties:
        document:
          $ref: '#/components/schemas/SearchDocument'
        score:
          type: number
          format: float
          description: Search relevance score
        highlights:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          description: Highlighted snippets for matching fields

    SearchDocument:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Movie ID
        tmdb_id:
          type: integer
          description: TMDb movie ID
        imdb_id:
          type: string
          description: IMDb ID
        title:
          type: string
          description: Movie title
        original_title:
          type: string
          description: Original title
        year:
          type: integer
          description: Release year
        release_date:
          type: string
          format: date
          description: Release date
        runtime:
          type: integer
          description: Runtime in minutes
        overview:
          type: string
          description: Plot summary
        status:
          type: string
          description: Release status
        poster_path:
          type: string
          description: Poster image path
        backdrop_path:
          type: string
          description: Backdrop image path
        vote_average:
          type: number
          format: float
          description: Average rating (0-10)
        popularity:
          type: number
          format: float
          description: Popularity score
        genres:
          type: array
          items:
            type: string
          description: Genre names
        cast:
          type: array
          items:
            type: string
          description: Cast member names (top 20)
        directors:
          type: array
          items:
            type: string
          description: Director names
        has_file:
          type: boolean
          description: Whether movie has a file in the library
        resolution:
          type: string
          description: Video resolution (e.g., 2160p, 1080p)
        quality_profile:
          type: string
          description: Quality profile

    FacetValue:
      type: object
      properties:
        value:
          type: string
          description: Facet value
        count:
          type: integer
          description: Number of documents with this value

    AutocompleteResults:
      type: object
      properties:
        suggestions:
          type: array
          items:
            type: string
          description: Matching movie titles

    SearchFacets:
      type: object
      properties:
        genres:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available genres
        years:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available release years
        status:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available statuses
        directors:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available directors
        resolution:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available resolutions
        has_file:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: File availability

    # TV Show Search schemas (Typesense library search)
    TVShowSearchResults:
      type: object
      properties:
        hits:
          type: array
          items:
            $ref: '#/components/schemas/TVShowSearchHit'
        total_hits:
          type: integer
          description: Total number of matching documents
        total_pages:
          type: integer
          description: Total number of pages
        current_page:
          type: integer
          description: Current page number
        search_time_ms:
          type: integer
          description: Search execution time in milliseconds
        facets:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/FacetValue'
          description: Facet counts for filtering

    TVShowSearchHit:
      type: object
      properties:
        document:
          $ref: '#/components/schemas/TVShowSearchDocument'
        score:
          type: number
          format: float
          description: Search relevance score
        highlights:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          description: Highlighted snippets for matching fields

    TVShowSearchDocument:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Series ID
        tmdb_id:
          type: integer
          description: TMDb series ID
        tvdb_id:
          type: integer
          description: TVDb series ID
        imdb_id:
          type: string
          description: IMDb ID
        title:
          type: string
          description: Series title
        original_title:
          type: string
          description: Original title
        year:
          type: integer
          description: First air year
        first_air_date:
          type: string
          format: date
          description: First air date
        overview:
          type: string
          description: Plot summary
        status:
          type: string
          description: Series status (Returning Series, Ended, etc.)
        type:
          type: string
          description: Series type (Scripted, Reality, etc.)
        poster_path:
          type: string
          description: Poster image path
        backdrop_path:
          type: string
          description: Backdrop image path
        vote_average:
          type: number
          format: float
          description: Average rating (0-10)
        popularity:
          type: number
          format: float
          description: Popularity score
        genres:
          type: array
          items:
            type: string
          description: Genre names
        cast:
          type: array
          items:
            type: string
          description: Cast member names (top 20)
        networks:
          type: array
          items:
            type: string
          description: Network names (HBO, Netflix, etc.)
        total_seasons:
          type: integer
          description: Total number of seasons
        total_episodes:
          type: integer
          description: Total number of episodes
        has_file:
          type: boolean
          description: Whether series has any episode files in the library

    TVShowSearchFacets:
      type: object
      properties:
        genres:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available genres
        years:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available first air years
        status:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available statuses
        type:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available series types
        networks:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: Available networks
        has_file:
          type: array
          items:
            $ref: '#/components/schemas/FacetValue'
          description: File availability

    # Metadata schemas (TMDb lookup)
    MetadataSearchResults:
      type: object
      properties:
        page:
          type: integer
          description: Current page number
        total_results:
          type: integer
          description: Total number of results
        total_pages:
          type: integer
          description: Total number of pages
        results:
          type: array
          items:
            $ref: '#/components/schemas/MetadataSearchResult'

    MetadataSearchResult:
      type: object
      properties:
        tmdb_id:
          type: integer
          description: TMDb movie ID
          example: 603
        title:
          type: string
          description: Movie title
          example: "The Matrix"
        original_title:
          type: string
          description: Original title (if different)
          example: "The Matrix"
        overview:
          type: string
          nullable: true
          description: Plot summary
        release_date:
          type: string
          format: date
          nullable: true
          description: Release date
          example: "1999-03-31"
        poster_path:
          type: string
          nullable: true
          description: Poster image path (use /api/v1/images/poster/{size}/{path})
          example: "/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg"
        backdrop_path:
          type: string
          nullable: true
          description: Backdrop image path
        vote_average:
          type: number
          format: float
          description: Average rating (0-10)
          example: 8.7
        vote_count:
          type: integer
          description: Number of votes
          example: 20000
        popularity:
          type: number
          format: float
          description: TMDb popularity score

    MetadataMovie:
      type: object
      properties:
        tmdb_id:
          type: integer
          description: TMDb movie ID
          example: 603
        imdb_id:
          type: string
          nullable: true
          description: IMDb ID
          example: "tt0133093"
        title:
          type: string
          description: Movie title
        original_title:
          type: string
          description: Original title
        tagline:
          type: string
          nullable: true
          description: Movie tagline
          example: "Welcome to the Real World"
        overview:
          type: string
          nullable: true
          description: Plot summary
        release_date:
          type: string
          format: date
          nullable: true
        runtime:
          type: integer
          nullable: true
          description: Runtime in minutes
          example: 136
        status:
          type: string
          description: Release status
          example: "Released"
        budget:
          type: integer
          nullable: true
          description: Budget in USD
        revenue:
          type: integer
          nullable: true
          description: Revenue in USD
        poster_path:
          type: string
          nullable: true
        backdrop_path:
          type: string
          nullable: true
        vote_average:
          type: number
          format: float
        vote_count:
          type: integer
        popularity:
          type: number
          format: float
        genres:
          type: array
          items:
            $ref: '#/components/schemas/MetadataGenre'
        cast:
          type: array
          items:
            $ref: '#/components/schemas/MetadataCastMember'
        crew:
          type: array
          items:
            $ref: '#/components/schemas/MetadataCrewMember'
        belongs_to_collection:
          $ref: '#/components/schemas/MetadataCollection'
          nullable: true

    MetadataGenre:
      type: object
      properties:
        id:
          type: integer
          description: TMDb genre ID
        name:
          type: string
          description: Genre name
          example: "Science Fiction"

    MetadataCastMember:
      type: object
      properties:
        id:
          type: integer
          description: TMDb person ID
        name:
          type: string
          description: Actor name
          example: "Keanu Reeves"
        character:
          type: string
          description: Character name
          example: "Thomas A. Anderson / Neo"
        order:
          type: integer
          description: Cast billing order
        profile_path:
          type: string
          nullable: true
          description: Profile image path

    MetadataCrewMember:
      type: object
      properties:
        id:
          type: integer
          description: TMDb person ID
        name:
          type: string
          description: Crew member name
        job:
          type: string
          description: Job title
          example: "Director"
        department:
          type: string
          description: Department
          example: "Directing"
        profile_path:
          type: string
          nullable: true

    MetadataCollection:
      type: object
      properties:
        id:
          type: integer
          description: TMDb collection ID
        name:
          type: string
          description: Collection name
          example: "The Matrix Collection"
        overview:
          type: string
          nullable: true
          description: Collection overview/description
        poster_path:
          type: string
          nullable: true
        backdrop_path:
          type: string
          nullable: true
        parts:
          type: array
          description: Movies in the collection
          items:
            $ref: '#/components/schemas/MetadataCollectionPart'

    MetadataCollectionPart:
      type: object
      description: A movie that is part of a collection
      properties:
        id:
          type: integer
          description: TMDb movie ID
        title:
          type: string
          description: Movie title
        original_title:
          type: string
          description: Original title
        overview:
          type: string
          nullable: true
        release_date:
          type: string
          format: date
          nullable: true
        poster_path:
          type: string
          nullable: true
        backdrop_path:
          type: string
          nullable: true
        vote_average:
          type: number
          format: float
        vote_count:
          type: integer
        popularity:
          type: number
          format: float

    MetadataTVSearchResults:
      type: object
      properties:
        page:
          type: integer
          description: Current page number
          example: 1
        total_results:
          type: integer
          description: Total number of results
          example: 42
        total_pages:
          type: integer
          description: Total number of pages
          example: 3
        results:
          type: array
          items:
            $ref: '#/components/schemas/MetadataTVSearchResult'

    MetadataTVSearchResult:
      type: object
      properties:
        tmdb_id:
          type: integer
          description: TMDb TV show ID
          example: 1396
        name:
          type: string
          description: TV show name
          example: "Breaking Bad"
        original_name:
          type: string
          description: Original name (if different)
        overview:
          type: string
          nullable: true
          description: Plot summary
        first_air_date:
          type: string
          format: date
          nullable: true
          description: First air date
          example: "2008-01-20"
        poster_path:
          type: string
          nullable: true
          description: Poster image path
        backdrop_path:
          type: string
          nullable: true
          description: Backdrop image path
        vote_average:
          type: number
          format: float
          description: Average rating (0-10)
        vote_count:
          type: integer
          description: Number of votes
        popularity:
          type: number
          format: float
          description: Popularity score

    MetadataTVShow:
      type: object
      properties:
        tmdb_id:
          type: integer
          description: TMDb TV show ID
          example: 1396
        imdb_id:
          type: string
          nullable: true
          description: IMDb ID
          example: "tt0903747"
        tvdb_id:
          type: integer
          nullable: true
          description: TVDb ID
        name:
          type: string
          description: TV show name
          example: "Breaking Bad"
        original_name:
          type: string
          description: Original name
        tagline:
          type: string
          nullable: true
          description: TV show tagline
        overview:
          type: string
          nullable: true
          description: Plot summary
        first_air_date:
          type: string
          format: date
          nullable: true
        last_air_date:
          type: string
          format: date
          nullable: true
        status:
          type: string
          description: Show status (Returning Series, Ended, etc.)
          example: "Ended"
        type:
          type: string
          description: Show type (Scripted, Reality, etc.)
        number_of_seasons:
          type: integer
          description: Total number of seasons
          example: 5
        number_of_episodes:
          type: integer
          description: Total number of episodes
          example: 62
        episode_run_time:
          type: array
          items:
            type: integer
          description: Typical episode run times in minutes
        poster_path:
          type: string
          nullable: true
        backdrop_path:
          type: string
          nullable: true
        vote_average:
          type: number
          format: float
        vote_count:
          type: integer
        popularity:
          type: number
          format: float
        networks:
          type: array
          items:
            $ref: '#/components/schemas/MetadataNetwork'
        genres:
          type: array
          items:
            $ref: '#/components/schemas/MetadataGenre'
        seasons:
          type: array
          items:
            $ref: '#/components/schemas/MetadataSeasonSummary'

    MetadataNetwork:
      type: object
      properties:
        id:
          type: integer
          description: Network ID
        name:
          type: string
          description: Network name
          example: "AMC"
        logo_path:
          type: string
          nullable: true

    MetadataSeasonSummary:
      type: object
      properties:
        id:
          type: integer
          description: TMDb season ID
        season_number:
          type: integer
          description: Season number
        name:
          type: string
          description: Season name
        overview:
          type: string
          nullable: true
        air_date:
          type: string
          format: date
          nullable: true
        episode_count:
          type: integer
          description: Number of episodes in season
        poster_path:
          type: string
          nullable: true

    MetadataSeason:
      type: object
      properties:
        id:
          type: integer
          description: TMDb season ID
        tmdb_show_id:
          type: integer
          description: TMDb TV show ID
        season_number:
          type: integer
          description: Season number
          example: 1
        name:
          type: string
          description: Season name
          example: "Season 1"
        overview:
          type: string
          nullable: true
        air_date:
          type: string
          format: date
          nullable: true
        poster_path:
          type: string
          nullable: true
        episodes:
          type: array
          items:
            $ref: '#/components/schemas/MetadataEpisodeSummary'

    MetadataEpisodeSummary:
      type: object
      properties:
        id:
          type: integer
          description: TMDb episode ID
        episode_number:
          type: integer
        name:
          type: string
        overview:
          type: string
          nullable: true
        air_date:
          type: string
          format: date
          nullable: true
        runtime:
          type: integer
          nullable: true
          description: Runtime in minutes
        still_path:
          type: string
          nullable: true
        vote_average:
          type: number
          format: float
        vote_count:
          type: integer

    MetadataEpisode:
      type: object
      properties:
        id:
          type: integer
          description: TMDb episode ID
        tmdb_show_id:
          type: integer
          description: TMDb TV show ID
        season_number:
          type: integer
        episode_number:
          type: integer
        name:
          type: string
          description: Episode title
          example: "Pilot"
        overview:
          type: string
          nullable: true
        air_date:
          type: string
          format: date
          nullable: true
        runtime:
          type: integer
          nullable: true
          description: Runtime in minutes
        still_path:
          type: string
          nullable: true
        vote_average:
          type: number
          format: float
        vote_count:
          type: integer
        crew:
          type: array
          items:
            $ref: '#/components/schemas/MetadataCrewMember'
        guest_stars:
          type: array
          items:
            $ref: '#/components/schemas/MetadataCastMember'

    SimilarMoviesResponse:
      type: object
      properties:
        movie_id:
          type: string
          format: uuid
          description: The source movie ID
        similar_movies:
          type: array
          description: List of similar movies from TMDb
          items:
            $ref: '#/components/schemas/SimilarMovie'
        total_results:
          type: integer
          description: Total number of similar movies available

    SimilarMovie:
      type: object
      description: A similar movie recommendation from TMDb
      properties:
        tmdb_id:
          type: integer
          description: TMDb movie ID
        title:
          type: string
          description: Movie title
        original_title:
          type: string
          description: Original title
        overview:
          type: string
          nullable: true
        release_date:
          type: string
          format: date
          nullable: true
        poster_path:
          type: string
          nullable: true
        backdrop_path:
          type: string
          nullable: true
        vote_average:
          type: number
          format: float
        vote_count:
          type: integer
        popularity:
          type: number
          format: float
        in_library:
          type: boolean
          description: Whether this movie is already in the library

    MovieWatched:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        movie_id:
          type: string
          format: uuid
        progress_seconds:
          type: integer
          description: Current position in seconds
        duration_seconds:
          type: integer
          description: Total duration in seconds
        progress_percent:
          type: integer
          nullable: true
          description: Progress percentage (generated)
        is_completed:
          type: boolean
          description: Whether movie is fully watched
        watch_count:
          type: integer
          description: Number of times watched
        last_watched_at:
          type: string
          format: date-time
          description: Last watch time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ContinueWatchingItem:
      allOf:
        - $ref: '#/components/schemas/Movie'
        - type: object
          properties:
            progress_seconds:
              type: integer
            duration_seconds:
              type: integer
            progress_percent:
              type: integer
              nullable: true
            last_watched_at:
              type: string
              format: date-time

    WatchedMovieItem:
      allOf:
        - $ref: '#/components/schemas/Movie'
        - type: object
          properties:
            watch_count:
              type: integer
            last_watched_at:
              type: string
              format: date-time

    UserMovieStats:
      type: object
      properties:
        watched_count:
          type: integer
          format: int64
          description: Number of movies watched
        in_progress_count:
          type: integer
          format: int64
          description: Number of movies in progress
        total_watches:
          type: integer
          format: int64
          nullable: true
          description: Total watch count across all movies

    # Settings schemas
    ServerSetting:
      type: object
      required:
        - key
        - value
        - data_type
      properties:
        key:
          type: string
          description: Setting key
          example: server.name
        value:
          oneOf:
            - type: string
            - type: number
            - type: boolean
            - type: object
          description: Setting value (type varies based on data_type)
          example: "My Revenge Server"
        description:
          type: string
          description: Human-readable description
          example: Server display name
        category:
          type: string
          description: Setting category for organization
          example: general
        data_type:
          type: string
          description: Expected data type
          enum: [string, integer, boolean, float, json]
          example: string
        is_secret:
          type: boolean
          description: Whether the setting contains sensitive data
          example: false
        is_public:
          type: boolean
          description: Whether the setting is exposed in public API
          example: true

    UserSetting:
      type: object
      required:
        - user_id
        - key
        - value
        - data_type
      properties:
        user_id:
          type: string
          format: uuid
          description: User ID
          example: 550e8400-e29b-41d4-a716-446655440000
        key:
          type: string
          description: Setting key
          example: theme
        value:
          oneOf:
            - type: string
            - type: number
            - type: boolean
            - type: object
          description: Setting value (type varies based on data_type)
          example: "dark"
        description:
          type: string
          description: Human-readable description
          example: UI theme preference
        category:
          type: string
          description: Setting category for organization
          example: ui
        data_type:
          type: string
          description: Expected data type
          enum: [string, integer, boolean, float, json]
          example: string

    SettingValue:
      type: object
      required:
        - value
      properties:
        value:
          oneOf:
            - type: string
            - type: number
            - type: boolean
            - type: object
          description: The new value for the setting
          example: "dark"

    User:
      type: object
      required:
        - id
        - username
        - email
        - is_active
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: User ID
          example: 550e8400-e29b-41d4-a716-446655440000
        username:
          type: string
          description: Unique username
          example: johndoe
        email:
          type: string
          format: email
          description: Email address
          example: john@example.com
        display_name:
          type: string
          description: Display name
          example: John Doe
        avatar_url:
          type: string
          description: Avatar image URL
          example: /avatars/550e8400-e29b-41d4-a716-446655440000/avatar.jpg
        locale:
          type: string
          description: Locale preference
          example: en-US
        timezone:
          type: string
          description: Timezone
          example: America/New_York
        qar_enabled:
          type: boolean
          description: QAR (adult content) access enabled
          example: false
        is_active:
          type: boolean
          description: Account is active
          example: true
        is_admin:
          type: boolean
          description: Has admin privileges
          example: false
        email_verified:
          type: boolean
          description: Email has been verified
          example: true
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp
          example: 2024-01-01T00:00:00Z
        last_login_at:
          type: string
          format: date-time
          description: Last login timestamp
          example: 2024-01-15T12:30:00Z

    AdminUserListResponse:
      type: object
      required:
        - users
        - total
      properties:
        users:
          type: array
          items:
            $ref: '#/components/schemas/User'
        total:
          type: integer
          format: int64
          description: Total number of matching users

    UserUpdate:
      type: object
      properties:
        email:
          type: string
          format: email
          description: New email address
        display_name:
          type: string
          description: New display name
        timezone:
          type: string
          description: New timezone

    UserPreferences:
      type: object
      required:
        - user_id
      properties:
        user_id:
          type: string
          format: uuid
          description: User ID
        email_notifications:
          type: object
          description: Email notification settings
          properties:
            enabled:
              type: boolean
            frequency:
              type: string
              enum: [instant, daily, weekly]
        push_notifications:
          type: object
          description: Push notification settings
          properties:
            enabled:
              type: boolean
        digest_notifications:
          type: object
          description: Digest notification settings
          properties:
            enabled:
              type: boolean
            frequency:
              type: string
              enum: [daily, weekly, monthly]
        profile_visibility:
          type: string
          enum: [public, friends, private]
          description: Profile visibility setting
        show_email:
          type: boolean
          description: Show email on profile
        show_activity:
          type: boolean
          description: Show activity on profile
        theme:
          type: string
          enum: [light, dark, system]
          description: UI theme
        display_language:
          type: string
          description: Display language
          example: en-US
        content_language:
          type: string
          description: Preferred content languages (comma-separated)
          example: en,de,fr
        metadata_language:
          type: string
          description: Language for metadata display (titles, overviews, taglines). ISO 639-1 code.
          example: en
        show_adult_content:
          type: boolean
          description: Show adult content
        show_spoilers:
          type: boolean
          description: Show spoilers
        auto_play_videos:
          type: boolean
          description: Auto-play videos

    UserPreferencesUpdate:
      type: object
      properties:
        email_notifications:
          type: object
          properties:
            enabled:
              type: boolean
            frequency:
              type: string
              enum: [instant, daily, weekly]
        push_notifications:
          type: object
          properties:
            enabled:
              type: boolean
        digest_notifications:
          type: object
          properties:
            enabled:
              type: boolean
            frequency:
              type: string
              enum: [daily, weekly, monthly]
        profile_visibility:
          type: string
          enum: [public, friends, private]
        show_email:
          type: boolean
        show_activity:
          type: boolean
        theme:
          type: string
          enum: [light, dark, system]
        display_language:
          type: string
        content_language:
          type: string
        metadata_language:
          type: string
          description: Language for metadata display (titles, overviews, taglines). ISO 639-1 code.
        show_adult_content:
          type: boolean
        show_spoilers:
          type: boolean
        auto_play_videos:
          type: boolean

    Avatar:
      type: object
      required:
        - id
        - user_id
        - file_path
        - version
        - is_current
      properties:
        id:
          type: string
          format: uuid
          description: Avatar ID
        user_id:
          type: string
          format: uuid
          description: User ID
        file_path:
          type: string
          description: File path
        file_size_bytes:
          type: integer
          description: File size in bytes
        mime_type:
          type: string
          description: MIME type
        width:
          type: integer
          description: Image width
        height:
          type: integer
          description: Image height
        is_animated:
          type: boolean
          description: Is animated (GIF)
        version:
          type: integer
          description: Avatar version number
        is_current:
          type: boolean
          description: Is the current avatar
        uploaded_at:
          type: string
          format: date-time
          description: Upload timestamp

    HealthCheck:
      type: object
      required:
        - name
        - status
      properties:
        name:
          type: string
          description: Name of the health check
          example: readiness
        status:
          type: string
          enum:
            - healthy
            - unhealthy
            - degraded
          description: Health status
          example: healthy
        message:
          type: string
          description: Human-readable message
          example: service is ready
        details:
          type: object
          additionalProperties: true
          description: Additional details about the health check
          example:
            database:
              name: database
              status: healthy
              message: database is healthy

    # Session schemas
    SessionInfo:
      type: object
      required:
        - id
        - ip_address
        - created_at
        - last_activity_at
        - expires_at
        - is_active
        - is_current
      properties:
        id:
          type: string
          format: uuid
          description: Session ID
        device_name:
          type: string
          description: Device name
        ip_address:
          type: string
          description: IP address
        user_agent:
          type: string
          description: User agent string
        created_at:
          type: string
          format: date-time
          description: Session creation timestamp
        last_activity_at:
          type: string
          format: date-time
          description: Last activity timestamp
        expires_at:
          type: string
          format: date-time
          description: Session expiration timestamp
        is_active:
          type: boolean
          description: Whether session is active
        is_current:
          type: boolean
          description: Whether this is the current session

    SessionListResponse:
      type: object
      required:
        - sessions
        - total
      properties:
        sessions:
          type: array
          items:
            $ref: '#/components/schemas/SessionInfo'
        total:
          type: integer
          format: int64
          description: Total number of sessions

    RefreshSessionRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          description: Refresh token

    RefreshSessionResponse:
      type: object
      required:
        - access_token
        - refresh_token
        - expires_in
      properties:
        access_token:
          type: string
          description: New access token
        refresh_token:
          type: string
          description: New refresh token (token rotation)
        expires_in:
          type: integer
          description: Token expiration time in seconds

    # RBAC schemas
    Policy:
      type: object
      required:
        - subject
        - object
        - action
      properties:
        subject:
          type: string
          description: Subject (user, role, or group)
        object:
          type: string
          description: Object (resource or endpoint)
        action:
          type: string
          description: Action (read, write, delete, etc.)

    PolicyRequest:
      type: object
      required:
        - subject
        - object
        - action
      properties:
        subject:
          type: string
          description: Subject (user, role, or group)
        object:
          type: string
          description: Object (resource or endpoint)
        action:
          type: string
          description: Action (read, write, delete, etc.)

    PolicyListResponse:
      type: object
      required:
        - policies
        - total
      properties:
        policies:
          type: array
          items:
            $ref: '#/components/schemas/Policy'
        total:
          type: integer
          format: int64
          description: Total number of policies

    RoleListResponse:
      type: object
      required:
        - roles
        - total
      properties:
        roles:
          type: array
          items:
            type: string
        total:
          type: integer
          format: int64
          description: Total number of roles

    AssignRoleRequest:
      type: object
      required:
        - role
      properties:
        role:
          type: string
          description: Role name to assign

    # Role Management schemas
    Permission:
      type: object
      required:
        - resource
        - action
      properties:
        resource:
          type: string
          description: Resource name (e.g., users, library, movies)
        action:
          type: string
          description: Action type (e.g., read, write, delete, manage, *)

    RoleDetail:
      type: object
      required:
        - name
        - permissions
        - is_built_in
        - user_count
      properties:
        name:
          type: string
          description: Role name
        description:
          type: string
          description: Role description
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/Permission'
        is_built_in:
          type: boolean
          description: Whether this is a built-in role (cannot be deleted)
        user_count:
          type: integer
          description: Number of users with this role

    RolesResponse:
      type: object
      required:
        - roles
        - total
      properties:
        roles:
          type: array
          items:
            $ref: '#/components/schemas/RoleDetail'
        total:
          type: integer
          format: int64
          description: Total number of roles

    CreateRoleRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Role name
          minLength: 1
          maxLength: 64
        description:
          type: string
          description: Role description
          maxLength: 256
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/Permission'

    UpdatePermissionsRequest:
      type: object
      required:
        - permissions
      properties:
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/Permission'

    PermissionsResponse:
      type: object
      required:
        - permissions
        - total
      properties:
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/Permission'
        total:
          type: integer
          format: int64
          description: Total number of permissions


    # API Keys schemas
    APIKeyInfo:
      type: object
      required:
        - id
        - user_id
        - name
        - key_prefix
        - scopes
        - is_active
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        key_prefix:
          type: string
          description: First 8 characters of the key (rv_xxxxx)
        scopes:
          type: array
          items:
            type: string
            enum: [read, write, admin]
        is_active:
          type: boolean
        expires_at:
          type: string
          format: date-time
          nullable: true
        last_used_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    APIKeyListResponse:
      type: object
      required:
        - keys
        - total
      properties:
        keys:
          type: array
          items:
            $ref: '#/components/schemas/APIKeyInfo'
        total:
          type: integer
          format: int64
          description: Total number of API keys

    CreateAPIKeyRequest:
      type: object
      required:
        - name
        - scopes
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          maxLength: 1000
        scopes:
          type: array
          items:
            type: string
            enum: [read, write, admin]
          minItems: 1
        expires_at:
          type: string
          format: date-time
          nullable: true

    CreateAPIKeyResponse:
      type: object
      required:
        - id
        - name
        - key_prefix
        - scopes
        - created_at
        - api_key
        - message
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        key_prefix:
          type: string
        scopes:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time
        api_key:
          type: string
          description: The raw API key - store this securely, it won't be shown again
        message:
          type: string
          description: Warning message about storing the key

    # ==========================================================================
    # OIDC Schemas
    # ==========================================================================

    # Public OIDC provider info (for login page)
    OIDCProviderInfo:
      type: object
      required:
        - name
        - displayName
      properties:
        name:
          type: string
          description: Provider identifier
        displayName:
          type: string
          description: Display name for UI
        isDefault:
          type: boolean
          description: Whether this is the default provider

    OIDCProviderListResponse:
      type: object
      required:
        - providers
        - total
      properties:
        providers:
          type: array
          items:
            $ref: '#/components/schemas/OIDCProviderInfo'
        total:
          type: integer
          format: int64
          description: Total number of providers

    OIDCAuthURLResponse:
      type: object
      required:
        - authUrl
      properties:
        authUrl:
          type: string
          description: URL to redirect for OIDC authentication

    OIDCCallbackResponse:
      type: object
      required:
        - accessToken
        - tokenType
        - expiresIn
      properties:
        accessToken:
          type: string
          description: JWT access token
        tokenType:
          type: string
          description: Token type (Bearer)
        expiresIn:
          type: integer
          description: Token expiry in seconds
        refreshToken:
          type: string
          description: Refresh token (if issued)
        user:
          $ref: '#/components/schemas/User'

    OIDCUserLink:
      type: object
      required:
        - id
        - providerName
        - providerDisplayName
        - linkedAt
      properties:
        id:
          type: string
          format: uuid
        providerName:
          type: string
        providerDisplayName:
          type: string
        email:
          type: string
        lastLoginAt:
          type: string
          format: date-time
        linkedAt:
          type: string
          format: date-time

    OIDCUserLinkListResponse:
      type: object
      required:
        - links
        - total
      properties:
        links:
          type: array
          items:
            $ref: '#/components/schemas/OIDCUserLink'
        total:
          type: integer
          format: int64
          description: Total number of linked providers

    # Admin OIDC schemas
    ClaimMappings:
      type: object
      properties:
        username:
          type: string
          description: Claim path for username
          default: preferred_username
        email:
          type: string
          description: Claim path for email
          default: email
        name:
          type: string
          description: Claim path for display name
          default: name
        picture:
          type: string
          description: Claim path for avatar URL
          default: picture
        roles:
          type: string
          description: Claim path for roles/groups
          default: groups

    AdminOIDCProvider:
      type: object
      required:
        - id
        - name
        - displayName
        - providerType
        - issuerUrl
        - clientId
        - scopes
        - autoCreateUsers
        - updateUserInfo
        - allowLinking
        - isEnabled
        - isDefault
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        displayName:
          type: string
        providerType:
          type: string
          enum:
            - generic
            - authentik
            - keycloak
        issuerUrl:
          type: string
        clientId:
          type: string
        authorizationEndpoint:
          type: string
        tokenEndpoint:
          type: string
        userInfoEndpoint:
          type: string
        jwksUri:
          type: string
        endSessionEndpoint:
          type: string
        scopes:
          type: array
          items:
            type: string
        claimMappings:
          $ref: '#/components/schemas/ClaimMappings'
        roleMappings:
          type: object
          additionalProperties:
            type: string
        autoCreateUsers:
          type: boolean
        updateUserInfo:
          type: boolean
        allowLinking:
          type: boolean
        isEnabled:
          type: boolean
        isDefault:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AdminOIDCProviderListResponse:
      type: object
      required:
        - providers
        - total
      properties:
        providers:
          type: array
          items:
            $ref: '#/components/schemas/AdminOIDCProvider'
        total:
          type: integer
          format: int64
          description: Total number of providers

    CreateOIDCProviderRequest:
      type: object
      required:
        - name
        - displayName
        - issuerUrl
        - clientId
        - clientSecret
      properties:
        name:
          type: string
          description: Unique provider identifier
          minLength: 1
          maxLength: 100
        displayName:
          type: string
          description: Display name for UI
          minLength: 1
          maxLength: 255
        providerType:
          type: string
          enum:
            - generic
            - authentik
            - keycloak
          default: generic
        issuerUrl:
          type: string
          description: OIDC issuer URL
        clientId:
          type: string
          description: OAuth2 client ID
        clientSecret:
          type: string
          description: OAuth2 client secret
        authorizationEndpoint:
          type: string
          description: Override authorization endpoint
        tokenEndpoint:
          type: string
          description: Override token endpoint
        userInfoEndpoint:
          type: string
          description: Override user info endpoint
        jwksUri:
          type: string
          description: Override JWKS URI
        endSessionEndpoint:
          type: string
          description: Override end session endpoint
        scopes:
          type: array
          items:
            type: string
          description: OAuth scopes (defaults to openid, profile, email)
        claimMappings:
          $ref: '#/components/schemas/ClaimMappings'
        roleMappings:
          type: object
          additionalProperties:
            type: string
          description: Map provider roles to Revenge roles
        autoCreateUsers:
          type: boolean
          default: true
          description: Create users on first OIDC login
        updateUserInfo:
          type: boolean
          default: true
          description: Update user info on each login
        allowLinking:
          type: boolean
          default: true
          description: Allow users to link existing accounts
        isEnabled:
          type: boolean
          default: true
        isDefault:
          type: boolean
          default: false

    UpdateOIDCProviderRequest:
      type: object
      properties:
        displayName:
          type: string
          minLength: 1
          maxLength: 255
        providerType:
          type: string
          enum:
            - generic
            - authentik
            - keycloak
        issuerUrl:
          type: string
        clientId:
          type: string
        clientSecret:
          type: string
        authorizationEndpoint:
          type: string
        tokenEndpoint:
          type: string
        userInfoEndpoint:
          type: string
        jwksUri:
          type: string
        endSessionEndpoint:
          type: string
        scopes:
          type: array
          items:
            type: string
        claimMappings:
          $ref: '#/components/schemas/ClaimMappings'
        roleMappings:
          type: object
          additionalProperties:
            type: string
        autoCreateUsers:
          type: boolean
        updateUserInfo:
          type: boolean
        allowLinking:
          type: boolean
        isEnabled:
          type: boolean
        isDefault:
          type: boolean

    # Activity schemas
    ActivityLogEntry:
      type: object
      required:
        - id
        - action
        - success
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        username:
          type: string
        action:
          type: string
          description: Action type (e.g., user.login, settings.update)
        resourceType:
          type: string
          description: Resource type (user, library, movie, etc.)
        resourceId:
          type: string
          format: uuid
        changes:
          type: object
          additionalProperties: true
          description: Field changes as JSON
        metadata:
          type: object
          additionalProperties: true
          description: Additional context
        ipAddress:
          type: string
        userAgent:
          type: string
        success:
          type: boolean
        errorMessage:
          type: string
        createdAt:
          type: string
          format: date-time

    ActivityLogListResponse:
      type: object
      required:
        - entries
        - total
      properties:
        entries:
          type: array
          items:
            $ref: '#/components/schemas/ActivityLogEntry'
        total:
          type: integer
          format: int64
          description: Total number of matching entries
        page:
          type: integer
          description: Current page number
        pageSize:
          type: integer
          description: Number of entries per page

    ActivityStats:
      type: object
      required:
        - totalCount
        - successCount
        - failedCount
      properties:
        totalCount:
          type: integer
          format: int64
        successCount:
          type: integer
          format: int64
        failedCount:
          type: integer
          format: int64
        oldestEntry:
          type: string
          format: date-time
        newestEntry:
          type: string
          format: date-time

    ActionCount:
      type: object
      required:
        - action
        - count
      properties:
        action:
          type: string
        count:
          type: integer
          format: int64

    ActionCountListResponse:
      type: object
      required:
        - actions
      properties:
        actions:
          type: array
          items:
            $ref: '#/components/schemas/ActionCount'

    # Radarr Integration schemas
    RadarrStatus:
      type: object
      required:
        - connected
        - syncStatus
      properties:
        connected:
          type: boolean
          description: Whether Radarr is reachable
        version:
          type: string
          description: Radarr version
          example: "5.3.6.8612"
        instanceName:
          type: string
          description: Radarr instance name
          example: "Radarr"
        startTime:
          type: string
          format: date-time
          description: When Radarr was started
        syncStatus:
          $ref: '#/components/schemas/RadarrSyncStatus'

    RadarrSyncStatus:
      type: object
      required:
        - isRunning
        - moviesAdded
        - moviesUpdated
        - moviesRemoved
        - totalMovies
      properties:
        isRunning:
          type: boolean
          description: Whether a sync is currently in progress
        lastSync:
          type: string
          format: date-time
          description: When the last sync completed
        lastSyncError:
          type: string
          description: Error message from last sync, if any
        moviesAdded:
          type: integer
          description: Number of movies added in last sync
        moviesUpdated:
          type: integer
          description: Number of movies updated in last sync
        moviesRemoved:
          type: integer
          description: Number of movies removed in last sync
        totalMovies:
          type: integer
          description: Total movies in Radarr library

    RadarrSyncResponse:
      type: object
      required:
        - message
        - status
      properties:
        message:
          type: string
          description: Status message
          example: "Sync started"
        status:
          type: string
          enum: [started, queued]
          description: Whether sync started immediately or was queued

    RadarrQualityProfile:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          description: Quality profile ID
        name:
          type: string
          description: Quality profile name
          example: "HD-1080p"
        upgradeAllowed:
          type: boolean
          description: Whether quality upgrades are allowed
        cutoff:
          type: integer
          description: Quality cutoff ID
        minFormatScore:
          type: integer
          description: Minimum custom format score

    RadarrQualityProfileList:
      type: object
      required:
        - profiles
      properties:
        profiles:
          type: array
          items:
            $ref: '#/components/schemas/RadarrQualityProfile'

    RadarrRootFolder:
      type: object
      required:
        - id
        - path
        - accessible
      properties:
        id:
          type: integer
          description: Root folder ID
        path:
          type: string
          description: Folder path
          example: "/movies"
        accessible:
          type: boolean
          description: Whether the folder is accessible
        freeSpace:
          type: integer
          format: int64
          description: Free space in bytes

    RadarrRootFolderList:
      type: object
      required:
        - folders
      properties:
        folders:
          type: array
          items:
            $ref: '#/components/schemas/RadarrRootFolder'

    RadarrWebhookPayload:
      type: object
      required:
        - eventType
      properties:
        eventType:
          type: string
          description: Type of webhook event
          enum: [Grab, Download, Rename, MovieDelete, MovieFileDelete, Health, ApplicationUpdate, Test]
        instanceName:
          type: string
          description: Radarr instance name
        applicationUrl:
          type: string
          description: Radarr application URL
        movie:
          $ref: '#/components/schemas/RadarrWebhookMovie'
        movieFile:
          $ref: '#/components/schemas/RadarrWebhookMovieFile'
        deletedFiles:
          type: array
          items:
            $ref: '#/components/schemas/RadarrWebhookMovieFile'
        release:
          $ref: '#/components/schemas/RadarrWebhookRelease'
        downloadClient:
          type: string
          description: Download client name
        downloadClientType:
          type: string
          description: Download client type
        downloadId:
          type: string
          description: Download ID
        isUpgrade:
          type: boolean
          description: Whether this is a quality upgrade

    RadarrWebhookMovie:
      type: object
      properties:
        id:
          type: integer
          description: Radarr movie ID
        title:
          type: string
        year:
          type: integer
        tmdbId:
          type: integer
        imdbId:
          type: string
        folderPath:
          type: string

    RadarrWebhookMovieFile:
      type: object
      properties:
        id:
          type: integer
          description: Radarr file ID
        relativePath:
          type: string
        path:
          type: string
        quality:
          type: string
        qualityVersion:
          type: integer
        size:
          type: integer
          format: int64
        dateAdded:
          type: string
          format: date-time

    RadarrWebhookRelease:
      type: object
      properties:
        quality:
          type: string
        qualityVersion:
          type: integer
        releaseGroup:
          type: string
        releaseTitle:
          type: string
        indexer:
          type: string
        size:
          type: integer
          format: int64

    # Sonarr Integration schemas
    SonarrStatus:
      type: object
      required:
        - connected
        - syncStatus
      properties:
        connected:
          type: boolean
          description: Whether Sonarr is reachable
        version:
          type: string
          description: Sonarr version
          example: "4.0.2.1183"
        instanceName:
          type: string
          description: Sonarr instance name
          example: "Sonarr"
        startTime:
          type: string
          format: date-time
          description: When Sonarr was started
        syncStatus:
          $ref: '#/components/schemas/SonarrSyncStatus'

    SonarrSyncStatus:
      type: object
      required:
        - isRunning
        - seriesAdded
        - seriesUpdated
        - seriesRemoved
        - totalSeries
      properties:
        isRunning:
          type: boolean
          description: Whether a sync is currently in progress
        lastSync:
          type: string
          format: date-time
          description: When the last sync completed
        lastSyncError:
          type: string
          description: Error message from last sync, if any
        seriesAdded:
          type: integer
          description: Number of series added in last sync
        seriesUpdated:
          type: integer
          description: Number of series updated in last sync
        seriesRemoved:
          type: integer
          description: Number of series removed in last sync
        episodesAdded:
          type: integer
          description: Number of episodes added in last sync
        episodesUpdated:
          type: integer
          description: Number of episodes updated in last sync
        totalSeries:
          type: integer
          description: Total series in Sonarr library
        totalEpisodes:
          type: integer
          description: Total episodes in Sonarr library

    SonarrSyncResponse:
      type: object
      required:
        - message
        - status
      properties:
        message:
          type: string
          description: Status message
          example: "Sync started"
        status:
          type: string
          enum: [started, queued]
          description: Whether sync started immediately or was queued

    SonarrQualityProfile:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          description: Quality profile ID
        name:
          type: string
          description: Quality profile name
          example: "HD-1080p"
        upgradeAllowed:
          type: boolean
          description: Whether quality upgrades are allowed
        cutoff:
          type: integer
          description: Quality cutoff ID
        minFormatScore:
          type: integer
          description: Minimum custom format score

    SonarrQualityProfileList:
      type: object
      required:
        - profiles
      properties:
        profiles:
          type: array
          items:
            $ref: '#/components/schemas/SonarrQualityProfile'

    SonarrRootFolder:
      type: object
      required:
        - id
        - path
        - accessible
      properties:
        id:
          type: integer
          description: Root folder ID
        path:
          type: string
          description: Folder path
          example: "/tv"
        accessible:
          type: boolean
          description: Whether the folder is accessible
        freeSpace:
          type: integer
          format: int64
          description: Free space in bytes

    SonarrRootFolderList:
      type: object
      required:
        - folders
      properties:
        folders:
          type: array
          items:
            $ref: '#/components/schemas/SonarrRootFolder'

    SonarrWebhookPayload:
      type: object
      required:
        - eventType
      properties:
        eventType:
          type: string
          description: Type of webhook event
          enum: [Grab, Download, Rename, SeriesAdd, SeriesDelete, EpisodeFileDelete, Health, ApplicationUpdate, Test]
        instanceName:
          type: string
          description: Sonarr instance name
        applicationUrl:
          type: string
          description: Sonarr application URL
        series:
          $ref: '#/components/schemas/SonarrWebhookSeries'
        episodes:
          type: array
          items:
            $ref: '#/components/schemas/SonarrWebhookEpisode'
        episodeFile:
          $ref: '#/components/schemas/SonarrWebhookEpisodeFile'
        deletedFiles:
          type: array
          items:
            $ref: '#/components/schemas/SonarrWebhookEpisodeFile'
        release:
          $ref: '#/components/schemas/SonarrWebhookRelease'
        downloadClient:
          type: string
          description: Download client name
        downloadClientType:
          type: string
          description: Download client type
        downloadId:
          type: string
          description: Download ID
        isUpgrade:
          type: boolean
          description: Whether this is a quality upgrade

    SonarrWebhookSeries:
      type: object
      properties:
        id:
          type: integer
          description: Sonarr series ID
        title:
          type: string
        titleSlug:
          type: string
        path:
          type: string
        tvdbId:
          type: integer
        tvMazeId:
          type: integer
        imdbId:
          type: string
        type:
          type: string
          description: Series type (standard, daily, anime)

    SonarrWebhookEpisode:
      type: object
      properties:
        id:
          type: integer
          description: Sonarr episode ID
        episodeNumber:
          type: integer
        seasonNumber:
          type: integer
        title:
          type: string
        airDate:
          type: string
          format: date
        airDateUtc:
          type: string
          format: date-time

    SonarrWebhookEpisodeFile:
      type: object
      properties:
        id:
          type: integer
          description: Sonarr file ID
        relativePath:
          type: string
        path:
          type: string
        quality:
          type: string
        qualityVersion:
          type: integer
        size:
          type: integer
          format: int64
        dateAdded:
          type: string
          format: date-time

    SonarrWebhookRelease:
      type: object
      properties:
        quality:
          type: string
        qualityVersion:
          type: integer
        releaseGroup:
          type: string
        releaseTitle:
          type: string
        indexer:
          type: string
        size:
          type: integer
          format: int64

    # Library schemas
    Library:
      type: object
      required:
        - id
        - name
        - type
        - paths
        - enabled
        - scanOnStartup
        - realtimeMonitoring
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          description: Library display name
          example: Movies
        type:
          type: string
          enum: [movie, tvshow, music, photo, book, audiobook, comic, podcast, adult]
          description: Type of media in the library
        paths:
          type: array
          items:
            type: string
          description: Folder paths included in the library
          example: ["/media/movies", "/shared/movies"]
        enabled:
          type: boolean
          description: Whether the library is enabled
        scanOnStartup:
          type: boolean
          description: Whether to scan the library on server startup
        realtimeMonitoring:
          type: boolean
          description: Whether to monitor for real-time file changes
        metadataProvider:
          type: string
          description: Preferred metadata provider
          example: tmdb
        preferredLanguage:
          type: string
          description: Preferred language for metadata
          example: en
        scannerConfig:
          type: object
          additionalProperties: true
          description: Type-specific scanner configuration
        latestScan:
          $ref: '#/components/schemas/LibraryScan'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    LibraryListResponse:
      type: object
      required:
        - libraries
        - total
      properties:
        libraries:
          type: array
          items:
            $ref: '#/components/schemas/Library'
        total:
          type: integer
          format: int64

    CreateLibraryRequest:
      type: object
      required:
        - name
        - type
        - paths
      properties:
        name:
          type: string
          description: Library display name
          minLength: 1
          maxLength: 255
          example: Movies
        type:
          type: string
          enum: [movie, tvshow, music, photo, book, audiobook, comic, podcast, adult]
          description: Type of media in the library
        paths:
          type: array
          items:
            type: string
          minItems: 1
          description: Folder paths to include in the library
          example: ["/media/movies"]
        enabled:
          type: boolean
          default: true
          description: Whether the library is enabled
        scanOnStartup:
          type: boolean
          default: false
          description: Whether to scan the library on server startup
        realtimeMonitoring:
          type: boolean
          default: false
          description: Whether to monitor for real-time file changes
        metadataProvider:
          type: string
          description: Preferred metadata provider
          example: tmdb
        preferredLanguage:
          type: string
          description: Preferred language for metadata
          example: en
        scannerConfig:
          type: object
          additionalProperties: true
          description: Type-specific scanner configuration

    UpdateLibraryRequest:
      type: object
      properties:
        name:
          type: string
          description: Library display name
          minLength: 1
          maxLength: 255
        paths:
          type: array
          items:
            type: string
          minItems: 1
          description: Folder paths to include in the library
        enabled:
          type: boolean
          description: Whether the library is enabled
        scanOnStartup:
          type: boolean
          description: Whether to scan the library on server startup
        realtimeMonitoring:
          type: boolean
          description: Whether to monitor for real-time file changes
        metadataProvider:
          type: string
          description: Preferred metadata provider
        preferredLanguage:
          type: string
          description: Preferred language for metadata
        scannerConfig:
          type: object
          additionalProperties: true
          description: Type-specific scanner configuration

    LibraryScan:
      type: object
      required:
        - id
        - libraryId
        - scanType
        - status
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        libraryId:
          type: string
          format: uuid
        scanType:
          type: string
          enum: [full, incremental, metadata]
          description: Type of scan
        status:
          type: string
          enum: [pending, running, completed, failed, cancelled]
          description: Current scan status
        itemsScanned:
          type: integer
          format: int64
          description: Number of items scanned
        itemsAdded:
          type: integer
          format: int64
          description: Number of new items added
        itemsUpdated:
          type: integer
          format: int64
          description: Number of items updated
        itemsRemoved:
          type: integer
          format: int64
          description: Number of items removed
        errorCount:
          type: integer
          format: int64
          description: Number of errors during scan
        errorMessage:
          type: string
          description: Error message if scan failed
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    LibraryScanListResponse:
      type: object
      required:
        - scans
        - total
      properties:
        scans:
          type: array
          items:
            $ref: '#/components/schemas/LibraryScan'
        total:
          type: integer
          format: int64

    LibraryPermission:
      type: object
      required:
        - id
        - libraryId
        - userId
        - permission
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        libraryId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        permission:
          type: string
          enum: [view, download, manage]
          description: Permission type
        createdAt:
          type: string
          format: date-time

    LibraryPermissionListResponse:
      type: object
      required:
        - permissions
        - total
      properties:
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/LibraryPermission'
        total:
          type: integer
          format: int64
          description: Total number of permissions

    # Playback / HLS schemas
    StartPlaybackRequest:
      type: object
      required:
        - mediaType
        - mediaId
      properties:
        mediaType:
          type: string
          enum: [movie, episode]
          description: Type of media to play
        mediaId:
          type: string
          format: uuid
          description: Movie or episode ID
        fileId:
          type: string
          format: uuid
          description: Specific file ID (optional, uses default if omitted)
        audioTrack:
          type: integer
          default: 0
          description: Audio track index to select initially
        subtitleTrack:
          type: integer
          description: Subtitle track index (omit to disable subtitles)
        startPosition:
          type: integer
          default: 0
          description: Start position in seconds (for resume)

    PlaybackSession:
      type: object
      required:
        - sessionId
        - masterPlaylistUrl
        - durationSeconds
        - profiles
        - audioTracks
        - subtitleTracks
        - createdAt
        - expiresAt
      properties:
        sessionId:
          type: string
          format: uuid
        masterPlaylistUrl:
          type: string
          description: URL to the HLS master playlist
          example: /api/v1/playback/stream/01234567-89ab-cdef-0123-456789abcdef/master.m3u8
        durationSeconds:
          type: number
          format: double
          description: Total media duration in seconds
        profiles:
          type: array
          items:
            $ref: '#/components/schemas/PlaybackProfile'
          description: Available quality profiles
        audioTracks:
          type: array
          items:
            $ref: '#/components/schemas/PlaybackAudioTrack'
          description: |
            Available audio tracks. Each track is a separate HLS rendition 
            the player downloads only the active track's segments, so switching
            is instant without restarting the stream.
        subtitleTracks:
          type: array
          items:
            $ref: '#/components/schemas/PlaybackSubtitleTrack'
          description: |
            Available subtitle tracks. Each is a pre-extracted WebVTT file
            served in full, so switching is instant client-side.
        createdAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time

    PlaybackProfile:
      type: object
      required:
        - name
        - width
        - height
        - bitrate
        - isOriginal
      properties:
        name:
          type: string
          description: Profile name
          example: 1080p
        width:
          type: integer
          description: Video width in pixels
        height:
          type: integer
          description: Video height in pixels
        bitrate:
          type: integer
          description: Video bitrate in kbps (0 for direct copy)
        isOriginal:
          type: boolean
          description: Whether this profile copies the original streams without transcoding

    PlaybackAudioTrack:
      type: object
      required:
        - index
        - channels
        - codec
        - isDefault
      properties:
        index:
          type: integer
          description: Audio stream index in the source file
        language:
          type: string
          description: ISO 639 language code
          example: eng
        title:
          type: string
          description: Track title from file metadata
          example: English 5.1 Surround
        channels:
          type: integer
          description: Number of audio channels
          example: 6
        layout:
          type: string
          description: Channel layout
          example: "5.1"
        codec:
          type: string
          description: Source audio codec
          example: eac3
        isDefault:
          type: boolean
          description: Whether this is the default audio track

    PlaybackSubtitleTrack:
      type: object
      required:
        - index
        - codec
        - url
        - isForced
      properties:
        index:
          type: integer
          description: Subtitle stream index in the source file
        language:
          type: string
          description: ISO 639 language code
          example: eng
        title:
          type: string
          description: Track title from file metadata
          example: English (SDH)
        codec:
          type: string
          description: Source subtitle codec
          example: subrip
        url:
          type: string
          description: URL to the WebVTT subtitle file
          example: /api/v1/playback/stream/01234567-89ab-cdef-0123-456789abcdef/subs/0.vtt
        isForced:
          type: boolean
          description: Whether this is a forced subtitle track (e.g., foreign language signs)

    ExternalRating:
      type: object
      required:
        - source
        - value
        - score
      properties:
        source:
          type: string
          description: Rating source name (e.g. "Internet Movie Database", "Rotten Tomatoes", "Metacritic", "TMDb")
        value:
          type: string
          description: Original rating value (e.g. "8.8/10", "96%", "90/100")
        score:
          type: number
          format: float
          description: Normalized score on a 0-100 scale

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          description: HTTP status code
          example: 500
        message:
          type: string
          description: Human-readable error message
          example: Internal server error
        details:
          type: object
          additionalProperties: true
          description: Additional error details

  responses:
    Error:
      description: Error response
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    BadRequest:
      description: Bad request - invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: Unauthorized - authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Forbidden:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token from /api/v1/auth/login
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key from /api/v1/apikeys
    webhookAuth:
      type: apiKey
      in: header
      name: X-Webhook-Secret
      description: |
        Shared secret for authenticating webhook calls from Radarr/Sonarr.
        Configure the same secret in both Revenge and your *arr application.
        Set via REVENGE_INTEGRATIONS_RADARR_WEBHOOK_SECRET / REVENGE_INTEGRATIONS_SONARR_WEBHOOK_SECRET.

security: []
