paths:
  /libraries:
    get:
      operationId: listLibraries
      x-ogen-operation-group: Libraries
      summary: List libraries accessible to current user
      tags:
        - Libraries
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of libraries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "./components/schemas.yaml#/components/schemas/Library"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

    post:
      operationId: createLibrary
      x-ogen-operation-group: Libraries
      summary: Create a new library
      description: Admin only
      tags:
        - Libraries
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "./components/schemas.yaml#/components/schemas/LibraryCreate"
      responses:
        "201":
          description: Library created
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Library"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/ValidationError"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "403":
          description: Not authorized (admin required)
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

  /libraries/{libraryId}:
    get:
      operationId: getLibrary
      x-ogen-operation-group: Libraries
      summary: Get library by ID
      tags:
        - Libraries
      security:
        - bearerAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
      responses:
        "200":
          description: Library details
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Library"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "403":
          description: No access to library
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "404":
          description: Library not found
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

    patch:
      operationId: updateLibrary
      x-ogen-operation-group: Libraries
      summary: Update library
      description: Admin or library manager
      tags:
        - Libraries
      security:
        - bearerAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "./components/schemas.yaml#/components/schemas/LibraryUpdate"
      responses:
        "200":
          description: Library updated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Library"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/ValidationError"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "403":
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "404":
          description: Library not found
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

    delete:
      operationId: deleteLibrary
      x-ogen-operation-group: Libraries
      summary: Delete library
      description: Admin only
      tags:
        - Libraries
      security:
        - bearerAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
      responses:
        "204":
          description: Library deleted
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "403":
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "404":
          description: Library not found
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

  /libraries/{libraryId}/scan:
    post:
      operationId: scanLibrary
      x-ogen-operation-group: Libraries
      summary: Trigger library scan
      description: Admin or library manager
      tags:
        - Libraries
      security:
        - bearerAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScanRequest"
      responses:
        "202":
          description: Scan started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScanResponse"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "403":
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "404":
          description: Library not found
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

  /libraries/{libraryId}/users:
    get:
      operationId: listLibraryUsers
      x-ogen-operation-group: Libraries
      summary: List users with access to library
      description: Admin or library manager
      tags:
        - Libraries
      security:
        - bearerAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
      responses:
        "200":
          description: List of users with access
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/LibraryUserAccess"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "403":
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

  /libraries/{libraryId}/users/{userId}:
    put:
      operationId: grantLibraryAccess
      x-ogen-operation-group: Libraries
      summary: Grant user access to library
      description: Admin only
      tags:
        - Libraries
      security:
        - bearerAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
        - name: userId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LibraryAccessRequest"
      responses:
        "204":
          description: Access granted
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "403":
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "404":
          description: Library or user not found
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

    delete:
      operationId: revokeLibraryAccess
      x-ogen-operation-group: Libraries
      summary: Revoke user access to library
      description: Admin only
      tags:
        - Libraries
      security:
        - bearerAuth: []
      parameters:
        - name: libraryId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
        - name: userId
          in: path
          required: true
          schema:
            $ref: "./components/schemas.yaml#/components/schemas/UUID"
      responses:
        "204":
          description: Access revoked
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"
        "403":
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: "./components/schemas.yaml#/components/schemas/Error"

components:
  schemas:
    ScanRequest:
      type: object
      properties:
        fullScan:
          type: boolean
          default: false
          description: If true, rescan all files. If false, only scan new/changed files.

    ScanResponse:
      type: object
      required:
        - jobId
        - status
      properties:
        jobId:
          $ref: "./components/schemas.yaml#/components/schemas/UUID"
        status:
          type: string
          enum: [queued, running]
        message:
          type: string

    LibraryUserAccess:
      type: object
      required:
        - userId
        - username
        - canManage
      properties:
        userId:
          $ref: "./components/schemas.yaml#/components/schemas/UUID"
        username:
          type: string
        email:
          type: string
        canManage:
          type: boolean
          description: If true, user can manage library settings

    LibraryAccessRequest:
      type: object
      properties:
        canManage:
          type: boolean
          default: false
