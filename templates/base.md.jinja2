{#-
  Base Template for Design Documentation

  This template provides the foundation for all design docs with block-based inheritance.
  Child templates extend this and override blocks as needed.

  Variables:
  - claude: bool - If true, render Claude-optimized version
  - wiki: bool - If true, render wiki user-friendly version
  - doc_title: str - Document title
  - doc_category: str - Category (feature, service, integration, etc.)
  - status_*: str - Status for each dimension
  - sources: list - External documentation sources
  - design_refs: list - Cross-references to other design docs
-#}
{#- No YAML frontmatter - GitHub has issues with long frontmatter.
    Sources and design_refs are shown in Related Documentation section instead. -#}

{% block title -%}
# {{ doc_title }}
{%- endblock %}

{% block metadata -%}
{%- if claude %}
**Created**: {{ created_date | default('2026-01-31') }}
**Status**: {{ overall_status | default('ðŸŸ¡ In Progress') }}
**Category**: {{ doc_category }}
{%- endif %}
{%- endblock %}

{% block overview -%}
{%- if claude %}
> {{ technical_summary }}
{%- elif wiki %}
{{ wiki_tagline }}

{{ wiki_overview }}
{%- endif %}
{%- endblock %}

---

{% block status_table -%}
{%- if claude %}
## Status

| Dimension | Status | Notes |
|-----------|--------|-------|
| Design | {{ status_design | default('ðŸ”´ Not Started') }} | {{ status_design_notes | default('-') }} |
| Sources | {{ status_sources | default('ðŸ”´ Not Started') }} | {{ status_sources_notes | default('-') }} |
| Instructions | {{ status_instructions | default('ðŸ”´ Not Started') }} | {{ status_instructions_notes | default('-') }} |
| Code | {{ status_code | default('ðŸ”´ Not Started') }} | {{ status_code_notes | default('-') }} |
| Linting | {{ status_linting | default('ðŸ”´ Not Started') }} | {{ status_linting_notes | default('-') }} |
| Unit Testing | {{ status_unit_testing | default('ðŸ”´ Not Started') }} | {{ status_unit_testing_notes | default('-') }} |
| Integration Testing | {{ status_integration_testing | default('ðŸ”´ Not Started') }} | {{ status_integration_testing_notes | default('-') }} |

**Overall**: {{ overall_status | default('ðŸ”´ Not Started') }}
{%- endif %}
{%- endblock %}

{% block table_of_contents -%}
{#- TOC is now generated by generate-toc.py as part of batch_regenerate.py -#}
{#- This block is kept for template inheritance but renders nothing -#}
{%- endblock %}

{#- Only show divider if there's content in following sections -#}
{%- set has_main_content = architecture_diagram is defined or file_structure is defined or env_vars is defined or api_endpoints is defined or unit_tests_description is defined %}
{%- if has_main_content %}

---
{%- endif %}

{% block architecture -%}
{%- if claude %}
{%- if architecture_diagram is defined and architecture_diagram %}
## Architecture

{{ architecture_diagram }}

{%- if component_description is defined and component_description %}
### Components

{{ component_description }}
{%- endif %}
{%- endif %}
{%- elif wiki %}
{%- if wiki_how_it_works is defined and wiki_how_it_works %}
## How It Works

{{ wiki_how_it_works }}
{%- endif %}
{%- endif %}
{%- endblock -%}

{%- block implementation -%}
{%- if claude %}
{%- set has_impl = file_structure is defined or key_interfaces is defined or dependencies is defined %}
{%- if has_impl %}
## Implementation

{%- if file_structure is defined and file_structure %}

### File Structure

{{ file_structure }}
{%- endif %}

{%- if key_interfaces is defined and key_interfaces %}

### Key Interfaces

{{ key_interfaces }}
{%- endif %}

{%- if dependencies is defined and dependencies %}

### Dependencies

{%- if dependencies is string %}
{{ dependencies }}
{%- elif dependencies is mapping %}
{%- for category, deps in dependencies.items() %}
**{{ category | title }}**:
{%- for dep in deps %}
- `{{ dep.name }}` ({{ dep.version }}): {{ dep.purpose }}
{%- endfor %}

{%- endfor %}
{%- else %}
{%- for dep in dependencies %}
- `{{ dep.name }}`: {{ dep.purpose }}
{%- endfor %}
{%- endif %}
{%- endif %}
{%- endif %}
{%- endif %}
{%- endblock -%}

{%- block features -%}
{%- if wiki %}
## Features

{%- if feature_list is defined and feature_list %}
{%- for feature in feature_list %}
- **{{ feature.name }}**: {{ feature.description }}
{%- endfor %}
{%- else %}
<!-- Feature list placeholder -->
{%- endif %}
{%- endif %}
{%- endblock -%}

{%- block screenshots -%}
{%- if wiki and screenshots is defined and screenshots %}
## Screenshots

{%- for screenshot in screenshots %}
### {{ screenshot.title }}

![{{ screenshot.title }}]({{ screenshot.path }})

*{{ screenshot.caption }}*

{%- endfor %}
{%- endif %}
{%- endblock -%}

{%- block configuration -%}
{%- set has_config = env_vars is defined or config_keys is defined or wiki_configuration is defined %}
{%- if has_config %}
## Configuration

{%- if claude %}
{%- if env_vars is defined and env_vars %}

### Environment Variables

{{ env_vars }}
{%- endif %}

{%- if config_keys is defined and config_keys %}

### Config Keys

{%- if config_keys is string %}
{{ config_keys }}
{%- elif config_keys is mapping %}
{%- for category, keys in config_keys.items() %}
**{{ category | title }}**:

| Key | Type | Default | Description |
|-----|------|---------|-------------|
{%- for key in keys %}
| `{{ key.key }}` | {{ key.type }} | {{ key.default }} | {{ key.description }} |
{%- endfor %}

{%- endfor %}
{%- else %}
| Key | Type | Default | Description |
|-----|------|---------|-------------|
{%- for key in config_keys %}
| `{{ key.key }}` | {{ key.type }} | {{ key.default }} | {{ key.description }} |
{%- endfor %}
{%- endif %}
{%- endif %}
{%- elif wiki %}
{%- if wiki_configuration is defined and wiki_configuration %}
{{ wiki_configuration }}
{%- endif %}
{%- endif %}
{%- endif %}
{%- endblock -%}

{%- block api -%}
{%- if claude and api_endpoints is defined and api_endpoints %}
## API Endpoints

{%- if api_endpoints is string %}
{{ api_endpoints }}
{%- else %}
{%- for endpoint in api_endpoints %}
### {{ endpoint.method }} {{ endpoint.path }}

{%- if endpoint.get('description') %}

{{ endpoint.description }}
{%- endif %}

**Request**:
```json
{{ endpoint.request | default(endpoint.request_example) | default('{}') }}
```

**Response**:
```json
{{ endpoint.response | default(endpoint.response_example) | default('{}') }}
```
{%- endfor %}
{%- endif %}
{%- endif %}
{%- endblock -%}

{%- block testing -%}
{%- if claude %}
{%- set has_tests = unit_tests_description is defined or integration_tests_description is defined or test_coverage_notes is defined %}
{%- if has_tests %}
## Testing Strategy

{%- if unit_tests_description is defined and unit_tests_description %}

### Unit Tests

{{ unit_tests_description }}
{%- endif %}

{%- if integration_tests_description is defined and integration_tests_description %}

### Integration Tests

{{ integration_tests_description }}
{%- endif %}

{%- if test_coverage_notes is defined and test_coverage_notes %}

### Test Coverage

Target: **80% minimum**

{{ test_coverage_notes }}
{%- endif %}
{%- endif %}
{%- endif %}
{%- endblock -%}

{%- block implementation_checklist -%}
{%- if claude and implementation_phases is defined and implementation_phases %}
## Implementation Checklist

{%- for phase in implementation_phases %}
### {{ phase.name }}

{%- for task in phase.tasks %}
- [ ] {{ task }}
{%- endfor %}

{%- endfor %}
{%- endif %}
{%- endblock -%}

{%- block troubleshooting -%}
{%- if wiki and troubleshooting is defined and troubleshooting %}
## Troubleshooting

{%- for issue in troubleshooting %}
### {{ issue.problem }}

**Cause**: {{ issue.cause }}

**Solution**: {{ issue.solution }}

{%- endfor %}
{%- endif %}
{%- endblock -%}

{%- block related_docs %}
## Related Documentation

{%- if claude %}
### Design Documents

{%- if design_refs is defined and design_refs %}
{%- for ref in design_refs %}
- [{{ ref.title }}]({{ ref.path }})
{%- endfor %}
{%- else %}
<!-- Related design docs -->
{%- endif %}

### External Sources

{%- if sources is defined and sources %}
{%- for source in sources %}
- [{{ source.name }}]({{ source.url|to_local_source }}){% if source.note %} - {{ source.note }}{% endif %}
{%- endfor %}
{%- else %}
<!-- External documentation sources -->
{%- endif %}
{%- elif wiki %}
### Related Pages

{%- if related_wiki_pages is defined and related_wiki_pages %}
{%- for page in related_wiki_pages %}
- [{{ page.title }}]({{ page.path }})
{%- endfor %}
{%- else %}
<!-- Related wiki pages -->
{%- endif %}

{%- if sources is defined and sources %}

### Learn More

Official documentation and guides:

{%- for source in sources %}
- [{{ source.name }}]({{ source.url|to_local_source }})
{%- endfor %}
{%- endif %}
{%- endif %}
{%- endblock %}

{% block footer -%}
{%- if wiki %}

---

**Need Help?** [Open an issue](https://github.com/{{ github_org | default('revenge-project') }}/{{ github_repo | default('revenge') }}/issues) or [Join the discussion](https://github.com/{{ github_org | default('revenge-project') }}/{{ github_repo | default('revenge') }}/discussions)

{%- endif %}
{%- endblock %}
