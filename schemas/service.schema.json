{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/revenge/schemas/service.schema.json",
  "title": "Service Documentation Schema",
  "description": "Schema for backend service YAML data files",
  "type": "object",
  "required": ["doc_title", "doc_category", "service_name", "package_path", "fx_module"],
  "properties": {
    "doc_title": {
      "type": "string",
      "description": "Document title",
      "minLength": 1
    },
    "doc_category": {
      "type": "string",
      "enum": ["service"],
      "description": "Document category"
    },
    "service_name": {
      "type": "string",
      "description": "Service name (e.g., 'Authentication Service')",
      "minLength": 1
    },
    "package_path": {
      "type": "string",
      "description": "Go package path (e.g., 'internal/service/auth')",
      "pattern": "^internal/service/[a-z][a-z0-9_/]*$"
    },
    "fx_module": {
      "type": "string",
      "description": "fx module name (e.g., 'auth.Module')",
      "pattern": "^[a-z][a-z0-9_]*\\.Module$|^\\.Module$"
    },
    "created_date": {
      "type": "string",
      "format": "date",
      "description": "Document creation date (YYYY-MM-DD)"
    },
    "overall_status": {
      "type": "string",
      "pattern": "^[ðŸ”´ðŸŸ¡âœ…ðŸ”µ].+",
      "description": "Overall status with emoji"
    },
    "status_design": {"type": "string"},
    "status_design_notes": {"type": "string"},
    "status_sources": {"type": "string"},
    "status_sources_notes": {"type": "string"},
    "status_instructions": {"type": "string"},
    "status_instructions_notes": {"type": "string"},
    "status_code": {"type": "string"},
    "status_code_notes": {"type": "string"},
    "status_linting": {"type": "string"},
    "status_linting_notes": {"type": "string"},
    "status_unit_testing": {"type": "string"},
    "status_unit_testing_notes": {"type": "string"},
    "status_integration_testing": {"type": "string"},
    "status_integration_testing_notes": {"type": "string"},
    "technical_summary": {
      "type": "string",
      "description": "Technical summary for Claude docs"
    },
    "wiki_tagline": {
      "type": "string",
      "description": "User-friendly tagline for wiki"
    },
    "wiki_overview": {
      "type": "string",
      "description": "User-friendly overview for wiki"
    },
    "wiki_how_it_works": {
      "type": "string",
      "description": "User-friendly explanation of how it works"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "purpose"],
        "properties": {
          "name": {"type": "string"},
          "purpose": {"type": "string"}
        }
      },
      "description": "Service dependencies"
    },
    "provides": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "description"],
        "properties": {
          "name": {"type": "string"},
          "description": {"type": "string"}
        }
      },
      "description": "What this service provides to other modules"
    },
    "component_diagram": {
      "type": "string",
      "description": "Component interaction diagram"
    },
    "public_methods": {
      "type": "string",
      "description": "Public methods documentation"
    },
    "service_events": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "description"],
        "properties": {
          "name": {"type": "string"},
          "description": {"type": "string"}
        }
      },
      "description": "Events emitted by this service"
    },
    "has_database": {
      "type": "boolean",
      "description": "Whether this service has database tables"
    },
    "database_tables": {
      "type": "string",
      "description": "Database tables documentation"
    },
    "migration_notes": {
      "type": "string",
      "description": "Migration notes"
    },
    "has_caching": {
      "type": "boolean",
      "description": "Whether this service uses caching"
    },
    "caching_strategy": {
      "type": "string",
      "description": "Caching strategy description"
    },
    "cache_keys": {
      "type": "string",
      "description": "Cache key patterns"
    },
    "cache_invalidation": {
      "type": "string",
      "description": "Cache invalidation strategy"
    },
    "security_notes": {
      "type": "string",
      "description": "Security considerations"
    },
    "authorization_notes": {
      "type": "string",
      "description": "Authorization requirements"
    },
    "audit_logging": {
      "type": "string",
      "description": "Audit logging details"
    },
    "sources": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "url"],
        "properties": {
          "name": {"type": "string"},
          "url": {"type": "string", "format": "uri"},
          "note": {"type": "string"}
        }
      },
      "description": "External documentation sources"
    },
    "design_refs": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["title", "path"],
        "properties": {
          "title": {"type": "string"},
          "path": {"type": "string"}
        }
      },
      "description": "Cross-references to other design docs"
    },
    "api_endpoints": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["method", "path", "description"],
        "properties": {
          "method": {"type": "string", "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"]},
          "path": {"type": "string"},
          "description": {"type": "string"},
          "request_example": {"type": "string"},
          "response_example": {"type": "string"}
        }
      },
      "description": "API endpoints"
    },
    "implementation_phases": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "tasks"],
        "properties": {
          "name": {"type": "string"},
          "tasks": {
            "type": "array",
            "items": {"type": "string"}
          }
        }
      },
      "description": "Implementation checklist phases"
    }
  },
  "additionalProperties": true
}
