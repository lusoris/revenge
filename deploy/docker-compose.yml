# Auto-generated from SOURCE_OF_TRUTH.md
# Do not edit directly. Run: python scripts/deploy-pipeline/01-generate.py
# Generated: 2026-02-01

version: '3.8'
services:
  revenge:
    image: ghcr.io/lusoris/revenge:${REVENGE_VERSION:-latest}
    build:
      context: ..
      dockerfile: Dockerfile
    ports:
    - ${REVENGE_PORT:-8080}:8080
    environment:
      REVENGE_SERVER_PORT: '8080'
      REVENGE_SERVER_HOST: 0.0.0.0
      REVENGE_DATABASE_HOST: db
      REVENGE_DATABASE_PORT: '5432'
      REVENGE_DATABASE_NAME: revenge
      REVENGE_DATABASE_USER: revenge
      REVENGE_DATABASE_PASSWORD: ${DB_PASSWORD:-revenge_dev_password}
      REVENGE_CACHE_HOST: dragonfly
      REVENGE_CACHE_PORT: '6379'
    volumes:
    - ${MEDIA_PATH:-./media}:/media:ro
    networks:
    - revenge-net
    depends_on:
      db:
        condition: service_healthy
      dragonfly:
        condition: service_healthy
    healthcheck:
      test:
      - CMD
      - wget
      - --no-verbose
      - --tries=1
      - --spider
      - http://localhost:8080/health/ready
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
  db:
    image: postgres:18-alpine
    environment:
      POSTGRES_DB: revenge
      POSTGRES_USER: revenge
      POSTGRES_PASSWORD: ${DB_PASSWORD:-revenge_dev_password}
    volumes:
    - pgdata:/var/lib/postgresql/data
    networks:
    - revenge-net
    healthcheck:
      test:
      - CMD-SHELL
      - pg_isready -U revenge -d revenge
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped
  dragonfly:
    image: docker.dragonflydb.io/dragonflydb/dragonfly:latest
    command: dragonfly --logtostderr
    volumes:
    - dfdata:/data
    networks:
    - revenge-net
    healthcheck:
      test:
      - CMD
      - redis-cli
      - ping
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped
volumes:
  pgdata: null
  dfdata: null
networks:
  revenge-net:
    driver: bridge
