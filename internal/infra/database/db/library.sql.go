// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: library.sql

package db

import (
	"context"
	"time"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const checkLibraryPermission = `-- name: CheckLibraryPermission :one
SELECT EXISTS(
    SELECT 1 FROM public.library_permissions
    WHERE library_id = $1
    AND user_id = $2
    AND permission = $3
) AS has_permission
`

type CheckLibraryPermissionParams struct {
	LibraryID  uuid.UUID `json:"libraryId"`
	UserID     uuid.UUID `json:"userId"`
	Permission string    `json:"permission"`
}

// Checks if a user has a specific permission for a library
func (q *Queries) CheckLibraryPermission(ctx context.Context, arg CheckLibraryPermissionParams) (bool, error) {
	row := q.db.QueryRow(ctx, checkLibraryPermission, arg.LibraryID, arg.UserID, arg.Permission)
	var has_permission bool
	err := row.Scan(&has_permission)
	return has_permission, err
}

const countLibraries = `-- name: CountLibraries :one
SELECT COUNT(*) FROM public.libraries
`

// Counts total libraries
func (q *Queries) CountLibraries(ctx context.Context) (int64, error) {
	row := q.db.QueryRow(ctx, countLibraries)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countLibrariesByType = `-- name: CountLibrariesByType :one
SELECT COUNT(*) FROM public.libraries
WHERE type = $1
`

// Counts libraries by type
func (q *Queries) CountLibrariesByType(ctx context.Context, type_ string) (int64, error) {
	row := q.db.QueryRow(ctx, countLibrariesByType, type_)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countLibraryPermissions = `-- name: CountLibraryPermissions :one
SELECT COUNT(*) FROM public.library_permissions
WHERE library_id = $1
`

// Counts permissions for a library
func (q *Queries) CountLibraryPermissions(ctx context.Context, libraryID uuid.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, countLibraryPermissions, libraryID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countLibraryScans = `-- name: CountLibraryScans :one
SELECT COUNT(*) FROM public.library_scans
WHERE library_id = $1
`

// Counts scans for a library
func (q *Queries) CountLibraryScans(ctx context.Context, libraryID uuid.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, countLibraryScans, libraryID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createLibrary = `-- name: CreateLibrary :one
INSERT INTO public.libraries (
    name,
    type,
    paths,
    enabled,
    scan_on_startup,
    realtime_monitoring,
    metadata_provider,
    preferred_language,
    scanner_config
) VALUES (
    $1,
    $2,
    $3,
    $4,
    $5,
    $6,
    $7,
    $8,
    $9
)
RETURNING id, name, type, paths, enabled, scan_on_startup, realtime_monitoring, metadata_provider, preferred_language, scanner_config, created_at, updated_at
`

type CreateLibraryParams struct {
	Name               string   `json:"name"`
	Type               string   `json:"type"`
	Paths              []string `json:"paths"`
	Enabled            bool     `json:"enabled"`
	ScanOnStartup      bool     `json:"scanOnStartup"`
	RealtimeMonitoring bool     `json:"realtimeMonitoring"`
	MetadataProvider   *string  `json:"metadataProvider"`
	PreferredLanguage  string   `json:"preferredLanguage"`
	ScannerConfig      []byte   `json:"scannerConfig"`
}

// Creates a new library
func (q *Queries) CreateLibrary(ctx context.Context, arg CreateLibraryParams) (Library, error) {
	row := q.db.QueryRow(ctx, createLibrary,
		arg.Name,
		arg.Type,
		arg.Paths,
		arg.Enabled,
		arg.ScanOnStartup,
		arg.RealtimeMonitoring,
		arg.MetadataProvider,
		arg.PreferredLanguage,
		arg.ScannerConfig,
	)
	var i Library
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Type,
		&i.Paths,
		&i.Enabled,
		&i.ScanOnStartup,
		&i.RealtimeMonitoring,
		&i.MetadataProvider,
		&i.PreferredLanguage,
		&i.ScannerConfig,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createLibraryPermission = `-- name: CreateLibraryPermission :one

INSERT INTO public.library_permissions (
    library_id,
    user_id,
    permission
) VALUES (
    $1,
    $2,
    $3
)
ON CONFLICT (library_id, user_id, permission) DO NOTHING
RETURNING id, library_id, user_id, permission, created_at
`

type CreateLibraryPermissionParams struct {
	LibraryID  uuid.UUID `json:"libraryId"`
	UserID     uuid.UUID `json:"userId"`
	Permission string    `json:"permission"`
}

// ============================================================================
// Library Permissions
// ============================================================================
// Grants a permission to a user for a library
func (q *Queries) CreateLibraryPermission(ctx context.Context, arg CreateLibraryPermissionParams) (LibraryPermission, error) {
	row := q.db.QueryRow(ctx, createLibraryPermission, arg.LibraryID, arg.UserID, arg.Permission)
	var i LibraryPermission
	err := row.Scan(
		&i.ID,
		&i.LibraryID,
		&i.UserID,
		&i.Permission,
		&i.CreatedAt,
	)
	return i, err
}

const createLibraryScan = `-- name: CreateLibraryScan :one

INSERT INTO public.library_scans (
    library_id,
    scan_type,
    status
) VALUES (
    $1,
    $2,
    $3
)
RETURNING id, library_id, scan_type, status, items_scanned, items_added, items_updated, items_removed, errors_count, error_message, started_at, completed_at, duration_seconds, created_at
`

type CreateLibraryScanParams struct {
	LibraryID uuid.UUID `json:"libraryId"`
	ScanType  string    `json:"scanType"`
	Status    string    `json:"status"`
}

// ============================================================================
// Library Scans
// ============================================================================
// Creates a new library scan record
func (q *Queries) CreateLibraryScan(ctx context.Context, arg CreateLibraryScanParams) (LibraryScan, error) {
	row := q.db.QueryRow(ctx, createLibraryScan, arg.LibraryID, arg.ScanType, arg.Status)
	var i LibraryScan
	err := row.Scan(
		&i.ID,
		&i.LibraryID,
		&i.ScanType,
		&i.Status,
		&i.ItemsScanned,
		&i.ItemsAdded,
		&i.ItemsUpdated,
		&i.ItemsRemoved,
		&i.ErrorsCount,
		&i.ErrorMessage,
		&i.StartedAt,
		&i.CompletedAt,
		&i.DurationSeconds,
		&i.CreatedAt,
	)
	return i, err
}

const deleteAllLibraryPermissions = `-- name: DeleteAllLibraryPermissions :exec
DELETE FROM public.library_permissions
WHERE library_id = $1
`

// Revokes all permissions for a library (used when deleting library)
func (q *Queries) DeleteAllLibraryPermissions(ctx context.Context, libraryID uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteAllLibraryPermissions, libraryID)
	return err
}

const deleteLibrary = `-- name: DeleteLibrary :exec
DELETE FROM public.libraries
WHERE id = $1
`

// Deletes a library by ID
func (q *Queries) DeleteLibrary(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteLibrary, id)
	return err
}

const deleteLibraryPermission = `-- name: DeleteLibraryPermission :exec
DELETE FROM public.library_permissions
WHERE library_id = $1
AND user_id = $2
AND permission = $3
`

type DeleteLibraryPermissionParams struct {
	LibraryID  uuid.UUID `json:"libraryId"`
	UserID     uuid.UUID `json:"userId"`
	Permission string    `json:"permission"`
}

// Revokes a permission from a user for a library
func (q *Queries) DeleteLibraryPermission(ctx context.Context, arg DeleteLibraryPermissionParams) error {
	_, err := q.db.Exec(ctx, deleteLibraryPermission, arg.LibraryID, arg.UserID, arg.Permission)
	return err
}

const deleteOldLibraryScans = `-- name: DeleteOldLibraryScans :execrows
DELETE FROM public.library_scans
WHERE created_at < $1
AND status IN ('completed', 'failed', 'cancelled')
`

// Deletes library scans older than a given time
func (q *Queries) DeleteOldLibraryScans(ctx context.Context, olderThan time.Time) (int64, error) {
	result, err := q.db.Exec(ctx, deleteOldLibraryScans, olderThan)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const deleteUserLibraryPermissions = `-- name: DeleteUserLibraryPermissions :exec
DELETE FROM public.library_permissions
WHERE user_id = $1
`

// Revokes all library permissions for a user
func (q *Queries) DeleteUserLibraryPermissions(ctx context.Context, userID uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteUserLibraryPermissions, userID)
	return err
}

const getLatestLibraryScan = `-- name: GetLatestLibraryScan :one
SELECT id, library_id, scan_type, status, items_scanned, items_added, items_updated, items_removed, errors_count, error_message, started_at, completed_at, duration_seconds, created_at FROM public.library_scans
WHERE library_id = $1
ORDER BY created_at DESC
LIMIT 1
`

// Gets the most recent scan for a library
func (q *Queries) GetLatestLibraryScan(ctx context.Context, libraryID uuid.UUID) (LibraryScan, error) {
	row := q.db.QueryRow(ctx, getLatestLibraryScan, libraryID)
	var i LibraryScan
	err := row.Scan(
		&i.ID,
		&i.LibraryID,
		&i.ScanType,
		&i.Status,
		&i.ItemsScanned,
		&i.ItemsAdded,
		&i.ItemsUpdated,
		&i.ItemsRemoved,
		&i.ErrorsCount,
		&i.ErrorMessage,
		&i.StartedAt,
		&i.CompletedAt,
		&i.DurationSeconds,
		&i.CreatedAt,
	)
	return i, err
}

const getLibrary = `-- name: GetLibrary :one
SELECT id, name, type, paths, enabled, scan_on_startup, realtime_monitoring, metadata_provider, preferred_language, scanner_config, created_at, updated_at FROM public.libraries
WHERE id = $1
`

// Gets a library by ID
func (q *Queries) GetLibrary(ctx context.Context, id uuid.UUID) (Library, error) {
	row := q.db.QueryRow(ctx, getLibrary, id)
	var i Library
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Type,
		&i.Paths,
		&i.Enabled,
		&i.ScanOnStartup,
		&i.RealtimeMonitoring,
		&i.MetadataProvider,
		&i.PreferredLanguage,
		&i.ScannerConfig,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getLibraryByName = `-- name: GetLibraryByName :one
SELECT id, name, type, paths, enabled, scan_on_startup, realtime_monitoring, metadata_provider, preferred_language, scanner_config, created_at, updated_at FROM public.libraries
WHERE name = $1
`

// Gets a library by name
func (q *Queries) GetLibraryByName(ctx context.Context, name string) (Library, error) {
	row := q.db.QueryRow(ctx, getLibraryByName, name)
	var i Library
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Type,
		&i.Paths,
		&i.Enabled,
		&i.ScanOnStartup,
		&i.RealtimeMonitoring,
		&i.MetadataProvider,
		&i.PreferredLanguage,
		&i.ScannerConfig,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getLibraryPermission = `-- name: GetLibraryPermission :one
SELECT id, library_id, user_id, permission, created_at FROM public.library_permissions
WHERE library_id = $1
AND user_id = $2
AND permission = $3
`

type GetLibraryPermissionParams struct {
	LibraryID  uuid.UUID `json:"libraryId"`
	UserID     uuid.UUID `json:"userId"`
	Permission string    `json:"permission"`
}

// Gets a specific permission
func (q *Queries) GetLibraryPermission(ctx context.Context, arg GetLibraryPermissionParams) (LibraryPermission, error) {
	row := q.db.QueryRow(ctx, getLibraryPermission, arg.LibraryID, arg.UserID, arg.Permission)
	var i LibraryPermission
	err := row.Scan(
		&i.ID,
		&i.LibraryID,
		&i.UserID,
		&i.Permission,
		&i.CreatedAt,
	)
	return i, err
}

const getLibraryScan = `-- name: GetLibraryScan :one
SELECT id, library_id, scan_type, status, items_scanned, items_added, items_updated, items_removed, errors_count, error_message, started_at, completed_at, duration_seconds, created_at FROM public.library_scans
WHERE id = $1
`

// Gets a library scan by ID
func (q *Queries) GetLibraryScan(ctx context.Context, id uuid.UUID) (LibraryScan, error) {
	row := q.db.QueryRow(ctx, getLibraryScan, id)
	var i LibraryScan
	err := row.Scan(
		&i.ID,
		&i.LibraryID,
		&i.ScanType,
		&i.Status,
		&i.ItemsScanned,
		&i.ItemsAdded,
		&i.ItemsUpdated,
		&i.ItemsRemoved,
		&i.ErrorsCount,
		&i.ErrorMessage,
		&i.StartedAt,
		&i.CompletedAt,
		&i.DurationSeconds,
		&i.CreatedAt,
	)
	return i, err
}

const getRunningScans = `-- name: GetRunningScans :many
SELECT id, library_id, scan_type, status, items_scanned, items_added, items_updated, items_removed, errors_count, error_message, started_at, completed_at, duration_seconds, created_at FROM public.library_scans
WHERE status = 'running'
ORDER BY started_at ASC
`

// Gets all currently running scans
func (q *Queries) GetRunningScans(ctx context.Context) ([]LibraryScan, error) {
	rows, err := q.db.Query(ctx, getRunningScans)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []LibraryScan{}
	for rows.Next() {
		var i LibraryScan
		if err := rows.Scan(
			&i.ID,
			&i.LibraryID,
			&i.ScanType,
			&i.Status,
			&i.ItemsScanned,
			&i.ItemsAdded,
			&i.ItemsUpdated,
			&i.ItemsRemoved,
			&i.ErrorsCount,
			&i.ErrorMessage,
			&i.StartedAt,
			&i.CompletedAt,
			&i.DurationSeconds,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getUserAccessibleLibraries = `-- name: GetUserAccessibleLibraries :many
SELECT DISTINCT l.id, l.name, l.type, l.paths, l.enabled, l.scan_on_startup, l.realtime_monitoring, l.metadata_provider, l.preferred_language, l.scanner_config, l.created_at, l.updated_at FROM public.libraries l
JOIN public.library_permissions lp ON l.id = lp.library_id
WHERE lp.user_id = $1
AND lp.permission = 'view'
AND l.enabled = true
ORDER BY l.name ASC
`

// Gets all libraries a user has view access to
func (q *Queries) GetUserAccessibleLibraries(ctx context.Context, userID uuid.UUID) ([]Library, error) {
	rows, err := q.db.Query(ctx, getUserAccessibleLibraries, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Library{}
	for rows.Next() {
		var i Library
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Type,
			&i.Paths,
			&i.Enabled,
			&i.ScanOnStartup,
			&i.RealtimeMonitoring,
			&i.MetadataProvider,
			&i.PreferredLanguage,
			&i.ScannerConfig,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listEnabledLibraries = `-- name: ListEnabledLibraries :many
SELECT id, name, type, paths, enabled, scan_on_startup, realtime_monitoring, metadata_provider, preferred_language, scanner_config, created_at, updated_at FROM public.libraries
WHERE enabled = true
ORDER BY name ASC
`

// Lists all enabled libraries
func (q *Queries) ListEnabledLibraries(ctx context.Context) ([]Library, error) {
	rows, err := q.db.Query(ctx, listEnabledLibraries)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Library{}
	for rows.Next() {
		var i Library
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Type,
			&i.Paths,
			&i.Enabled,
			&i.ScanOnStartup,
			&i.RealtimeMonitoring,
			&i.MetadataProvider,
			&i.PreferredLanguage,
			&i.ScannerConfig,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listLibraries = `-- name: ListLibraries :many
SELECT id, name, type, paths, enabled, scan_on_startup, realtime_monitoring, metadata_provider, preferred_language, scanner_config, created_at, updated_at FROM public.libraries
ORDER BY name ASC
`

// Lists all libraries
func (q *Queries) ListLibraries(ctx context.Context) ([]Library, error) {
	rows, err := q.db.Query(ctx, listLibraries)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Library{}
	for rows.Next() {
		var i Library
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Type,
			&i.Paths,
			&i.Enabled,
			&i.ScanOnStartup,
			&i.RealtimeMonitoring,
			&i.MetadataProvider,
			&i.PreferredLanguage,
			&i.ScannerConfig,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listLibrariesByType = `-- name: ListLibrariesByType :many
SELECT id, name, type, paths, enabled, scan_on_startup, realtime_monitoring, metadata_provider, preferred_language, scanner_config, created_at, updated_at FROM public.libraries
WHERE type = $1
ORDER BY name ASC
`

// Lists libraries by type
func (q *Queries) ListLibrariesByType(ctx context.Context, type_ string) ([]Library, error) {
	rows, err := q.db.Query(ctx, listLibrariesByType, type_)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Library{}
	for rows.Next() {
		var i Library
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Type,
			&i.Paths,
			&i.Enabled,
			&i.ScanOnStartup,
			&i.RealtimeMonitoring,
			&i.MetadataProvider,
			&i.PreferredLanguage,
			&i.ScannerConfig,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listLibraryPermissions = `-- name: ListLibraryPermissions :many
SELECT id, library_id, user_id, permission, created_at FROM public.library_permissions
WHERE library_id = $1
ORDER BY created_at ASC
`

// Lists all permissions for a library
func (q *Queries) ListLibraryPermissions(ctx context.Context, libraryID uuid.UUID) ([]LibraryPermission, error) {
	rows, err := q.db.Query(ctx, listLibraryPermissions, libraryID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []LibraryPermission{}
	for rows.Next() {
		var i LibraryPermission
		if err := rows.Scan(
			&i.ID,
			&i.LibraryID,
			&i.UserID,
			&i.Permission,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listLibraryScans = `-- name: ListLibraryScans :many
SELECT id, library_id, scan_type, status, items_scanned, items_added, items_updated, items_removed, errors_count, error_message, started_at, completed_at, duration_seconds, created_at FROM public.library_scans
WHERE library_id = $1
ORDER BY created_at DESC
LIMIT $3 OFFSET $2
`

type ListLibraryScansParams struct {
	LibraryID uuid.UUID `json:"libraryId"`
	OffsetVal int32     `json:"offsetVal"`
	LimitVal  int32     `json:"limitVal"`
}

// Lists scans for a library
func (q *Queries) ListLibraryScans(ctx context.Context, arg ListLibraryScansParams) ([]LibraryScan, error) {
	rows, err := q.db.Query(ctx, listLibraryScans, arg.LibraryID, arg.OffsetVal, arg.LimitVal)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []LibraryScan{}
	for rows.Next() {
		var i LibraryScan
		if err := rows.Scan(
			&i.ID,
			&i.LibraryID,
			&i.ScanType,
			&i.Status,
			&i.ItemsScanned,
			&i.ItemsAdded,
			&i.ItemsUpdated,
			&i.ItemsRemoved,
			&i.ErrorsCount,
			&i.ErrorMessage,
			&i.StartedAt,
			&i.CompletedAt,
			&i.DurationSeconds,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listUserLibraryPermissions = `-- name: ListUserLibraryPermissions :many
SELECT id, library_id, user_id, permission, created_at FROM public.library_permissions
WHERE user_id = $1
ORDER BY created_at ASC
`

// Lists all library permissions for a user
func (q *Queries) ListUserLibraryPermissions(ctx context.Context, userID uuid.UUID) ([]LibraryPermission, error) {
	rows, err := q.db.Query(ctx, listUserLibraryPermissions, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []LibraryPermission{}
	for rows.Next() {
		var i LibraryPermission
		if err := rows.Scan(
			&i.ID,
			&i.LibraryID,
			&i.UserID,
			&i.Permission,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateLibrary = `-- name: UpdateLibrary :one
UPDATE public.libraries SET
    name = COALESCE($1, name),
    type = COALESCE($2, type),
    paths = COALESCE($3, paths),
    enabled = COALESCE($4, enabled),
    scan_on_startup = COALESCE($5, scan_on_startup),
    realtime_monitoring = COALESCE($6, realtime_monitoring),
    metadata_provider = COALESCE($7, metadata_provider),
    preferred_language = COALESCE($8, preferred_language),
    scanner_config = COALESCE($9, scanner_config)
WHERE id = $10
RETURNING id, name, type, paths, enabled, scan_on_startup, realtime_monitoring, metadata_provider, preferred_language, scanner_config, created_at, updated_at
`

type UpdateLibraryParams struct {
	Name               *string   `json:"name"`
	Type               *string   `json:"type"`
	Paths              []string  `json:"paths"`
	Enabled            *bool     `json:"enabled"`
	ScanOnStartup      *bool     `json:"scanOnStartup"`
	RealtimeMonitoring *bool     `json:"realtimeMonitoring"`
	MetadataProvider   *string   `json:"metadataProvider"`
	PreferredLanguage  *string   `json:"preferredLanguage"`
	ScannerConfig      []byte    `json:"scannerConfig"`
	ID                 uuid.UUID `json:"id"`
}

// Updates a library
func (q *Queries) UpdateLibrary(ctx context.Context, arg UpdateLibraryParams) (Library, error) {
	row := q.db.QueryRow(ctx, updateLibrary,
		arg.Name,
		arg.Type,
		arg.Paths,
		arg.Enabled,
		arg.ScanOnStartup,
		arg.RealtimeMonitoring,
		arg.MetadataProvider,
		arg.PreferredLanguage,
		arg.ScannerConfig,
		arg.ID,
	)
	var i Library
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Type,
		&i.Paths,
		&i.Enabled,
		&i.ScanOnStartup,
		&i.RealtimeMonitoring,
		&i.MetadataProvider,
		&i.PreferredLanguage,
		&i.ScannerConfig,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateLibraryScanProgress = `-- name: UpdateLibraryScanProgress :one
UPDATE public.library_scans SET
    items_scanned = $1,
    items_added = $2,
    items_updated = $3,
    items_removed = $4,
    errors_count = $5
WHERE id = $6
RETURNING id, library_id, scan_type, status, items_scanned, items_added, items_updated, items_removed, errors_count, error_message, started_at, completed_at, duration_seconds, created_at
`

type UpdateLibraryScanProgressParams struct {
	ItemsScanned int32     `json:"itemsScanned"`
	ItemsAdded   int32     `json:"itemsAdded"`
	ItemsUpdated int32     `json:"itemsUpdated"`
	ItemsRemoved int32     `json:"itemsRemoved"`
	ErrorsCount  int32     `json:"errorsCount"`
	ID           uuid.UUID `json:"id"`
}

// Updates scan progress
func (q *Queries) UpdateLibraryScanProgress(ctx context.Context, arg UpdateLibraryScanProgressParams) (LibraryScan, error) {
	row := q.db.QueryRow(ctx, updateLibraryScanProgress,
		arg.ItemsScanned,
		arg.ItemsAdded,
		arg.ItemsUpdated,
		arg.ItemsRemoved,
		arg.ErrorsCount,
		arg.ID,
	)
	var i LibraryScan
	err := row.Scan(
		&i.ID,
		&i.LibraryID,
		&i.ScanType,
		&i.Status,
		&i.ItemsScanned,
		&i.ItemsAdded,
		&i.ItemsUpdated,
		&i.ItemsRemoved,
		&i.ErrorsCount,
		&i.ErrorMessage,
		&i.StartedAt,
		&i.CompletedAt,
		&i.DurationSeconds,
		&i.CreatedAt,
	)
	return i, err
}

const updateLibraryScanStatus = `-- name: UpdateLibraryScanStatus :one
UPDATE public.library_scans SET
    status = $1,
    started_at = COALESCE($2, started_at),
    completed_at = $3,
    duration_seconds = $4,
    error_message = $5
WHERE id = $6
RETURNING id, library_id, scan_type, status, items_scanned, items_added, items_updated, items_removed, errors_count, error_message, started_at, completed_at, duration_seconds, created_at
`

type UpdateLibraryScanStatusParams struct {
	Status          string             `json:"status"`
	StartedAt       pgtype.Timestamptz `json:"startedAt"`
	CompletedAt     pgtype.Timestamptz `json:"completedAt"`
	DurationSeconds *int32             `json:"durationSeconds"`
	ErrorMessage    *string            `json:"errorMessage"`
	ID              uuid.UUID          `json:"id"`
}

// Updates scan status
func (q *Queries) UpdateLibraryScanStatus(ctx context.Context, arg UpdateLibraryScanStatusParams) (LibraryScan, error) {
	row := q.db.QueryRow(ctx, updateLibraryScanStatus,
		arg.Status,
		arg.StartedAt,
		arg.CompletedAt,
		arg.DurationSeconds,
		arg.ErrorMessage,
		arg.ID,
	)
	var i LibraryScan
	err := row.Scan(
		&i.ID,
		&i.LibraryID,
		&i.ScanType,
		&i.Status,
		&i.ItemsScanned,
		&i.ItemsAdded,
		&i.ItemsUpdated,
		&i.ItemsRemoved,
		&i.ErrorsCount,
		&i.ErrorMessage,
		&i.StartedAt,
		&i.CompletedAt,
		&i.DurationSeconds,
		&i.CreatedAt,
	)
	return i, err
}
